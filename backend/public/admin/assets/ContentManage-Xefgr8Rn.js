import{_ as ie,i as ce,p as z,o as u,c as P,a,w as l,f as p,r as o,u as re,D as de,e as i,C as j,z as _,d as r,t as m,b as ue,k as y,O as pe,F as _e,y as ve,N as ge,m as B,aB as fe,T as me,J as G,E as A,G as ye}from"./index-1rGkZLYp.js";const he={class:"content-manage"},be={class:"card-header"},Ce={class:"header-title"},ke={class:"header-actions"},we={class:"tab-content"},xe={class:"title-cell"},ze={class:"title-text"},Ae={class:"tab-content"},Ve={class:"filter-bar"},Te={class:"image-error"},De={class:"title-cell"},Ne={class:"title-text"},Be={style:{"margin-left":"4px"}},Se={class:"pagination-container"},Ue={__name:"ContentManage",setup($e){const S=re(),v=p("notice"),g=p(!1),U=p([]),V=p([]),f=p(1),C=p(10),$=p(0),T=p(""),k=p(""),D=p(!1),J=["资料","备考经验","政策动态","考试技巧","系统通知"];ce(()=>{N()});const N=()=>{v.value==="notice"?R():w()},O=()=>{N()},R=async()=>{g.value=!0;try{const n=await z.getNotices({type:"notice_ad"});if(n.code===0){const e=n.data.list||n.data||[];U.value=e.map(s=>({...s,isActive:s.isActive===1||s.isActive===!0}))}}catch(n){console.error("Fetch notices error:",n)}finally{g.value=!1}},w=async()=>{g.value=!0;try{const n={page:f.value,size:C.value,keyword:T.value,status:D.value?0:1,noticeType:"article"};k.value&&(n.category=k.value);const e=await z.getNotices(n);if(e.code===0){const s=e.data.list||e.data||[];V.value=s.map(d=>({...d,isActive:d.isActive===1||d.isActive===!0})),$.value=e.data.total||V.value.length}}catch(n){console.error("Fetch articles error:",n)}finally{g.value=!1}},x=()=>{f.value=1,w()},H=n=>{f.value=n,w()},Q=n=>{C.value=n,f.value=1,w()},E=n=>{S.push({name:"ArticleEdit",query:{type:n}})},M=n=>{S.push({name:"ArticleEdit",query:{id:n._id||n.id,type:n.type||(v.value==="article"?"article":"notice")}})},F=n=>{const e=n.title||"该内容";ye.confirm(`确定要删除 "${e}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{(await z.deleteNotice(n._id||n.id)).code===0&&(A.success("删除成功"),N())}catch(s){console.error("Delete error:",s)}}).catch(()=>{})},W=async(n,e)=>{try{const s=await z.updateNoticeStatus(n._id||n.id,e);s.code===0?(A.success(`${e?"启用":"禁用"}成功`),n.isActive=e):A.error(s.message||"操作失败")}catch(s){console.error("Toggle status error:",s),A.error("网络错误，请重试")}},X=n=>n?new Date(n).toLocaleString():"-";return(n,e)=>{const s=o("el-icon"),d=o("el-button"),c=o("el-table-column"),h=o("el-tag"),Y=o("el-switch"),K=o("el-button-group"),q=o("el-table"),I=o("el-tab-pane"),Z=o("el-input"),ee=o("el-option"),te=o("el-select"),ae=o("el-checkbox"),le=o("el-image"),ne=o("el-pagination"),se=o("el-tabs"),oe=o("el-card"),L=de("loading");return u(),P("div",he,[a(oe,{class:"manage-card"},{header:l(()=>[i("div",be,[i("div",Ce,[a(s,null,{default:l(()=>[a(y(me))]),_:1}),e[8]||(e[8]=i("span",null,"内容管理",-1))]),i("div",ke,[v.value==="notice"?(u(),_(d,{key:0,type:"primary",onClick:e[0]||(e[0]=t=>E("notice"))},{default:l(()=>[a(s,null,{default:l(()=>[a(y(G))]),_:1}),e[9]||(e[9]=r("添加公告/广告 ",-1))]),_:1})):B("",!0),v.value==="article"?(u(),_(d,{key:1,type:"primary",onClick:e[1]||(e[1]=t=>E("article"))},{default:l(()=>[a(s,null,{default:l(()=>[a(y(G))]),_:1}),e[10]||(e[10]=r("发布新文章 ",-1))]),_:1})):B("",!0)])])]),default:l(()=>[a(se,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value=t),class:"content-tabs",onTabChange:O},{default:l(()=>[a(I,{label:"公告与广告",name:"notice"},{default:l(()=>[i("div",we,[j((u(),_(q,{data:U.value,style:{width:"100%"},border:"",stripe:""},{default:l(()=>[a(c,{prop:"id",label:"ID",width:"80",align:"center"}),a(c,{label:"标题","min-width":"200"},{default:l(({row:t})=>[i("div",xe,[t.type==="ad"?(u(),_(h,{key:0,size:"small",type:"warning",effect:"dark",class:"type-tag"},{default:l(()=>[...e[11]||(e[11]=[r("广告",-1)])]),_:1})):(u(),_(h,{key:1,size:"small",type:"info",effect:"dark",class:"type-tag"},{default:l(()=>[r(m(t.noticeType==="link"?"链接":"文章"),1)]),_:2},1024)),i("span",ze,m(t.title),1)])]),_:1}),a(c,{prop:"category",label:"分类",width:"120",align:"center"}),a(c,{label:"创建时间",width:"180",align:"center"},{default:l(({row:t})=>[r(m(X(t.createTime||t.createdAt)),1)]),_:1}),a(c,{label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(Y,{"model-value":t.isActive,"active-value":!0,"inactive-value":!1,onChange:b=>W(t,b)},null,8,["model-value","onChange"])]),_:1}),a(c,{label:"操作",width:"180",align:"center",fixed:"right"},{default:l(({row:t})=>[a(K,null,{default:l(()=>[a(d,{type:"primary",size:"small",onClick:b=>M(t)},{default:l(()=>[...e[12]||(e[12]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(d,{type:"danger",size:"small",onClick:b=>F(t)},{default:l(()=>[...e[13]||(e[13]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[L,g.value]])])]),_:1}),a(I,{label:"文章管理",name:"article"},{default:l(()=>[i("div",Ae,[i("div",Ve,[a(Z,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),placeholder:"搜索文章标题...",class:"search-input",clearable:"",onClear:x,onKeyup:ue(x,["enter"])},{prefix:l(()=>[a(s,null,{default:l(()=>[a(y(pe))]),_:1})]),_:1},8,["modelValue"]),a(te,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),placeholder:"全部分类",class:"category-select",clearable:"",onChange:x},{default:l(()=>[(u(),P(_e,null,ve(J,t=>a(ee,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(ae,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),label:"仅看草稿",border:"",class:"draft-checkbox",onChange:x},null,8,["modelValue"])]),j((u(),_(q,{data:V.value,style:{width:"100%"},border:"",stripe:""},{default:l(()=>[a(c,{label:"封面",width:"100",align:"center"},{default:l(({row:t})=>[a(le,{src:t.imageUrl,class:"article-cover",fit:"cover","preview-src-list":[t.imageUrl],"preview-teleported":""},{error:l(()=>[i("div",Te,[a(s,null,{default:l(()=>[a(y(ge))]),_:1})])]),_:1},8,["src","preview-src-list"])]),_:1}),a(c,{label:"标题","min-width":"200"},{default:l(({row:t})=>[i("div",De,[t.noticeType==="wechat"?(u(),_(h,{key:0,size:"small",type:"success",class:"type-tag"},{default:l(()=>[...e[14]||(e[14]=[r("微信",-1)])]),_:1})):t.noticeType==="link"?(u(),_(h,{key:1,size:"small",type:"primary",class:"type-tag"},{default:l(()=>[...e[15]||(e[15]=[r("链接",-1)])]),_:1})):B("",!0),i("span",Ne,m(t.title),1)])]),_:1}),a(c,{prop:"category",label:"分类",width:"120",align:"center"}),a(c,{prop:"author",label:"作者",width:"120",align:"center"}),a(c,{label:"浏览量",width:"100",align:"center"},{default:l(({row:t})=>[a(s,null,{default:l(()=>[a(y(fe))]),_:1}),i("span",Be,m(t.viewCount||0),1)]),_:1}),a(c,{label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(h,{type:t.isActive?"success":"info"},{default:l(()=>[r(m(t.isActive?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"操作",width:"180",align:"center",fixed:"right"},{default:l(({row:t})=>[a(K,null,{default:l(()=>[a(d,{type:"primary",size:"small",onClick:b=>M(t)},{default:l(()=>[...e[16]||(e[16]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(d,{type:"danger",size:"small",onClick:b=>F(t)},{default:l(()=>[...e[17]||(e[17]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[L,g.value]]),i("div",Se,[a(ne,{"current-page":f.value,"onUpdate:currentPage":e[5]||(e[5]=t=>f.value=t),"page-size":C.value,"onUpdate:pageSize":e[6]||(e[6]=t=>C.value=t),total:$.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:H},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},Me=ie(Ue,[["__scopeId","data-v-ae251005"]]);export{Me as default};
