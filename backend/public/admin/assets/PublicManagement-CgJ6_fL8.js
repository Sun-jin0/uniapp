import{_ as $a,i as Aa,o as v,c as m,e as g,a,w as o,p as Ra,a1 as f,f as i,r as x,D as Ea,F as h,y as V,z as C,d as r,t as b,m as B,b as Ta,M as Se,n as Na,C as Ja,k as Il,J as xl,E as _,q as ul,G as nl}from"./index-CYafs7gL.js";import{R as sl}from"./RichEditor-DhNxoQ6j.js";import"./style-Ca15nGLt.js";const za={class:"public-management"},Oa={class:"filter-bar"},La={key:0,class:"right-actions"},Ha={key:0},Ka={key:0,class:"question-preview"},Ga={class:"mt-10"},Wa={class:"feedback-actions mt-20"},Xa={class:"filter-bar"},Ya={key:0,class:"right-actions"},Za={class:"filter-bar"},et={class:"import-section"},lt={class:"form-row"},at={key:0,class:"file-list"},tt={class:"import-section"},ot={class:"form-row"},ut={key:0,class:"batch-list"},nt={class:"batch-header"},st={class:"richtext-expand-section"},rt={key:0,class:"richtext-editor-wrapper"},dt=["innerHTML"],it={class:"options-list"},vt={class:"option-row"},ct={class:"option-label"},pt={class:"richtext-expand-section"},ft={key:0,class:"richtext-editor-wrapper"},mt=["innerHTML"],bt={class:"richtext-expand-section"},yt={key:0,class:"richtext-editor-wrapper"},gt=["innerHTML"],wt={style:{display:"flex",gap:"10px"}},_t={style:{display:"flex",gap:"10px"}},kt={style:{display:"flex",gap:"10px"}},Ct={class:"flex-between mb-15"},ht={class:"flex-between mb-15"},Vt={class:"flex gap-10"},It={__name:"PublicManagement",setup(xt){const rl=i("feedback"),Y=i(!1),dl=i([]),Ne=i(0),Ul=[{label:"全部",value:0},{label:"待处理",value:1},{label:"已处理",value:2}],qe=i(""),Fe=i([]),pe=i(!1),F=i(null),Pe=i(""),Qe=i(""),il=i([]),Je=i(""),N=i(0),oe=[{label:"全部",value:0}],Me=i([]),J=i(!1),n=i({}),Z=i(!1),ee=i(!1),le=i(!1),Dl=[{label:"单选题",value:1},{label:"多选题",value:2},{label:"判断题",value:3},{label:"填空题",value:4},{label:"简答题",value:5}],ae=i(1),vl=i(20),ze=i(0),M=i([]),he=i([]),K=i(null),ue=i(null),Ve=i([]),Ie=i([]),G=i(null),ne=i(null),xe=i([]),te=i([]),z=i([]),$=i(""),se=i(null),Oe=i([]),Le=i("subject"),$e=i([]),He=i([]),cl=i([]),pl=i([]),Bl=i(""),Ae=i({}),Ke=i({}),jl=i([{label:"科目列表",level:"subject",data:null}]),fe=i(!1),p=i({}),A=i([]),R=i([]),O=i([]),me=i(!1),D=i({}),re=i(!1),j=i({name:"",sort:0}),be=i(!1),w=i({}),Ue=i([]),ye=i([]),Ge=i("chapters"),ge=i(null),We=i(!1),Sl=t=>t?new Date(t).toLocaleString():"-",we=async()=>{var t;Y.value=!0;try{const e={status:Ne.value};qe.value&&(e.subject=qe.value);const u=await f.getFeedbacks(e);dl.value=((t=u.data)==null?void 0:t.list)||u.data||[]}catch(e){console.error(e)}finally{Y.value=!1}},ql=t=>{Fe.value=t.map(e=>e.id)},Fl=t=>{Me.value=t.map(e=>e.id)},Pl=t=>{F.value=t,Pe.value="",Qe.value="",pe.value=!0},Ql=async t=>{t.questionDetail?(n.value={...t.questionDetail},Z.value=q(n.value.title_richtext),ee.value=q(n.value.answer_richtext),le.value=q(n.value.explanation),await Xe(),J.value=!0,pe.value=!1):_.warning("没有关联的题目可编辑")},Ml=async t=>{if(!t.questionId){_.warning("没有关联的题目可编辑");return}try{Y.value=!0;const e=await f.getQuestionDetail(t.questionId);if(e.code===0&&e.data){if(n.value=e.data,typeof n.value.options=="string")try{n.value.options=JSON.parse(n.value.options)}catch{n.value.options=[]}Z.value=q(n.value.title_richtext),ee.value=q(n.value.answer_richtext),le.value=q(n.value.explanation),await Xe(),J.value=!0}else _.warning("获取题目详情失败")}catch(e){console.error("获取题目详情失败:",e),_.error("获取题目详情失败")}finally{Y.value=!1}},$l=async(t,e)=>{try{await f.replyFeedback(t,{status:e,remark:Pe.value,reply:Qe.value}),_.success("处理成功"),pe.value=!1,we()}catch{_.error("操作失败")}},Al=async t=>{try{await f.batchUpdateFeedbackStatus(Fe.value,t),_.success("批量处理成功"),we()}catch{_.error("操作失败")}},Rl=()=>{El(),K.value=null,ue.value=null,G.value=null,ne.value=null,ae.value=1,P()},El=async()=>{const t=N.value?oe[N.value].value:null;if(!t){M.value=[],he.value=[];return}try{const u=(await f.getPublicCategories({subject:t})).data||[];M.value=u.filter(d=>d.level===1),he.value=[],M.value.length>0&&(K.value=M.value[0].id,ml())}catch(e){console.error("获取分类失败:",e)}},fl=async()=>{try{const t=await f.getPublicCategories({level:1});M.value=t.data||[]}catch(t){console.error("加载一级分类失败:",t)}},ml=async()=>{if(ue.value=null,he.value=[],G.value=null,Ve.value=[],ne.value=null,Ie.value=[],ae.value=1,!K.value){P();return}try{const t=await f.getPublicCategories({parentId:K.value});he.value=t.data||[];const e=N.value?oe[N.value].value:null,u=await f.getPublicBooks({subject:e,firstCategoryId:K.value});Ve.value=u.data||[],P()}catch(t){console.error("获取二级分类失败:",t)}},Tl=async()=>{if(G.value=null,Ve.value=[],ne.value=null,Ie.value=[],ae.value=1,!ue.value){P();return}try{const t=N.value?oe[N.value].value:null,e=await f.getPublicBooks({subject:t,secondCategoryId:ue.value});Ve.value=e.data||[],P()}catch(t){console.error("获取书籍失败:",t)}},Nl=async()=>{if(ne.value=null,Ie.value=[],ae.value=1,!G.value){P();return}try{const t=await f.getChapters({bookId:G.value});Ie.value=t.data||[],P()}catch(t){console.error("获取章节失败:",t)}},Jl=()=>{ae.value=1,P()},zl=t=>{ae.value=t,P()},P=async()=>{var t,e;Y.value=!0;try{const u=await f.getQuestions({keyword:Je.value,subject:N.value?oe[N.value].value:null,firstCategoryId:K.value,secondCategoryId:ue.value,bookId:G.value,chapterId:ne.value,page:ae.value,pageSize:vl.value});il.value=((t=u.data)==null?void 0:t.list)||u.data||[],ze.value=((e=u.data)==null?void 0:e.total)||0}catch(u){console.error(u)}finally{Y.value=!1}},Ol=()=>{n.value={type:1,options:["","","",""],isKnowledgeCard:0},Z.value=!1,ee.value=!1,le.value=!1,J.value=!0},Ll=async t=>{if(n.value=JSON.parse(JSON.stringify(t)),typeof n.value.options=="string")try{n.value.options=JSON.parse(n.value.options)}catch{n.value.options=[]}Z.value=q(n.value.title_richtext),ee.value=q(n.value.answer_richtext),le.value=q(n.value.explanation),await Xe(),J.value=!0},Xe=async()=>{if(M.value.length===0&&await fl(),n.value.firstCategoryId)try{const t=await f.getPublicCategories({parentId:n.value.firstCategoryId});xe.value=t.data||[]}catch(t){console.error("加载二级分类失败:",t)}if(n.value.secondCategoryId)try{const t=await f.getPublicBooks({secondCategoryId:n.value.secondCategoryId});te.value=t.data||[]}catch(t){console.error("加载书籍失败:",t)}if(n.value.bookId)try{const t=await f.getChapters({bookId:n.value.bookId});z.value=t.data||[]}catch(t){console.error("加载章节失败:",t)}},Hl=async()=>{if(n.value.secondCategoryId=null,n.value.bookId=null,n.value.chapterId=null,xe.value=[],te.value=[],z.value=[],!!n.value.firstCategoryId)try{const t=await f.getPublicCategories({parentId:n.value.firstCategoryId});xe.value=t.data||[]}catch(t){console.error("获取二级分类失败:",t)}},Kl=async()=>{if(n.value.bookId=null,n.value.chapterId=null,te.value=[],z.value=[],!!n.value.secondCategoryId)try{const t=await f.getPublicBooks({secondCategoryId:n.value.secondCategoryId});te.value=t.data||[]}catch(t){console.error("获取书籍失败:",t)}},Gl=async()=>{if(n.value.chapterId=null,z.value=[],!!n.value.bookId)try{const t=await f.getChapters({bookId:n.value.bookId});z.value=t.data||[]}catch(t){console.error("获取章节失败:",t)}},Wl=async()=>{var t,e;try{const u={...n.value};Array.isArray(u.options)&&(u.options=JSON.stringify(u.options)),u.id||(u.isManualCreate=!0),console.log("保存题目数据:",u),u.id?await f.updateQuestion(u.id,u):await f.createQuestion(u),_.success("保存成功"),J.value=!1,P(),Le.value==="question"&&gl(),be.value&&await Be()}catch(u){console.error("保存失败:",u),_.error("保存失败: "+(((e=(t=u.response)==null?void 0:t.data)==null?void 0:e.message)||u.message))}},Xl=()=>{n.value.options||(n.value.options=[]),n.value.options.push("")},Yl=t=>{n.value.options.splice(t,1)},Zl=async()=>{try{await f.batchDeleteQuestions(Me.value),_.success("批量删除成功"),Me.value=[],P(),Le.value==="question"&&gl()}catch{_.error("批量删除失败")}},bl=t=>({1:"单选",2:"多选",3:"判断",4:"填空",5:"简答",6:"分析题"})[t]||"未知",Ye=t=>({politics:"政治",english:"英语",math:"数学"})[t]||t||"未知",q=t=>t?t.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim().length>0:!1,Ze=ul(()=>He.value),ea=ul(()=>ge.value?ye.value.filter(t=>t.chapterId==ge.value):ye.value),la=t=>({1:"单选题",2:"多选题",3:"判断题",4:"填空题",5:"简答题",6:"分析题"})[t]||`题型${t}`,aa=async()=>{if(se.value=null,Oe.value=[],await De(),!!$.value)try{const t=await f.getPublicCategories({subject:$.value,level:2});Oe.value=t.data||[]}catch(t){console.error("获取二级分类失败:",t)}},ta=async()=>{await De()},De=async()=>{try{const t={};$.value&&(t.subject=$.value),se.value&&(t.secondCategoryId=se.value);const e=await f.getPublicBooks(t);He.value=e.data||[]}catch(t){console.error("加载书籍失败:",t)}},oa=async()=>{const t=await Ra.getNavSubjects();t.code===0&&($e.value=t.data.map(e=>({id:e.id||e.subject_code,name:e.name,value:e.subject_code||e.id,label:e.name})),oe.splice(1),$e.value.forEach(e=>oe.push({label:e.name,value:e.value})))},ua=t=>{const e={},u=[];return t.forEach(d=>{e[d.id]={...d,children:[]}}),t.forEach(d=>{d.parent_id&&e[d.parent_id]?e[d.parent_id].children.push(e[d.id]):u.push(e[d.id])}),u},na=async t=>{Ae.value=t,Le.value="chapter",jl.value.push({label:t.name,level:"chapter",data:t});try{const u=(await f.getChapters({bookId:t.id})).data||[];cl.value=ua(u)}catch(e){console.error("获取章节失败:",e),cl.value=[]}},sa=async()=>{A.value.length===0&&await yl(!1),console.log("bookFirstCategories:",A.value),console.log("bookSubject:",$.value),console.log("bookSecondCategoryId:",se.value);const t={name:"",subject:$.value||"",sort:0,status:1,first_category_id:null,second_category_id:se.value||null};if($.value&&A.value.length>0){const e=A.value.find(u=>u.subject===$.value);console.log("找到的一级分类:",e),e&&(t.first_category_id=e.id)}if(console.log("initialData:",t),p.value=t,$.value)try{const e=await f.getPublicCategories({subject:$.value,level:2});R.value=e.data||[],console.log("二级分类:",R.value),console.log("当前选中的二级分类ID:",t.second_category_id),console.log("是否找到:",R.value.find(u=>u.id==t.second_category_id))}catch(e){console.error("获取二级分类失败:",e)}fe.value=!0},ra=async t=>{p.value={...t},await yl(),fe.value=!0},yl=async(t=!1)=>{try{const e=await f.getPublicCategories({level:1});if(A.value=e.data||[],p.value.first_category_id){const u=await f.getPublicCategories({parentId:p.value.first_category_id});R.value=u.data||[]}else t||(R.value=[]);if(p.value.second_category_id){const u=await f.getPublicCategories({parentId:p.value.second_category_id});O.value=u.data||[]}else t||(O.value=[])}catch(e){console.error("获取分类失败:",e)}},da=async()=>{if(p.value.second_category_id=null,p.value.third_category_id=null,R.value=[],O.value=[],!!p.value.first_category_id)try{const t=await f.getPublicCategories({parentId:p.value.first_category_id});R.value=t.data||[]}catch(t){console.error("获取二级分类失败:",t)}},ia=async()=>{if(p.value.third_category_id=null,O.value=[],!!p.value.second_category_id)try{const t=await f.getPublicCategories({parentId:p.value.second_category_id});O.value=t.data||[]}catch(t){console.error("获取三级分类失败:",t)}},va=async t=>{if(!t){p.value.first_category_id=null,p.value.second_category_id=null,p.value.third_category_id=null,R.value=[],O.value=[];return}const e=A.value.find(u=>u.subject===t);if(e){p.value.first_category_id=e.id;try{const u=await f.getPublicCategories({parentId:e.id});R.value=u.data||[]}catch(u){console.error("获取二级分类失败:",u),R.value=[]}}},ca=async()=>{var t,e;try{if(!p.value.name){_.warning("请输入书籍/试卷名称");return}if(!p.value.subject){_.warning("请选择科目");return}p.value.id?await f.updateBook(p.value.id,p.value):await f.createBook(p.value),_.success("保存成功"),fe.value=!1,await De()}catch(u){console.error("保存失败:",u),_.error("保存失败: "+(((e=(t=u.response)==null?void 0:t.data)==null?void 0:e.message)||u.message))}},pa=async t=>{try{await nl.confirm(`确定要删除书籍/试卷 "${t.name}" 吗？

警告：这将同时删除该书籍下的所有章节和题目，此操作不可恢复！`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),await f.deleteBook(t.id),_.success("删除成功");const e=Bl.value,u=await f.getPublicBooks({subject:e});He.value=u.data||[]}catch(e){e!=="cancel"&&(console.error("删除失败:",e),_.error("删除失败"))}},el=async t=>{w.value=t,be.value=!0,Ge.value="chapters",await Be()},fa=t=>{el(t)},Be=async()=>{var t;if(w.value.id){We.value=!0;try{const e=await f.getChapters({bookId:w.value.id});Ue.value=e.data||[];const u=await f.getQuestions({bookId:w.value.id,pageSize:1e3});ye.value=((t=u.data)==null?void 0:t.list)||u.data||[]}catch(e){console.error("加载书籍详情失败:",e),_.error("加载书籍详情失败")}finally{We.value=!1}}},ma=()=>{be.value=!1,w.value={},Ue.value=[],ye.value=[],ge.value=null},ba=()=>{D.value={name:"",sort_order:0,book_id:w.value.id,bookId:w.value.id},me.value=!0},ya=t=>{D.value={id:t.id,name:t.name,sort_order:t.sort_order||0,book_id:t.book_id||w.value.id,bookId:t.book_id||w.value.id,parent_id:t.parent_id,level:t.level},me.value=!0},ga=async t=>{try{await nl.confirm(`确定要删除章节 "${t.name}" 吗？

警告：这将同时删除该章节下的所有题目！`,"确认删除",{type:"warning"}),await f.deleteChapter(t.id),_.success("删除成功"),await Be()}catch(e){e!=="cancel"&&(console.error("删除章节失败:",e),_.error("删除失败"))}},wa=async()=>{if(console.log("currentBook:",w.value),console.log("bookFirstCategories:",A.value),M.value.length===0)try{const s=await f.getPublicCategories({level:1});M.value=s.data||[]}catch(s){console.error("加载一级分类失败:",s)}try{const s=await f.getChapters({bookId:w.value.id});z.value=s.data||[]}catch(s){console.error("加载章节失败:",s),z.value=[]}const t={...w.value,id:Number(w.value.id)};te.value=[t],console.log("questionBooks:",te.value);let e=null,u=w.value.second_category_id;if(w.value.subject&&M.value.length>0){const s=M.value.find(c=>c.subject===w.value.subject);s?(e=s.id,console.log("找到一级分类:",s)):(console.log("未找到匹配的一级分类，subject:",w.value.subject),console.log("可用的一级分类:",M.value))}if(e)try{const s=await f.getPublicCategories({parentId:e});xe.value=s.data||[]}catch(s){console.error("加载二级分类失败:",s)}const d=Number(w.value.id);n.value={subject:w.value.subject,firstCategoryId:e,secondCategoryId:u,bookId:d,bookName:w.value.name,chapterId:ge.value,type:1,status:1},console.log("editingQuestion:",n.value),J.value=!0},_a=async t=>{n.value={...t};try{const e=await f.getChapters({bookId:t.bookId});z.value=e.data||[]}catch(e){console.error("加载章节失败:",e),z.value=[]}te.value=[w.value],J.value=!0},ka=async t=>{try{await nl.confirm("确定要删除这道题目吗？","确认删除",{type:"warning"}),await f.deleteQuestion(t.id),_.success("删除成功"),await Be()}catch(e){e!=="cancel"&&(console.error("删除题目失败:",e),_.error("删除失败"))}},gl=async()=>{var t;if(!(!Ke.value||!Ke.value.id)){wl.value=!0;try{const e=await f.getQuestions({chapterId:Ke.value.id,pageSize:1e3});pl.value=((t=e.data)==null?void 0:t.list)||e.data||[]}catch(e){console.error(e),pl.value=[]}finally{wl.value=!1}}},Ca=()=>{j.value={name:"",sort:0,level:1},re.value=!0},ha=()=>{j.value={name:"",sort:0,level:2},re.value=!0},Va=()=>{j.value={name:"",sort:0,level:3},re.value=!0},Ia=async()=>{if(!j.value.name.trim()){_.warning("请输入分类名称");return}try{const t=j.value.level;let e=null;t===2?e=p.value.first_category_id:t===3&&(e=p.value.second_category_id);const u={name:j.value.name,parent_id:e,level:t,sort:j.value.sort||0,subject:t===1?"":p.value.subject||""},d=await f.createPublicCategory(u);if(_.success("创建成功"),re.value=!1,t===1){const s=await f.getPublicCategories({level:1});A.value=s.data||[],d.data&&d.data.id&&(p.value.first_category_id=d.data.id,R.value=[],O.value=[],p.value.second_category_id=null,p.value.third_category_id=null)}else if(t===2){const s=await f.getPublicCategories({parentId:p.value.first_category_id});R.value=s.data||[],d.data&&d.data.id&&(p.value.second_category_id=d.data.id,O.value=[],p.value.third_category_id=null)}else if(t===3){const s=await f.getPublicCategories({parentId:p.value.second_category_id});O.value=s.data||[],d.data&&d.data.id&&(p.value.third_category_id=d.data.id)}}catch(t){console.error("创建分类失败:",t),_.error("创建失败")}},xa=async()=>{var t,e,u,d,s;try{const c=D.value.book_id||D.value.bookId||((t=Ae.value)==null?void 0:t.id)||((e=w.value)==null?void 0:e.id);if(!c){_.error("无法确定所属书籍");return}const S={name:D.value.name,sort_order:D.value.sort_order||0,book_id:c,parent_id:D.value.parent_id||null,level:D.value.level||1};console.log("保存章节数据:",S),D.value.id?await f.updateChapter(D.value.id,S):await f.createChapter(S),_.success("保存成功"),me.value=!1,be.value?await Be():(u=Ae.value)!=null&&u.id&&na(Ae.value)}catch(c){console.error("保存章节失败:",c),_.error("保存失败: "+(((s=(d=c.response)==null?void 0:d.data)==null?void 0:s.message)||c.message))}};Aa(()=>{oa(),fl(),we(),P(),De()});const wl=i(!1),ll=i("politics"),de=i([]),Re=i(!1),ie=i(null),al=i("politics"),ve=i([]),je=i(!1),tl=i(!1),Ua=()=>{const t=document.createElement("input");t.type="file",t.multiple=!0,t.accept=".json",t.onchange=e=>{const u=Array.from(e.target.files);if(u.length!==3){_.warning("请选择 3 个 JSON 文件");return}de.value=u,ie.value=null},t.click()},ce=t=>new Promise((e,u)=>{const d=new FileReader;d.onload=s=>{try{e(JSON.parse(s.target.result))}catch(c){u(c)}},d.onerror=u,d.readAsText(t)}),Da=async()=>{var t;if(de.value.length===3){Re.value=!0,ie.value=null;try{let e,u,d;if(de.value.forEach(Q=>{const E=Q.name.toLowerCase();E.includes("questions")?u=Q:E.includes("answers")?d=Q:e=Q}),!e||!u||!d)throw new Error("未能正确识别书籍、题目和答案文件");const s=await ce(e),c=await ce(u),S=await ce(d),L=s.data||s,I=((t=c.data)==null?void 0:t.question_list)||c.data||c,W=S.data||S,U=await f.importPublicData({bookData:L,questions:Array.isArray(I)?I:[],answers:Array.isArray(W)?W:[],subject:ll.value});if(U.code===0)ie.value={success:!0,msg:"导入成功！书籍 ID: "+U.data.bookId},de.value=[];else throw new Error(U.msg)}catch(e){ie.value={success:!1,msg:"导入失败: "+e.message}}finally{Re.value=!1}}},Ba=()=>{const t=document.createElement("input");t.type="file",t.webkitdirectory=!0,t.onchange=_l,t.click()},ja=()=>{const t=document.createElement("input");t.type="file",t.multiple=!0,t.accept=".json",t.onchange=_l,t.click()},_l=t=>{const e=Array.from(t.target.files).filter(d=>d.name.endsWith(".json"));if(e.length===0){_.warning("没有找到 JSON 文件");return}const u={};e.forEach(d=>{let s=d.name.replace(".json","");s=s.replace(/[\s\-_]?(questions|answers|structure|decrypted_output|结构)$/i,""),u[s]||(u[s]={name:s,files:[],selected:!0,status:"pending",errorMsg:""}),u[s].files.push(d)}),ve.value=Object.values(u).filter(d=>d.files.length>=3),ve.value.forEach(d=>d.status="ready")},Sa=()=>{ve.value.forEach(t=>{t.status!=="success"&&(t.selected=tl.value)})},ol=ul(()=>ve.value.filter(t=>t.selected&&t.status!=="success").length),qa=t=>({pending:"info",ready:"primary",processing:"warning",success:"success",error:"danger"})[t]||"info",Fa=t=>({pending:"等待",ready:"就绪",processing:"导入中",success:"完成",error:"失败"})[t]||t,Pa=async()=>{var e;if(je.value)return;je.value=!0;const t=ve.value.filter(u=>u.selected&&u.status!=="success");for(const u of t){u.status="processing";try{let d,s,c,S;if(u.files.forEach(X=>{const H=X.name.toLowerCase();H.includes("questions")?s=X:H.includes("answers")?c=X:H.includes("structure")||H.includes("decrypted_output")||H.includes("结构")?S=X:d=X}),!d||!s||!c){u.status="error",u.errorMsg="缺少核心文件";continue}const[L,I,W]=await Promise.all([ce(d),ce(s),ce(c)]),U=L.data||L,Q=((e=I.data)==null?void 0:e.question_list)||I.data||I,E=W.data||W,_e=await f.importPublicData({bookData:U,questions:Array.isArray(Q)?Q:[],answers:Array.isArray(E)?E:[],subject:al.value});if(_e.code===0){const X=_e.data.bookId;if(S){const H=await ce(S);await f.structureBook({bookId:X,chapterData:H})}u.status="success"}else u.status="error",u.errorMsg=_e.msg}catch(d){u.status="error",u.errorMsg="导入异常",console.error(d)}}je.value=!1,_.success("批量导入完成")};return(t,e)=>{const u=x("el-option"),d=x("el-select"),s=x("el-button"),c=x("el-table-column"),S=x("el-tag"),L=x("el-table"),I=x("el-descriptions-item"),W=x("el-descriptions"),U=x("el-input"),Q=x("el-dialog"),E=x("el-tab-pane"),_e=x("el-pagination"),X=x("el-link"),H=x("el-divider"),kl=x("el-checkbox"),Cl=x("el-tabs"),y=x("el-form-item"),T=x("el-col"),Qa=x("el-rate"),ke=x("el-row"),Ce=x("el-input-number"),hl=x("el-switch"),Ee=x("el-form"),Vl=x("el-icon"),Ma=Ea("loading");return v(),m("div",za,[e[115]||(e[115]=g("div",{class:"header"},[g("h2",null,"公共课综合管理")],-1)),a(Cl,{modelValue:rl.value,"onUpdate:modelValue":e[20]||(e[20]=l=>rl.value=l),type:"border-card"},{default:o(()=>[a(E,{label:"纠错反馈",name:"feedback"},{default:o(()=>[g("div",Oa,[a(d,{modelValue:qe.value,"onUpdate:modelValue":e[0]||(e[0]=l=>qe.value=l),placeholder:"科目",onChange:we,clearable:""},{default:o(()=>[a(u,{label:"全部科目",value:""}),(v(!0),m(h,null,V($e.value,l=>(v(),C(u,{key:l.key,label:l.name,value:l.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(d,{modelValue:Ne.value,"onUpdate:modelValue":e[1]||(e[1]=l=>Ne.value=l),placeholder:"处理状态",onChange:we},{default:o(()=>[(v(),m(h,null,V(Ul,(l,k)=>a(u,{key:k,label:l.label,value:k},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(s,{type:"primary",onClick:we},{default:o(()=>[...e[68]||(e[68]=[r("刷新",-1)])]),_:1}),Fe.value.length>0?(v(),m("div",La,[g("span",null,"已选 "+b(Fe.value.length)+" 条",1),a(s,{type:"primary",size:"small",onClick:e[2]||(e[2]=l=>Al(1))},{default:o(()=>[...e[69]||(e[69]=[r("批量处理",-1)])]),_:1})])):B("",!0)]),Y.value?B("",!0):(v(),C(L,{key:0,data:dl.value||[],"row-key":"id",onSelectionChange:ql,style:{width:"100%"}},{default:o(()=>[a(c,{type:"selection",width:"55"}),a(c,{label:"状态",width:"100"},{default:o(l=>[a(S,{type:l.row.status===1?"success":"danger"},{default:o(()=>[r(b(l.row.status===1?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"科目",width:"100"},{default:o(l=>[r(b(Ye(l.row.subject)),1)]),_:1}),a(c,{prop:"type",label:"类型",width:"100"}),a(c,{prop:"content",label:"反馈内容","show-overflow-tooltip":""}),a(c,{prop:"userNickname",label:"用户",width:"120"}),a(c,{prop:"createdAt",label:"时间",width:"180"},{default:o(l=>[r(b(Sl(l.row.createdAt)),1)]),_:1}),a(c,{label:"操作",width:"200"},{default:o(l=>[a(s,{link:"",type:"primary",onClick:k=>Pl(l.row)},{default:o(()=>[...e[70]||(e[70]=[r("详情/处理",-1)])]),_:1},8,["onClick"]),l.row.questionId?(v(),C(s,{key:0,link:"",type:"success",onClick:k=>Ml(l.row)},{default:o(()=>[...e[71]||(e[71]=[r("编辑",-1)])]),_:1},8,["onClick"])):B("",!0)]),_:1})]),_:1},8,["data"])),a(Q,{modelValue:pe.value,"onUpdate:modelValue":e[8]||(e[8]=l=>pe.value=l),title:"反馈详情处理",width:"800px"},{footer:o(()=>[a(s,{onClick:e[6]||(e[6]=l=>pe.value=!1)},{default:o(()=>[...e[74]||(e[74]=[r("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:e[7]||(e[7]=l=>$l(F.value.id,1))},{default:o(()=>[...e[75]||(e[75]=[r("标记已处理并保存",-1)])]),_:1})]),default:o(()=>[F.value?(v(),m("div",Ha,[a(W,{column:1,border:""},{default:o(()=>[a(I,{label:"反馈内容"},{default:o(()=>[r(b(F.value.content),1)]),_:1}),a(I,{label:"关联题目ID"},{default:o(()=>[r(b(F.value.questionId),1)]),_:1})]),_:1}),F.value.questionDetail?(v(),m("div",Ka,[e[73]||(e[73]=g("h4",null,"题目预览",-1)),a(W,{column:2,border:"",size:"small"},{default:o(()=>[a(I,{label:"题型",span:1},{default:o(()=>[r(b(bl(F.value.questionDetail.type)),1)]),_:1}),a(I,{label:"难度",span:1},{default:o(()=>[r(b(F.value.questionDetail.difficulty||"-"),1)]),_:1}),a(I,{label:"年份",span:1},{default:o(()=>[r(b(F.value.questionDetail.year||"-"),1)]),_:1}),a(I,{label:"分值",span:1},{default:o(()=>[r(b(F.value.questionDetail.score||"-"),1)]),_:1}),a(I,{label:"题干",span:2},{default:o(()=>[r(b(F.value.questionDetail.title),1)]),_:1}),a(I,{label:"答案",span:2},{default:o(()=>[r(b(F.value.questionDetail.answer),1)]),_:1}),a(I,{label:"解析",span:2},{default:o(()=>[r(b(F.value.questionDetail.explanation),1)]),_:1})]),_:1}),g("div",Ga,[a(s,{type:"primary",size:"small",onClick:e[3]||(e[3]=l=>Ql(F.value))},{default:o(()=>[...e[72]||(e[72]=[r("编辑该题",-1)])]),_:1})])])):B("",!0),g("div",Wa,[a(U,{modelValue:Pe.value,"onUpdate:modelValue":e[4]||(e[4]=l=>Pe.value=l),type:"textarea",placeholder:"内部备注...",rows:"2"},null,8,["modelValue"]),a(U,{modelValue:Qe.value,"onUpdate:modelValue":e[5]||(e[5]=l=>Qe.value=l),type:"textarea",placeholder:"回复用户...",rows:"2",class:"mt-10"},null,8,["modelValue"])])])):B("",!0)]),_:1},8,["modelValue"])]),_:1}),a(E,{label:"试题管理",name:"question"},{default:o(()=>[g("div",Xa,[a(U,{modelValue:Je.value,"onUpdate:modelValue":e[9]||(e[9]=l=>Je.value=l),placeholder:"搜索题干或题目ID...",style:{width:"200px"},onKeyup:Ta(P,["enter"])},null,8,["modelValue"]),a(d,{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=l=>N.value=l),placeholder:"科目",style:{width:"150px"},onChange:Rl},{default:o(()=>[(v(),m(h,null,V(oe,(l,k)=>a(u,{key:k,label:l.label,value:k},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(d,{modelValue:K.value,"onUpdate:modelValue":e[11]||(e[11]=l=>K.value=l),placeholder:"一级分类",style:{width:"150px"},onChange:ml,clearable:""},{default:o(()=>[(v(!0),m(h,null,V(M.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(d,{modelValue:ue.value,"onUpdate:modelValue":e[12]||(e[12]=l=>ue.value=l),placeholder:"二级分类",style:{width:"150px"},onChange:Tl,clearable:"",disabled:!K.value},{default:o(()=>[(v(!0),m(h,null,V(he.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(d,{modelValue:G.value,"onUpdate:modelValue":e[13]||(e[13]=l=>G.value=l),placeholder:"书籍/试卷",style:{width:"200px"},onChange:Nl,clearable:"",filterable:""},{default:o(()=>[(v(!0),m(h,null,V(Ve.value,l=>(v(),C(u,{key:l.id,label:l.name||l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(d,{modelValue:ne.value,"onUpdate:modelValue":e[14]||(e[14]=l=>ne.value=l),placeholder:"章节",style:{width:"150px"},onChange:Jl,clearable:"",filterable:"",disabled:!G.value},{default:o(()=>[(v(!0),m(h,null,V(Ie.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(s,{type:"primary",onClick:P},{default:o(()=>[...e[76]||(e[76]=[r("搜索",-1)])]),_:1}),a(s,{type:"success",onClick:Ol},{default:o(()=>[...e[77]||(e[77]=[r("新建试题",-1)])]),_:1}),Me.value.length>0?(v(),m("div",Ya,[a(s,{type:"danger",size:"small",onClick:Zl},{default:o(()=>[...e[78]||(e[78]=[r("批量删除",-1)])]),_:1})])):B("",!0)]),Y.value?B("",!0):(v(),C(L,{key:0,data:il.value||[],"row-key":"id",onSelectionChange:Fl,style:{width:"100%"}},{default:o(()=>[a(c,{type:"selection",width:"55"}),a(c,{prop:"id",label:"ID",width:"80"}),a(c,{prop:"bookName",label:"所属书目",width:"150","show-overflow-tooltip":""}),a(c,{prop:"chapterName",label:"章节",width:"150","show-overflow-tooltip":""}),a(c,{prop:"title",label:"题干","show-overflow-tooltip":""}),a(c,{label:"题型",width:"100"},{default:o(l=>[r(b(bl(l.row.type)),1)]),_:1}),a(c,{label:"操作",width:"150"},{default:o(l=>[a(s,{link:"",type:"primary",onClick:k=>Ll(l.row)},{default:o(()=>[...e[79]||(e[79]=[r("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),ze.value>0?(v(),C(_e,{key:1,layout:"total, prev, pager, next, jumper",total:ze.value,"page-size":vl.value,"current-page":ae.value,onCurrentChange:zl},null,8,["total","page-size","current-page"])):B("",!0)]),_:1}),a(E,{label:"书籍试卷管理",name:"book"},{default:o(()=>[g("div",Za,[a(d,{modelValue:$.value,"onUpdate:modelValue":e[15]||(e[15]=l=>$.value=l),placeholder:"科目",style:{width:"150px"},onChange:aa,clearable:""},{default:o(()=>[(v(!0),m(h,null,V($e.value,l=>(v(),C(u,{key:l.value,label:l.name,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(d,{modelValue:se.value,"onUpdate:modelValue":e[16]||(e[16]=l=>se.value=l),placeholder:"二级分类",style:{width:"150px"},onChange:ta,clearable:"",disabled:!$.value},{default:o(()=>[(v(!0),m(h,null,V(Oe.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(s,{type:"primary",onClick:De},{default:o(()=>[...e[80]||(e[80]=[r("搜索",-1)])]),_:1}),a(s,{type:"success",onClick:sa},{default:o(()=>[...e[81]||(e[81]=[r("新建书籍/试卷",-1)])]),_:1})]),a(L,{data:Ze.value,"row-key":"id",style:{width:"100%"},onRowClick:fa},{default:o(()=>[a(c,{prop:"id",label:"ID",width:"80"}),a(c,{prop:"name",label:"名称","show-overflow-tooltip":"","min-width":"150"},{default:o(l=>[a(X,{type:"primary",underline:!1,onClick:Se(k=>el(l.row),["stop"])},{default:o(()=>[r(b(l.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(c,{prop:"short_name",label:"简称",width:"120","show-overflow-tooltip":""}),a(c,{label:"科目",width:"100"},{default:o(l=>[r(b(Ye(l.row.subject)),1)]),_:1}),a(c,{prop:"first_category_id",label:"一级分类ID",width:"100"}),a(c,{prop:"second_category_id",label:"二级分类ID",width:"100"}),a(c,{prop:"third_category_id",label:"三级分类ID",width:"100"}),a(c,{prop:"sort",label:"排序",width:"80"}),a(c,{label:"状态",width:"80"},{default:o(l=>[a(S,{type:l.row.status===1?"success":"danger",size:"small"},{default:o(()=>[r(b(l.row.status===1?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"code_prefix",label:"编码前缀",width:"100"}),a(c,{prop:"next_question_code",label:"下一题编码",width:"100"}),a(c,{label:"操作",width:"280",fixed:"right"},{default:o(l=>[a(s,{link:"",type:"primary",onClick:Se(k=>el(l.row),["stop"])},{default:o(()=>[...e[82]||(e[82]=[r("详情",-1)])]),_:1},8,["onClick"]),a(s,{link:"",type:"primary",onClick:Se(k=>ra(l.row),["stop"])},{default:o(()=>[...e[83]||(e[83]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(s,{link:"",type:"danger",onClick:Se(k=>pa(l.row),["stop"])},{default:o(()=>[...e[84]||(e[84]=[r("删除",-1)])]),_:1},8,["onClick"]),a(s,{link:"",type:"warning",onClick:Se(k=>t.toggleBookStatus(l.row),["stop"])},{default:o(()=>[r(b(l.row.status===1?"下架":"上架"),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Ze.value.length>0?(v(),C(_e,{key:0,layout:"total, prev, pager, next, jumper",total:Ze.value.length,"page-size":20,"current-page":1,class:"mt-20"},null,8,["total"])):B("",!0)]),_:1}),a(E,{label:"题库导入",name:"import"},{default:o(()=>[g("div",et,[e[87]||(e[87]=g("h3",null,"公共题库导入",-1)),e[88]||(e[88]=g("p",{class:"desc"},"选择 3 个 JSON 文件 (书籍、题目、答案) 进行导入",-1)),g("div",lt,[a(d,{modelValue:ll.value,"onUpdate:modelValue":e[17]||(e[17]=l=>ll.value=l),placeholder:"选择科目"},{default:o(()=>[(v(!0),m(h,null,V(A.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.subject},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(s,{type:"primary",onClick:Ua},{default:o(()=>[...e[85]||(e[85]=[r("选择文件",-1)])]),_:1})]),de.value.length>0?(v(),m("div",at,[(v(!0),m(h,null,V(de.value,(l,k)=>(v(),m("div",{key:k,class:"file-item"},b(l.name),1))),128))])):B("",!0),a(s,{type:"success",disabled:de.value.length!==3||Re.value,loading:Re.value,onClick:Da},{default:o(()=>[...e[86]||(e[86]=[r(" 开始导入 ",-1)])]),_:1},8,["disabled","loading"]),ie.value?(v(),m("div",{key:1,class:Na(["import-result",ie.value.success?"success":"error"])},b(ie.value.msg),3)):B("",!0)]),a(H),g("div",tt,[e[92]||(e[92]=g("h3",null,"批量导入",-1)),e[93]||(e[93]=g("p",{class:"desc"},"选择文件夹或多个文件，自动识别并批量导入",-1)),g("div",ot,[a(d,{modelValue:al.value,"onUpdate:modelValue":e[18]||(e[18]=l=>al.value=l),placeholder:"选择科目"},{default:o(()=>[(v(!0),m(h,null,V(A.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.subject},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(s,{type:"primary",onClick:Ba},{default:o(()=>[...e[89]||(e[89]=[r("选择文件夹",-1)])]),_:1}),a(s,{type:"primary",onClick:ja},{default:o(()=>[...e[90]||(e[90]=[r("选择多个文件",-1)])]),_:1})]),ve.value.length>0?(v(),m("div",ut,[g("div",nt,[a(kl,{modelValue:tl.value,"onUpdate:modelValue":e[19]||(e[19]=l=>tl.value=l),onChange:Sa},{default:o(()=>[...e[91]||(e[91]=[r("全选",-1)])]),_:1},8,["modelValue"]),g("span",null,"已选 "+b(ol.value)+" 个",1)]),(v(!0),m(h,null,V(ve.value,(l,k)=>(v(),m("div",{key:k,class:"batch-item"},[a(kl,{modelValue:l.selected,"onUpdate:modelValue":Te=>l.selected=Te,disabled:l.status==="success"},{default:o(()=>[r(b(l.name)+" ("+b(l.files.length)+" 个文件) ",1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),a(S,{type:qa(l.status)},{default:o(()=>[r(b(Fa(l.status)),1)]),_:2},1032,["type"])]))),128))])):B("",!0),a(s,{type:"success",disabled:ol.value===0||je.value,loading:je.value,onClick:Pa},{default:o(()=>[r(" 批量导入 ("+b(ol.value)+") ",1)]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["modelValue"]),a(Q,{modelValue:J.value,"onUpdate:modelValue":e[45]||(e[45]=l=>J.value=l),title:n.value.id?"编辑题目":"添加题目",width:"900px","append-to-body":""},{footer:o(()=>[a(s,{onClick:e[44]||(e[44]=l=>J.value=!1)},{default:o(()=>[...e[97]||(e[97]=[r("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:Wl},{default:o(()=>[...e[98]||(e[98]=[r("保存",-1)])]),_:1})]),default:o(()=>[a(Ee,{model:n.value,"label-width":"120px",class:"question-form"},{default:o(()=>[a(ke,{gutter:20},{default:o(()=>[a(T,{span:12},{default:o(()=>[a(y,{label:"题型"},{default:o(()=>[a(d,{modelValue:n.value.type,"onUpdate:modelValue":e[21]||(e[21]=l=>n.value.type=l),placeholder:"选择题型",style:{width:"100%"}},{default:o(()=>[(v(),m(h,null,V(Dl,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(T,{span:12},{default:o(()=>[a(y,{label:"难度"},{default:o(()=>[a(Qa,{modelValue:n.value.difficulty,"onUpdate:modelValue":e[22]||(e[22]=l=>n.value.difficulty=l),colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,{label:"纯文本题干"},{default:o(()=>[a(U,{modelValue:n.value.title,"onUpdate:modelValue":e[23]||(e[23]=l=>n.value.title=l),type:"textarea",rows:"2",placeholder:"请输入题干"},null,8,["modelValue"])]),_:1}),a(y,{label:"题干(富文本)"},{default:o(()=>[g("div",st,[a(s,{type:"primary",link:"",onClick:e[24]||(e[24]=l=>Z.value=!Z.value)},{default:o(()=>[r(b(Z.value?"收起富文本编辑器":q(n.value.title_richtext)?"编辑富文本(已设置)":"展开富文本编辑器"),1)]),_:1}),Z.value?(v(),m("div",rt,[a(sl,{modelValue:n.value.title_richtext,"onUpdate:modelValue":e[25]||(e[25]=l=>n.value.title_richtext=l),height:200,placeholder:"请输入富文本题干..."},null,8,["modelValue"])])):q(n.value.title_richtext)?(v(),m("div",{key:1,class:"richtext-preview",innerHTML:n.value.title_richtext},null,8,dt)):B("",!0)])]),_:1}),a(H,{"content-position":"left"},{default:o(()=>[...e[94]||(e[94]=[r("所属分类与位置",-1)])]),_:1}),a(ke,{gutter:20},{default:o(()=>[a(T,{span:12},{default:o(()=>[a(y,{label:"科目"},{default:o(()=>[a(d,{modelValue:n.value.subject,"onUpdate:modelValue":e[26]||(e[26]=l=>n.value.subject=l),placeholder:"选择科目",style:{width:"100%"},disabled:""},{default:o(()=>[(v(!0),m(h,null,V(A.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.subject},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(T,{span:12},{default:o(()=>[a(y,{label:"一级分类"},{default:o(()=>[a(d,{modelValue:n.value.firstCategoryId,"onUpdate:modelValue":e[27]||(e[27]=l=>n.value.firstCategoryId=l),placeholder:"选择一级分类",style:{width:"100%"},onChange:Hl,clearable:""},{default:o(()=>[(v(!0),m(h,null,V(M.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(ke,{gutter:20},{default:o(()=>[a(T,{span:12},{default:o(()=>[a(y,{label:"二级分类"},{default:o(()=>[a(d,{modelValue:n.value.secondCategoryId,"onUpdate:modelValue":e[28]||(e[28]=l=>n.value.secondCategoryId=l),placeholder:"选择二级分类",style:{width:"100%"},onChange:Kl,disabled:!n.value.firstCategoryId,clearable:""},{default:o(()=>[(v(!0),m(h,null,V(xe.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a(T,{span:12},{default:o(()=>[a(y,{label:"书籍/试卷"},{default:o(()=>[a(d,{modelValue:n.value.bookId,"onUpdate:modelValue":e[29]||(e[29]=l=>n.value.bookId=l),placeholder:"选择书籍/试卷",style:{width:"100%"},onChange:Gl,disabled:!n.value.secondCategoryId,clearable:""},{default:o(()=>[(v(!0),m(h,null,V(te.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(ke,{gutter:20},{default:o(()=>[a(T,{span:12},{default:o(()=>[a(y,{label:"章节"},{default:o(()=>[a(d,{modelValue:n.value.chapterId,"onUpdate:modelValue":e[30]||(e[30]=l=>n.value.chapterId=l),placeholder:"选择章节",style:{width:"100%"},disabled:!n.value.bookId,clearable:""},{default:o(()=>[(v(!0),m(h,null,V(z.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),[1,2].includes(n.value.type)?(v(),C(y,{key:0,label:"选项"},{default:o(()=>[g("div",it,[(v(!0),m(h,null,V(n.value.options||[],(l,k)=>(v(),m("div",{key:k,class:"option-item"},[g("div",vt,[g("span",ct,b(String.fromCharCode(65+k)),1),a(U,{modelValue:n.value.options[k],"onUpdate:modelValue":Te=>n.value.options[k]=Te,type:"textarea",rows:2,placeholder:"选项内容",class:"option-input"},null,8,["modelValue","onUpdate:modelValue"]),a(s,{link:"",type:"danger",onClick:Te=>Yl(k)},{default:o(()=>[...e[95]||(e[95]=[r("删除",-1)])]),_:1},8,["onClick"])])]))),128))]),a(s,{type:"primary",link:"",onClick:Xl,class:"mt-10"},{default:o(()=>[...e[96]||(e[96]=[r("+ 添加选项",-1)])]),_:1})]),_:1})):B("",!0),a(y,{label:"答案"},{default:o(()=>[a(U,{modelValue:n.value.answer,"onUpdate:modelValue":e[31]||(e[31]=l=>n.value.answer=l),placeholder:"如: A 或 AB"},null,8,["modelValue"])]),_:1}),a(y,{label:"答案(富文本)"},{default:o(()=>[g("div",pt,[a(s,{type:"primary",link:"",onClick:e[32]||(e[32]=l=>ee.value=!ee.value)},{default:o(()=>[r(b(ee.value?"收起富文本编辑器":q(n.value.answer_richtext)?"编辑富文本(已设置)":"展开富文本编辑器"),1)]),_:1}),ee.value?(v(),m("div",ft,[a(sl,{modelValue:n.value.answer_richtext,"onUpdate:modelValue":e[33]||(e[33]=l=>n.value.answer_richtext=l),height:150,placeholder:"请输入富文本答案..."},null,8,["modelValue"])])):q(n.value.answer_richtext)?(v(),m("div",{key:1,class:"richtext-preview",innerHTML:n.value.answer_richtext},null,8,mt)):B("",!0)])]),_:1}),a(y,{label:"解析/知识点"},{default:o(()=>[g("div",bt,[a(s,{type:"primary",link:"",onClick:e[34]||(e[34]=l=>le.value=!le.value)},{default:o(()=>[r(b(le.value?"收起富文本编辑器":q(n.value.explanation)?"编辑富文本(已设置)":"展开富文本编辑器"),1)]),_:1}),le.value?(v(),m("div",yt,[a(sl,{modelValue:n.value.explanation,"onUpdate:modelValue":e[35]||(e[35]=l=>n.value.explanation=l),height:200,placeholder:"请输入解析或知识点详情..."},null,8,["modelValue"])])):q(n.value.explanation)?(v(),m("div",{key:1,class:"richtext-preview",innerHTML:n.value.explanation},null,8,gt)):B("",!0)])]),_:1}),a(ke,{gutter:20},{default:o(()=>[a(T,{span:8},{default:o(()=>[a(y,{label:"年份"},{default:o(()=>[a(U,{modelValue:n.value.year,"onUpdate:modelValue":e[36]||(e[36]=l=>n.value.year=l),placeholder:"如: 2023"},null,8,["modelValue"])]),_:1})]),_:1}),a(T,{span:8},{default:o(()=>[a(y,{label:"分值"},{default:o(()=>[a(Ce,{modelValue:n.value.score,"onUpdate:modelValue":e[37]||(e[37]=l=>n.value.score=l),min:0,max:100},null,8,["modelValue"])]),_:1})]),_:1}),a(T,{span:8},{default:o(()=>[a(y,{label:"排序"},{default:o(()=>[a(Ce,{modelValue:n.value.sort,"onUpdate:modelValue":e[38]||(e[38]=l=>n.value.sort=l),min:0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(ke,{gutter:20},{default:o(()=>[a(T,{span:12},{default:o(()=>[a(y,{label:"原始题号"},{default:o(()=>[a(U,{modelValue:n.value.original_book_number,"onUpdate:modelValue":e[39]||(e[39]=l=>n.value.original_book_number=l),placeholder:"原始书籍中的题号"},null,8,["modelValue"])]),_:1})]),_:1}),a(T,{span:12},{default:o(()=>[a(y,{label:"题源"},{default:o(()=>[a(U,{modelValue:n.value.question_source,"onUpdate:modelValue":e[40]||(e[40]=l=>n.value.question_source=l),placeholder:"题目来源"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,{label:"口诀"},{default:o(()=>[a(U,{modelValue:n.value.mnemonic,"onUpdate:modelValue":e[41]||(e[41]=l=>n.value.mnemonic=l),type:"textarea",rows:"2",placeholder:"记忆口诀（针对知识卡）"},null,8,["modelValue"])]),_:1}),a(y,{label:"多媒体链接"},{default:o(()=>[a(U,{modelValue:n.value.media,"onUpdate:modelValue":e[42]||(e[42]=l=>n.value.media=l),placeholder:"图片或视频链接"},null,8,["modelValue"])]),_:1}),a(y,{label:"状态"},{default:o(()=>[a(hl,{modelValue:n.value.status,"onUpdate:modelValue":e[43]||(e[43]=l=>n.value.status=l),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(Q,{modelValue:fe.value,"onUpdate:modelValue":e[55]||(e[55]=l=>fe.value=l),title:p.value.id?"编辑书籍/试卷":"添加书籍/试卷",width:"550px"},{footer:o(()=>[a(s,{onClick:e[54]||(e[54]=l=>fe.value=!1)},{default:o(()=>[...e[103]||(e[103]=[r("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:ca},{default:o(()=>[...e[104]||(e[104]=[r("保存",-1)])]),_:1})]),default:o(()=>[a(Ee,{model:p.value,"label-width":"120px"},{default:o(()=>[a(y,{label:"名称"},{default:o(()=>[a(U,{modelValue:p.value.name,"onUpdate:modelValue":e[46]||(e[46]=l=>p.value.name=l),placeholder:"请输入书籍/试卷名称"},null,8,["modelValue"])]),_:1}),a(y,{label:"科目",required:""},{default:o(()=>[a(d,{modelValue:p.value.subject,"onUpdate:modelValue":e[47]||(e[47]=l=>p.value.subject=l),placeholder:"选择科目",style:{width:"100%"},onChange:va},{default:o(()=>[(v(!0),m(h,null,V(A.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.subject},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p.value.id?B("",!0):(v(),C(y,{key:0,label:"编码前缀"},{default:o(()=>[a(U,{modelValue:p.value.code_prefix,"onUpdate:modelValue":e[48]||(e[48]=l=>p.value.code_prefix=l),placeholder:"如: M001, P001, E001",maxlength:"10","show-word-limit":""},null,8,["modelValue"]),e[99]||(e[99]=g("div",{class:"field-hint"},"用于生成题目ID，建议格式：科目首字母+3位数字（如M001表示数学001）",-1))]),_:1})),a(y,{label:"一级分类"},{default:o(()=>[g("div",wt,[a(d,{modelValue:p.value.first_category_id,"onUpdate:modelValue":e[49]||(e[49]=l=>p.value.first_category_id=l),placeholder:"选择一级分类",onChange:da,clearable:"",style:{width:"320px"}},{default:o(()=>[(v(!0),m(h,null,V(A.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(s,{type:"primary",onClick:Ca},{default:o(()=>[...e[100]||(e[100]=[r("新建",-1)])]),_:1})])]),_:1}),a(y,{label:"二级分类"},{default:o(()=>[g("div",_t,[a(d,{modelValue:p.value.second_category_id,"onUpdate:modelValue":e[50]||(e[50]=l=>p.value.second_category_id=l),placeholder:"选择二级分类",onChange:ia,clearable:"",disabled:!p.value.first_category_id,style:{width:"320px"}},{default:o(()=>[(v(!0),m(h,null,V(R.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(s,{type:"primary",disabled:!p.value.first_category_id,onClick:ha},{default:o(()=>[...e[101]||(e[101]=[r("新建",-1)])]),_:1},8,["disabled"])])]),_:1}),a(y,{label:"三级分类"},{default:o(()=>[g("div",kt,[a(d,{modelValue:p.value.third_category_id,"onUpdate:modelValue":e[51]||(e[51]=l=>p.value.third_category_id=l),placeholder:"选择三级分类",clearable:"",disabled:!p.value.second_category_id,style:{width:"320px"}},{default:o(()=>[(v(!0),m(h,null,V(O.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(s,{type:"primary",disabled:!p.value.second_category_id,onClick:Va},{default:o(()=>[...e[102]||(e[102]=[r("新建",-1)])]),_:1},8,["disabled"])])]),_:1}),a(y,{label:"排序"},{default:o(()=>[a(Ce,{modelValue:p.value.sort,"onUpdate:modelValue":e[52]||(e[52]=l=>p.value.sort=l),min:0},null,8,["modelValue"])]),_:1}),a(y,{label:"状态"},{default:o(()=>[a(hl,{modelValue:p.value.status,"onUpdate:modelValue":e[53]||(e[53]=l=>p.value.status=l),"active-value":1,"inactive-value":0,"active-text":"上架","inactive-text":"下架"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(Q,{modelValue:re.value,"onUpdate:modelValue":e[59]||(e[59]=l=>re.value=l),title:j.value.level===1?"新建一级分类":j.value.level===2?"新建二级分类":"新建三级分类",width:"400px"},{footer:o(()=>[a(s,{onClick:e[58]||(e[58]=l=>re.value=!1)},{default:o(()=>[...e[105]||(e[105]=[r("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:Ia},{default:o(()=>[...e[106]||(e[106]=[r("保存",-1)])]),_:1})]),default:o(()=>[a(Ee,{model:j.value,"label-width":"100px"},{default:o(()=>[a(y,{label:"名称"},{default:o(()=>[a(U,{modelValue:j.value.name,"onUpdate:modelValue":e[56]||(e[56]=l=>j.value.name=l),placeholder:j.value.level===1?"请输入一级分类名称":j.value.level===2?"请输入二级分类名称":"请输入三级分类名称"},null,8,["modelValue","placeholder"])]),_:1}),a(y,{label:"排序"},{default:o(()=>[a(Ce,{modelValue:j.value.sort,"onUpdate:modelValue":e[57]||(e[57]=l=>j.value.sort=l),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(Q,{modelValue:me.value,"onUpdate:modelValue":e[64]||(e[64]=l=>me.value=l),title:D.value.id?"编辑章节":"添加章节",width:"500px"},{footer:o(()=>[a(s,{onClick:e[63]||(e[63]=l=>me.value=!1)},{default:o(()=>[...e[107]||(e[107]=[r("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:xa},{default:o(()=>[...e[108]||(e[108]=[r("保存",-1)])]),_:1})]),default:o(()=>[a(Ee,{model:D.value,"label-width":"100px"},{default:o(()=>[a(y,{label:"名称"},{default:o(()=>[a(U,{modelValue:D.value.name,"onUpdate:modelValue":e[60]||(e[60]=l=>D.value.name=l)},null,8,["modelValue"])]),_:1}),a(y,{label:"排序"},{default:o(()=>[a(Ce,{modelValue:D.value.sort_order,"onUpdate:modelValue":e[61]||(e[61]=l=>D.value.sort_order=l)},null,8,["modelValue"])]),_:1}),a(y,{label:"层级"},{default:o(()=>[a(Ce,{modelValue:D.value.level,"onUpdate:modelValue":e[62]||(e[62]=l=>D.value.level=l),min:1,max:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(Q,{modelValue:be.value,"onUpdate:modelValue":e[67]||(e[67]=l=>be.value=l),title:`书籍详情: ${w.value.name||""}`,width:"90%",fullscreen:!1,"close-on-click-modal":!1,onClose:ma},{default:o(()=>[Ja((v(),m("div",null,[a(W,{column:4,border:"",class:"mb-20"},{default:o(()=>[a(I,{label:"ID"},{default:o(()=>[r(b(w.value.id),1)]),_:1}),a(I,{label:"名称"},{default:o(()=>[r(b(w.value.name),1)]),_:1}),a(I,{label:"简称"},{default:o(()=>[r(b(w.value.short_name||"-"),1)]),_:1}),a(I,{label:"科目"},{default:o(()=>[r(b(Ye(w.value.subject)),1)]),_:1}),a(I,{label:"编码前缀"},{default:o(()=>[r(b(w.value.code_prefix||"-"),1)]),_:1}),a(I,{label:"下一题编码"},{default:o(()=>[r(b(w.value.next_question_code||1),1)]),_:1}),a(I,{label:"状态"},{default:o(()=>[a(S,{type:w.value.status===1?"success":"danger"},{default:o(()=>[r(b(w.value.status===1?"上架":"下架"),1)]),_:1},8,["type"])]),_:1}),a(I,{label:"排序"},{default:o(()=>[r(b(w.value.sort||0),1)]),_:1})]),_:1}),a(Cl,{modelValue:Ge.value,"onUpdate:modelValue":e[66]||(e[66]=l=>Ge.value=l)},{default:o(()=>[a(E,{label:"章节管理",name:"chapters"},{default:o(()=>[g("div",Ct,[g("h3",null,"章节列表 ("+b(Ue.value.length)+")",1),a(s,{type:"primary",onClick:ba},{default:o(()=>[a(Vl,null,{default:o(()=>[a(Il(xl))]),_:1}),e[109]||(e[109]=r("添加章节 ",-1))]),_:1})]),a(L,{data:Ue.value,"row-key":"id",style:{width:"100%"}},{default:o(()=>[a(c,{prop:"id",label:"ID",width:"80"}),a(c,{prop:"name",label:"章节名称","min-width":"200","show-overflow-tooltip":""}),a(c,{prop:"sort_order",label:"排序",width:"80"}),a(c,{prop:"question_count",label:"题目数量",width:"100"},{default:o(l=>[r(b(ye.value.filter(k=>k.chapterId===l.row.id).length),1)]),_:1}),a(c,{label:"操作",width:"200",fixed:"right"},{default:o(l=>[a(s,{link:"",type:"primary",onClick:k=>ya(l.row)},{default:o(()=>[...e[110]||(e[110]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(s,{link:"",type:"danger",onClick:k=>ga(l.row)},{default:o(()=>[...e[111]||(e[111]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(E,{label:"题目管理",name:"questions"},{default:o(()=>[g("div",ht,[g("h3",null,"题目列表 ("+b(ye.value.length)+")",1),g("div",Vt,[a(d,{modelValue:ge.value,"onUpdate:modelValue":e[65]||(e[65]=l=>ge.value=l),placeholder:"筛选章节",clearable:"",style:{width:"200px"}},{default:o(()=>[(v(!0),m(h,null,V(Ue.value,l=>(v(),C(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(s,{type:"primary",onClick:wa},{default:o(()=>[a(Vl,null,{default:o(()=>[a(Il(xl))]),_:1}),e[112]||(e[112]=r("添加题目 ",-1))]),_:1})])]),a(L,{data:ea.value,"row-key":"id",style:{width:"100%"}},{default:o(()=>[a(c,{prop:"id",label:"ID",width:"80"}),a(c,{prop:"question_code",label:"题号",width:"100"}),a(c,{label:"题型",width:"100"},{default:o(l=>[r(b(la(l.row.type)),1)]),_:1}),a(c,{prop:"title",label:"题干","min-width":"200","show-overflow-tooltip":""}),a(c,{prop:"chapterName",label:"所属章节",width:"150","show-overflow-tooltip":""}),a(c,{label:"状态",width:"80"},{default:o(l=>[a(S,{type:l.row.status===1?"success":"danger",size:"small"},{default:o(()=>[r(b(l.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"操作",width:"150",fixed:"right"},{default:o(l=>[a(s,{link:"",type:"primary",onClick:k=>_a(l.row)},{default:o(()=>[...e[113]||(e[113]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(s,{link:"",type:"danger",onClick:k=>ka(l.row)},{default:o(()=>[...e[114]||(e[114]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])])),[[Ma,We.value]])]),_:1},8,["modelValue","title"])])}}},jt=$a(It,[["__scopeId","data-v-af02e182"]]);export{jt as default};
