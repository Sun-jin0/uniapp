import{_ as de,i as pe,o as i,c as m,a as l,w as o,p as _,r as n,f as s,D as me,e as d,F as x,y as $,n as _e,t as A,z,m as ve,b as fe,d as v,C as K,S as ge,G as T,E as C}from"./index-CYafs7gL.js";const ye={class:"database-manage"},Ce={class:"section-header"},he=["onClick"],we={class:"col-name"},be={class:"col-count"},ke={class:"header-actions"},De={class:"left"},Ve={class:"right"},xe={class:"pagination-container"},ze={key:1,class:"welcome-container"},Se={__name:"DatabaseManage",setup(Be){const S=s([]),c=s(""),B=s([]),w=s([]),E=s(!1),M=s(!1),b=s(""),f=s(1),k=s(20),F=s(0),g=s(!1),D=s(!1),r=s({}),N=async()=>{try{const e=await _.getCollections();e.code===0&&(S.value=e.data||[])}catch(e){console.error("加载集合列表失败:",e)}},q=async e=>{c.value=e.name,f.value=1,b.value="",await p(),await G()},p=async()=>{var e;if(c.value){E.value=!0;try{const a={page:f.value,limit:k.value,query:b.value},h=await _.getCollectionData(c.value,a);h.code===0&&(B.value=h.data.documents||[],F.value=((e=h.data.pagination)==null?void 0:e.total)||B.value.length)}catch(a){console.error("加载文档失败:",a)}finally{E.value=!1}}},G=async()=>{try{const e=await _.getCollectionFields(c.value);e.code===0&&(w.value=e.data||[])}catch(e){console.error("加载字段失败:",e)}},U=()=>{f.value=1,p()},I=e=>{k.value=e,p()},J=e=>{f.value=e,p()},L=()=>{r.value={},w.value.forEach(e=>{e!=="_id"&&(r.value[e]="")}),D.value=!1,g.value=!0},O=e=>{r.value={...e},D.value=!0,g.value=!0},Q=async()=>{M.value=!0;try{let e;D.value?e=await _.updateCollectionDoc(c.value,r.value._id,r.value):e=await _.createCollectionDoc(c.value,r.value),e.code===0&&(C.success("保存成功"),g.value=!1,p())}catch{C.error("保存失败")}finally{M.value=!1}},H=e=>{T.confirm("确定要删除这条记录吗？","提示",{type:"warning"}).then(async()=>{try{(await _.deleteCollectionDoc(c.value,e)).code===0&&(C.success("删除成功"),p())}catch{C.error("删除失败")}}).catch(()=>{})},W=()=>{T.confirm(`确定要清空 ${c.value} 集合吗？此操作不可恢复！`,"警告",{type:"danger",confirmButtonText:"确定清空",confirmButtonClass:"el-button--danger"}).then(async()=>{try{(await _.clearCollection(c.value)).code===0&&(C.success("集合已清空"),p(),N())}catch{C.error("清空失败")}}).catch(()=>{})},X=e=>e==null||e===""?"-":typeof e=="object"?JSON.stringify(e):typeof e=="boolean"?e?"是":"否":String(e);return pe(()=>{N()}),(e,a)=>{const h=n("Refresh"),V=n("el-icon"),u=n("el-button"),P=n("el-empty"),Y=n("el-scrollbar"),Z=n("el-aside"),ee=n("Search"),R=n("el-input"),te=n("Plus"),ae=n("Delete"),j=n("el-table-column"),le=n("el-table"),oe=n("el-pagination"),ne=n("el-main"),se=n("el-container"),ce=n("el-form-item"),ie=n("el-form"),re=n("el-dialog"),ue=me("loading");return i(),m("div",ye,[l(se,{class:"db-container"},{default:o(()=>[l(Z,{width:"250px",class:"collection-aside"},{default:o(()=>[d("div",Ce,[a[5]||(a[5]=d("span",{class:"title"},"数据集合 (Collections)",-1)),l(u,{link:"",type:"primary",onClick:N},{default:o(()=>[l(V,null,{default:o(()=>[l(h)]),_:1})]),_:1})]),l(Y,null,{default:o(()=>[(i(!0),m(x,null,$(S.value,t=>(i(),m("div",{key:t.name,class:_e(["collection-item",{active:c.value===t.name}]),onClick:y=>q(t)},[d("div",we,A(t.name),1),d("div",be,A(t.count)+" 条记录",1)],10,he))),128)),S.value.length===0?(i(),z(P,{key:0,description:"暂无集合","image-size":60})):ve("",!0)]),_:1})]),_:1}),l(ne,{class:"data-main"},{default:o(()=>[c.value?(i(),m(x,{key:0},[d("div",ke,[d("div",De,[l(R,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=t=>b.value=t),placeholder:"搜索记录...",class:"search-input",clearable:"",onClear:U,onKeyup:fe(U,["enter"])},{append:o(()=>[l(u,{onClick:U},{default:o(()=>[l(V,null,{default:o(()=>[l(ee)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(u,{type:"primary",onClick:L},{default:o(()=>[l(V,null,{default:o(()=>[l(te)]),_:1}),a[6]||(a[6]=v(" 添加记录 ",-1))]),_:1})]),d("div",Ve,[l(u,{type:"danger",plain:"",onClick:W},{default:o(()=>[l(V,null,{default:o(()=>[l(ae)]),_:1}),a[7]||(a[7]=v(" 清空集合 ",-1))]),_:1})])]),K((i(),z(le,{data:B.value,border:"",stripe:"",style:{width:"100%"},height:"calc(100vh - 280px)"},{default:o(()=>[(i(!0),m(x,null,$(w.value,t=>(i(),z(j,{key:t,prop:t,label:t,"min-width":"150","show-overflow-tooltip":""},{default:o(({row:y})=>[v(A(X(y[t])),1)]),_:2},1032,["prop","label"]))),128)),l(j,{label:"操作",width:"150",align:"center",fixed:"right"},{default:o(({row:t})=>[l(u,{size:"small",onClick:y=>O(t)},{default:o(()=>[...a[8]||(a[8]=[v("编辑",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:"danger",onClick:y=>H(t._id)},{default:o(()=>[...a[9]||(a[9]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,E.value]]),d("div",xe,[l(oe,{"current-page":f.value,"onUpdate:currentPage":a[1]||(a[1]=t=>f.value=t),"page-size":k.value,"onUpdate:pageSize":a[2]||(a[2]=t=>k.value=t),"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:F.value,onSizeChange:I,onCurrentChange:J},null,8,["current-page","page-size","total"])])],64)):(i(),m("div",ze,[l(P,{description:"请从左侧选择一个集合开始管理","image-size":200})]))]),_:1})]),_:1}),l(re,{modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=t=>g.value=t),title:D.value?"编辑记录":"添加记录",width:"600px","destroy-on-close":""},{footer:o(()=>[l(u,{onClick:a[3]||(a[3]=t=>g.value=!1)},{default:o(()=>[...a[10]||(a[10]=[v("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:Q,loading:M.value},{default:o(()=>[...a[11]||(a[11]=[v("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(ie,{model:r.value,"label-width":"120px",class:"edit-form"},{default:o(()=>[(i(!0),m(x,null,$(w.value,t=>K((i(),z(ce,{key:t,label:t},{default:o(()=>[l(R,{modelValue:r.value[t],"onUpdate:modelValue":y=>r.value[t]=y,placeholder:`请输入 ${t}`,type:"textarea",autosize:{minRows:1,maxRows:4}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])),[[ge,t!=="_id"&&t!=="createdAt"&&t!=="updatedAt"]])),128))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Me=de(Se,[["__scopeId","data-v-933a9f9e"]]);export{Me as default};
