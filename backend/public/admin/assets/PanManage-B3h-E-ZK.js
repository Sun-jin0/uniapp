import{_ as Be,i as $e,o as f,c as P,e as y,a,w as o,b as Ne,z as U,m as S,C as Oe,p as m,f as s,r as u,D as Me,F as oe,y as ne,d as r,t as V,E as i,G as H}from"./index-CYafs7gL.js";const Ae={class:"pan-manage"},Qe={class:"header-actions"},Ee={class:"left"},Fe={class:"right"},qe={class:"title-cell"},Ke={class:"title-text"},Le={key:0,class:"link-item"},je={key:1,class:"link-item"},Ge={class:"pagination-container"},We={class:"category-modal-body"},He={class:"add-cat-form"},Je={class:"sync-tips"},Xe={__name:"PanManage",setup(Ye){const Q=s(!1),E=s(!1),J=s([]),z=s([]),X=s([]),R=s(""),F=s(""),C=s([]),w=s(1),B=s(20),Y=s(0),k=s(!1),$=s(!1),n=s({ResourceID:null,Title:"",Category:"",QuarkUrl:"",BaiduUrl:"",Description:"",IsNew:!1,IsTop:0,SortOrder:0}),q=s(!1),x=s(""),I=s(!1),N=s(""),K=s(!1),T=s(!1),h=s([]),L=s(!1),g=async()=>{Q.value=!0;try{const t={page:w.value,limit:B.value,search:F.value,category:R.value},e=await m.getPanResources(t);e.code===0&&(J.value=e.data.list||e.data||[],Y.value=e.data.total||(Array.isArray(e.data)?e.data.length:0))}catch(t){console.error("获取资源失败:",t)}finally{Q.value=!1}},b=async()=>{try{const t=await m.getPanCategories();t.code===0&&(z.value=t.data||[])}catch(t){console.error("获取分类失败:",t)}},j=async()=>{try{const t=await m.getPanCategories(!0);t.code===0&&(X.value=t.data||[])}catch(t){console.error("获取完整分类失败:",t)}},O=()=>{w.value=1,g()},re=t=>{B.value=t,g()},se=t=>{w.value=t,g()},ue=t=>{C.value=t.map(e=>e.ResourceID)},de=()=>{n.value={ResourceID:null,Title:"",Category:R.value||z.value[0]||"",QuarkUrl:"",BaiduUrl:"",Description:"",IsNew:!1},$.value=!1,k.value=!0},ie=t=>{n.value={...t},$.value=!0,k.value=!0},pe=async()=>{if(!n.value.Title||!n.value.Category)return i.warning("标题和分类必填");E.value=!0;try{let t;$.value?t=await m.updatePanResource(n.value.ResourceID,n.value):t=await m.createPanResource(n.value),t.code===0&&(i.success("保存成功"),k.value=!1,g(),b())}catch{i.error("保存失败")}finally{E.value=!1}},ce=t=>{H.confirm("确定要删除该资源吗？","提示",{type:"warning"}).then(async()=>{try{(await m.deletePanResource(t.ResourceID)).code===0&&(i.success("删除成功"),g())}catch{i.error("删除失败")}}).catch(()=>{})},me=async t=>{try{(await m.updatePanResourceTop(t.ResourceID,{isTop:t.IsTop})).code===0&&(i.success(t.IsTop?"置顶成功":"取消置顶成功"),g())}catch{i.error("操作失败"),t.IsTop=t.IsTop?0:1}},ve=async t=>{try{(await m.updatePanResourceSort(t.ResourceID,{sortOrder:t.SortOrder})).code===0&&(i.success("排序更新成功"),g())}catch{i.error("排序更新失败")}},fe=()=>{H.confirm(`确定要批量删除选中的 ${C.value.length} 条资源吗？`,"警告",{type:"danger"}).then(async()=>{try{(await m.batchDeletePanResources({ids:C.value})).code===0&&(i.success("批量删除成功"),C.value=[],g())}catch{i.error("批量删除失败")}}).catch(()=>{})},ge=async()=>{if(x.value.trim())try{(await m.createPanCategory({name:x.value.trim()})).code===0&&(x.value="",j(),b())}catch{i.error("添加分类失败")}},ye=async t=>{try{await m.updatePanCategory(t.CategoryID,{name:t.CategoryName,sortOrder:t.SortOrder}),b()}catch(e){console.error("更新分类失败:",e)}},_e=t=>{H.confirm(`确定要删除分类“${t.CategoryName}”吗？`,"提示",{type:"warning"}).then(async()=>{try{(await m.deletePanCategory(t.CategoryID)).code===0&&(j(),b())}catch{i.error("删除失败")}}).catch(()=>{})},Ve=async()=>{if(!N.value.trim())return i.warning("请粘贴文本");K.value=!0;try{const t=await m.parsePanResources({rawText:N.value});t.code===0&&(t.data.length===0?i.warning("未识别到任何资源"):(h.value=t.data,I.value=!1,T.value=!0))}catch{i.error("解析失败")}finally{K.value=!1}},Ce=t=>{h.value.splice(t,1)},ke=async()=>{if(h.value.length!==0){L.value=!0;try{const t=await m.importPanResources({resources:h.value});t.code===0&&(i.success(`导入成功: 新增${t.data.createdCount}, 更新${t.data.updatedCount}`),T.value=!1,g(),b())}catch{i.error("导入失败")}finally{L.value=!1}}},he=t=>({create:"success",update:"warning",supplement:"info",ignore:"danger"})[t]||"info",be=t=>({create:"新增",update:"更新",supplement:"补充",ignore:"忽略"})[t]||t,Ue=t=>t?new Date(t).toLocaleString():"-";return $e(()=>{g(),b(),j()}),(t,e)=>{const we=u("Search"),M=u("el-icon"),p=u("el-button"),v=u("el-input"),Z=u("el-option"),ee=u("el-select"),xe=u("Plus"),Ie=u("Connection"),Te=u("FolderOpened"),c=u("el-table-column"),le=u("el-input-number"),G=u("el-switch"),D=u("el-tag"),ae=u("el-link"),W=u("el-table"),De=u("el-pagination"),_=u("el-form-item"),te=u("el-col"),Pe=u("el-row"),Se=u("el-form"),A=u("el-dialog"),ze=u("el-alert"),Re=Me("loading");return f(),P("div",Ae,[y("div",Qe,[y("div",Ee,[a(v,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=l=>F.value=l),placeholder:"搜索资源标题...",class:"search-input",clearable:"",onClear:O,onKeyup:Ne(O,["enter"])},{append:o(()=>[a(p,{onClick:O},{default:o(()=>[a(M,null,{default:o(()=>[a(we)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ee,{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=l=>R.value=l),placeholder:"全部分类",onChange:O,clearable:"",class:"category-select"},{default:o(()=>[(f(!0),P(oe,null,ne(z.value,l=>(f(),U(Z,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(p,{type:"primary",onClick:de},{default:o(()=>[a(M,null,{default:o(()=>[a(xe)]),_:1}),e[23]||(e[23]=r(" 添加资源 ",-1))]),_:1}),a(p,{type:"success",onClick:e[2]||(e[2]=l=>I.value=!0)},{default:o(()=>[a(M,null,{default:o(()=>[a(Ie)]),_:1}),e[24]||(e[24]=r(" 批量获取 ",-1))]),_:1})]),y("div",Fe,[a(p,{onClick:e[3]||(e[3]=l=>q.value=!0)},{default:o(()=>[a(M,null,{default:o(()=>[a(Te)]),_:1}),e[25]||(e[25]=r(" 分类管理 ",-1))]),_:1}),C.value.length>0?(f(),U(p,{key:0,type:"danger",onClick:fe},{default:o(()=>[r(" 批量删除 ("+V(C.value.length)+") ",1)]),_:1})):S("",!0)])]),Oe((f(),U(W,{data:J.value,border:"",stripe:"",style:{width:"100%"},onSelectionChange:ue},{default:o(()=>[a(c,{type:"selection",width:"55"}),a(c,{label:"排序",width:"100",align:"center"},{default:o(({row:l})=>[a(le,{modelValue:l.SortOrder,"onUpdate:modelValue":d=>l.SortOrder=d,min:0,max:999,size:"small",style:{width:"70px"},onChange:d=>ve(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(c,{label:"置顶",width:"80",align:"center"},{default:o(({row:l})=>[a(G,{modelValue:l.IsTop,"onUpdate:modelValue":d=>l.IsTop=d,"active-value":1,"inactive-value":0,onChange:d=>me(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(c,{label:"资源标题","min-width":"200"},{default:o(({row:l})=>[y("div",qe,[l.IsTop?(f(),U(D,{key:0,size:"small",type:"danger",effect:"dark",class:"mr-5"},{default:o(()=>[...e[26]||(e[26]=[r("置顶",-1)])]),_:1})):S("",!0),l.IsNew?(f(),U(D,{key:1,size:"small",type:"warning",effect:"dark",class:"mr-5"},{default:o(()=>[...e[27]||(e[27]=[r("NEW",-1)])]),_:1})):S("",!0),y("span",Ke,V(l.Title),1)])]),_:1}),a(c,{prop:"Category",label:"分类",width:"120",align:"center"}),a(c,{label:"网盘链接","min-width":"200"},{default:o(({row:l})=>[l.QuarkUrl?(f(),P("div",Le,[a(D,{size:"small",class:"link-tag quark"},{default:o(()=>[...e[28]||(e[28]=[r("夸克",-1)])]),_:1}),a(ae,{href:l.QuarkUrl,target:"_blank",type:"primary",underline:!1,class:"link-text"},{default:o(()=>[r(V(l.QuarkUrl),1)]),_:2},1032,["href"])])):S("",!0),l.BaiduUrl?(f(),P("div",je,[a(D,{size:"small",type:"warning",class:"link-tag baidu"},{default:o(()=>[...e[29]||(e[29]=[r("百度",-1)])]),_:1}),a(ae,{href:l.BaiduUrl,target:"_blank",type:"primary",underline:!1,class:"link-text"},{default:o(()=>[r(V(l.BaiduUrl),1)]),_:2},1032,["href"])])):S("",!0)]),_:1}),a(c,{prop:"CreatedAt",label:"发布时间",width:"180",align:"center"},{default:o(({row:l})=>[r(V(Ue(l.CreatedAt)),1)]),_:1}),a(c,{label:"操作",width:"150",align:"center",fixed:"right"},{default:o(({row:l})=>[a(p,{size:"small",onClick:d=>ie(l)},{default:o(()=>[...e[30]||(e[30]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(p,{size:"small",type:"danger",onClick:d=>ce(l)},{default:o(()=>[...e[31]||(e[31]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Re,Q.value]]),y("div",Ge,[a(De,{"current-page":w.value,"onUpdate:currentPage":e[4]||(e[4]=l=>w.value=l),"page-size":B.value,"onUpdate:pageSize":e[5]||(e[5]=l=>B.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:Y.value,onSizeChange:re,onCurrentChange:se},null,8,["current-page","page-size","total"])]),a(A,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=l=>k.value=l),title:$.value?"编辑资源":"添加资源",width:"600px","destroy-on-close":""},{footer:o(()=>[a(p,{onClick:e[14]||(e[14]=l=>k.value=!1)},{default:o(()=>[...e[32]||(e[32]=[r("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:pe,loading:E.value},{default:o(()=>[...e[33]||(e[33]=[r("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(Se,{model:n.value,"label-width":"100px"},{default:o(()=>[a(_,{label:"标题",required:""},{default:o(()=>[a(v,{modelValue:n.value.Title,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.Title=l),placeholder:"请输入资源标题"},null,8,["modelValue"])]),_:1}),a(_,{label:"分类",required:""},{default:o(()=>[a(ee,{modelValue:n.value.Category,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.Category=l),placeholder:"请选择或输入分类",filterable:"","allow-create":"",style:{width:"100%"}},{default:o(()=>[(f(!0),P(oe,null,ne(z.value,l=>(f(),U(Z,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"夸克链接"},{default:o(()=>[a(v,{modelValue:n.value.QuarkUrl,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.QuarkUrl=l),placeholder:"https://pan.quark.cn/s/..."},null,8,["modelValue"])]),_:1}),a(_,{label:"百度链接"},{default:o(()=>[a(v,{modelValue:n.value.BaiduUrl,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.BaiduUrl=l),placeholder:"https://pan.baidu.com/s/..."},null,8,["modelValue"])]),_:1}),a(_,{label:"描述"},{default:o(()=>[a(v,{modelValue:n.value.Description,"onUpdate:modelValue":e[10]||(e[10]=l=>n.value.Description=l),type:"textarea",rows:3,placeholder:"资源详细描述"},null,8,["modelValue"])]),_:1}),a(Pe,{gutter:20},{default:o(()=>[a(te,{span:12},{default:o(()=>[a(_,{label:"置顶"},{default:o(()=>[a(G,{modelValue:n.value.IsTop,"onUpdate:modelValue":e[11]||(e[11]=l=>n.value.IsTop=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),a(te,{span:12},{default:o(()=>[a(_,{label:"排序"},{default:o(()=>[a(le,{modelValue:n.value.SortOrder,"onUpdate:modelValue":e[12]||(e[12]=l=>n.value.SortOrder=l),min:0,max:999,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(_,{label:"标记为新"},{default:o(()=>[a(G,{modelValue:n.value.IsNew,"onUpdate:modelValue":e[13]||(e[13]=l=>n.value.IsNew=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(A,{modelValue:q.value,"onUpdate:modelValue":e[17]||(e[17]=l=>q.value=l),title:"分类管理",width:"400px"},{default:o(()=>[y("div",We,[y("div",He,[a(v,{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=l=>x.value=l),placeholder:"新分类名称"},{append:o(()=>[a(p,{onClick:ge},{default:o(()=>[...e[34]||(e[34]=[r("添加",-1)])]),_:1})]),_:1},8,["modelValue"])]),a(W,{data:X.value,height:"300px",style:{"margin-top":"20px"}},{default:o(()=>[a(c,{label:"分类名称"},{default:o(({row:l})=>[a(v,{modelValue:l.CategoryName,"onUpdate:modelValue":d=>l.CategoryName=d,size:"small",onBlur:d=>ye(l)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),a(c,{label:"操作",width:"80",align:"center"},{default:o(({row:l})=>[a(p,{type:"danger",link:"",onClick:d=>_e(l)},{default:o(()=>[...e[35]||(e[35]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),a(A,{modelValue:I.value,"onUpdate:modelValue":e[20]||(e[20]=l=>I.value=l),title:"批量解析网盘链接",width:"700px"},{footer:o(()=>[a(p,{onClick:e[19]||(e[19]=l=>I.value=!1)},{default:o(()=>[...e[36]||(e[36]=[r("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:Ve,loading:K.value},{default:o(()=>[...e[37]||(e[37]=[r("开始解析",-1)])]),_:1},8,["loading"])]),default:o(()=>[y("div",Je,[a(ze,{title:"系统将自动从文本中提取标题、分类和网盘链接。支持多种格式。",type:"info",closable:!1,"show-icon":""})]),a(v,{modelValue:N.value,"onUpdate:modelValue":e[18]||(e[18]=l=>N.value=l),type:"textarea",rows:12,placeholder:`例如：
【2026考研资料】链接：https://pan.quark.cn/s/xxxx
资源名称2 https://pan.baidu.com/s/yyyy`,style:{"margin-top":"15px"}},null,8,["modelValue"])]),_:1},8,["modelValue"]),a(A,{modelValue:T.value,"onUpdate:modelValue":e[22]||(e[22]=l=>T.value=l),title:"解析结果预览",width:"90%",top:"5vh"},{footer:o(()=>[a(p,{onClick:e[21]||(e[21]=l=>T.value=!1)},{default:o(()=>[...e[39]||(e[39]=[r("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:ke,loading:L.value},{default:o(()=>[r("确认并导入 ("+V(h.value.length)+"条)",1)]),_:1},8,["loading"])]),default:o(()=>[a(W,{data:h.value,height:"60vh",border:"",stripe:""},{default:o(()=>[a(c,{label:"状态",width:"100",align:"center"},{default:o(({row:l})=>[a(D,{type:he(l.action)},{default:o(()=>[r(V(be(l.action)),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"标题"},{default:o(({row:l})=>[a(v,{modelValue:l.Title,"onUpdate:modelValue":d=>l.Title=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(c,{label:"分类",width:"150"},{default:o(({row:l})=>[a(v,{modelValue:l.Category,"onUpdate:modelValue":d=>l.Category=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(c,{label:"夸克链接"},{default:o(({row:l})=>[a(v,{modelValue:l.QuarkUrl,"onUpdate:modelValue":d=>l.QuarkUrl=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(c,{label:"百度链接"},{default:o(({row:l})=>[a(v,{modelValue:l.BaiduUrl,"onUpdate:modelValue":d=>l.BaiduUrl=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(c,{label:"操作",width:"80",align:"center"},{default:o(({$index:l})=>[a(p,{type:"danger",link:"",onClick:d=>Ce(l)},{default:o(()=>[...e[38]||(e[38]=[r("排除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},el=Be(Xe,[["__scopeId","data-v-ad2cee46"]]);export{el as default};
