import{_ as xa,K as Sa,i as Ia,o as i,c as C,a as l,w as t,p as h,E as r,f as p,r as S,g as de,D as Da,e as s,d as u,C as De,z as _,t as b,b as Ml,k as A,O as st,F as z,y as j,m as $,T as Ye,U as qa,V as Ba,M as Ql,n as qe,R as $a,W as Ma,J as Qa,X as nt,Y as Ua,Z as za,Q as it,$ as ja,a0 as ut,G as ee,q as il}from"./index-1rGkZLYp.js";import{k as rt}from"./katex.min-DPBfLjbn.js";const La={class:"math-manage"},Na={class:"filter-bar mb-20"},Oa={class:"pagination-container mt-20"},Aa={class:"filter-card mb-20"},Pa=["innerHTML"],Fa={class:"pagination-container mt-20"},Ka={class:"filter-card mb-20"},Ja={class:"filter-card mb-20"},Ea={class:"pagination-container mt-20"},Ha={class:"entry-container"},Ra={class:"entry-header mb-20"},Xa={style:{float:"right",color:"#8492a6","font-size":"13px"}},Ga={key:0,class:"entry-form-wrapper"},Wa={class:"edit-section"},Ya={class:"details-section mt-20"},Za={class:"details-header"},eo={class:"detail-card-header"},lo={class:"detail-actions"},to={class:"preview-section"},ao={class:"preview-block"},oo={class:"preview-content"},so={class:"preview-block"},no={class:"preview-content"},io={class:"preview-block"},uo={class:"preview-content"},ro={class:"preview-block"},po=["innerHTML"],co={class:"preview-block"},vo=["innerHTML"],mo={class:"preview-label"},fo=["innerHTML"],yo={class:"source-edit-section"},go={class:"source-actions mt-10"},bo={class:"source-preview-section"},Co={key:0,class:"source-preview-content"},wo={class:"preview-block"},ko={class:"preview-content"},_o={class:"preview-block"},To={class:"preview-content"},ho={class:"preview-block"},Vo=["innerHTML"],xo={class:"preview-block"},So=["innerHTML"],Io={class:"preview-label"},Do=["innerHTML"],qo={class:"entry-actions mt-20"},Bo={key:1,class:"empty-tip"},$o={class:"file-import-container"},Mo={class:"upload-card"},Qo={class:"upload-header"},Uo={key:0,class:"file-info"},zo={class:"upload-card"},jo={class:"upload-header"},Lo={key:0,class:"file-info"},No={class:"upload-card"},Oo={class:"upload-header"},Ao={key:0,class:"file-info"},Po={class:"card-header"},Fo={key:0,class:"file-info"},Ko={class:"import-actions"},Jo={key:1,class:"import-result mt-20"},Eo={key:0},Ho={key:0},Ro={key:1},Xo={class:"import-container"},Go={key:0,class:"import-upload mt-20"},Wo={class:"el-upload__tip"},Yo={key:1,class:"import-source-section mt-20"},Zo={class:"source-edit-area"},es={class:"source-actions mt-10"},ls={class:"source-preview-area"},ts={key:0,class:"import-preview-content"},as={class:"preview-count"},os={class:"preview-item-header"},ss={class:"item-index"},ns={key:0,class:"chapter-tag"},is=["innerHTML"],us={key:0,class:"more-items-tip"},rs={key:2,class:"import-preview mt-20"},ds={key:0,class:"more-tip"},ps={class:"import-actions mt-20"},cs={class:"knowledge-categories-container"},vs={class:"filter-bar mb-20"},ms={class:"custom-tree-node"},fs={class:"node-name"},ys={class:"node-info"},gs={class:"node-actions"},bs={key:0,class:"edit-form-container"},Cs={class:"edit-sidebar"},ws={class:"sidebar-menu"},ks=["onClick"],_s={class:"sidebar-item-title"},Ts={class:"edit-main-content"},hs={id:"section-basic",class:"content-section"},Vs={id:"section-question",class:"content-section"},xs=["innerHTML"],Ss={id:"section-answer",class:"content-section"},Is=["innerHTML"],Ds={class:"content-section"},qs={class:"details-list"},Bs={class:"detail-card-header"},$s={class:"header-left"},Ms={key:0,class:"kp-tag"},Qs={class:"header-actions"},Us={class:"detail-card-body"},zs={class:"kp-info"},js=["innerHTML"],Ls={class:"content-section latex-helper-section"},Ns={class:"latex-categories"},Os={class:"category-name"},As={class:"latex-symbols-content"},Ps=["onClick","title"],Fs=["innerHTML"],Ks={class:"dialog-footer"},Js={class:"dialog-footer"},Es={class:"dialog-footer"},Hs={class:"dialog-footer"},Rs={class:"mb-20"},Xs={class:"pagination-container mt-20"},Gs={class:"dialog-footer"},Ws={key:0,class:"book-detail-container"},Ys={class:"book-detail-sidebar"},Zs={class:"sidebar-header"},en={class:"chapter-list"},ln=["onClick"],tn={class:"chapter-info"},an={class:"chapter-name"},on={class:"chapter-count"},sn={class:"chapter-actions"},nn={class:"book-detail-main"},un={class:"detail-header"},rn={class:"header-actions"},dn=["innerHTML"],pn={__name:"MathManage",setup(cn){const Ul=p("corrections"),ge=p("basic"),Be=o=>{ge.value=o;const e=document.getElementById("section-"+o);e&&e.scrollIntoView({behavior:"smooth",block:"start"})},dt=()=>{ht(),ut(()=>{const o=m.details.length-1;Be("detail-"+o)})},pt=()=>{const o=document.querySelector(".edit-main-content");if(!o)return;const e=["basic","question","answer",...m.details.map((v,d)=>"detail-"+d)];o.addEventListener("scroll",()=>{const v=o.scrollTop;for(const d of e){const n=document.getElementById("section-"+d);if(n){const f=n.offsetTop;v>=f-100&&(ge.value=d)}}})},zl=p([]),ul=p(!1),jl=p(0),oe=de({status:0,page:1,pageSize:20}),Ll=p([]),rl=p(!1),Nl=p(0),J=de({keyword:"",subjectId:"",questionType:"",page:1,pageSize:20}),be=p([]),dl=p(!1),Ce=p([]),pl=p(!1),Ol=p(0),P=de({keyword:"",subjectId:"",contentType:"",countType:"",page:1,pageSize:20}),$e=p(!1),Me=p(null),we=p(!1),cl=p([]),pe=p([]),m=de({questionText:"",answerText:"",questionType:"",difficulty:3,bookId:"",bookChapter:"",questionPage:"",questionSort:"",chapterSort:"",details:[]}),Qe=p(!1),vl=p(!1),E=p(null),Ue=p(!1),H=p(null),ze=p(!1),x=p(null),ml=p(!1),F=p(null),Ze=p([]),R=p(null),el=p([]),je=p(!1),ke=p([]),_e=p(!1),fl=p(null),Le=p([]),yl=p(!1),Al=p(0),ce=p([]),G=de({keyword:"",page:1,pageSize:20}),Ne=p(!1),Oe=p(""),Y=p(null),se=p(""),ae=p([]),w=de({questionText:"",answerText:"",questionType:"",difficulty:.5,questionSort:"",details:[]}),Te=p("form"),le=p(""),X=p(null),T=de({subjectId:null,contentType:"book",structFile:null,questionsFile:null,detailsFile:null,structData:null,questionsData:null,detailsData:null}),gl=p([]),bl=p([]),Cl=p([]),wl=p(!1),K=p(null),kl=p([]),W=p(null),Ae=il(()=>{const o=T.structData?T.structData.length:0,e=T.questionsData?T.questionsData.length:0,v=T.detailsData?Object.keys(T.detailsData).length:0;return{structCount:o,questionsCount:e,detailsCount:v,total:Math.max(o,e,v)}}),Pl=il(()=>{if(!W.value)return 0;let o=0;for(const[e,v]of Object.entries(W.value))o+=v.length;return o}),_l=il(()=>T.subjectId&&T.contentType&&(T.structData||T.questionsData)),Tl=(o,e)=>{const v=new FileReader;v.onload=d=>{try{const n=JSON.parse(d.target.result);e==="struct"?(T.structFile=o.name,T.structData=Array.isArray(n)?n:n.struct||n.data||[],gl.value=[o]):e==="questions"?(T.questionsFile=o.name,T.questionsData=Array.isArray(n)?n:n.questions||n.data||[],bl.value=[o]):e==="details"&&(T.detailsFile=o.name,T.detailsData=typeof n=="object"&&!Array.isArray(n)?n:{},Cl.value=[o]),r.success(`文件 ${o.name} 解析成功`)}catch(n){r.error(`文件 ${o.name} 解析失败: ${n.message}`)}},v.readAsText(o.raw)},ct=async()=>{if(!_l.value&&!W.value){r.warning("请选择科目和内容类型并上传文件，或上传相关题文件");return}wl.value=!0,K.value=null;try{let o={totalBooks:0,questionsCreated:0,questionsUpdated:0,detailsCreated:0,linksCreated:0,relatedQuestionsImported:0};if(_l.value){const e=await h.importMathFromFiles({subjectId:T.subjectId,contentType:T.contentType,structData:T.structData,questionsData:T.questionsData,detailsData:T.detailsData});o={...o,...e.data}}if(W.value){const e=await ft();o.relatedQuestionsImported=e}K.value={success:!0,data:o},r.success("导入成功"),Z(),tl()}catch(o){console.error("导入失败:",o),K.value={success:!1,message:o.message||"导入失败"},r.error("导入失败")}finally{wl.value=!1}},vt=()=>{T.subjectId=null,T.contentType="book",T.structFile=null,T.questionsFile=null,T.detailsFile=null,T.structData=null,T.questionsData=null,T.detailsData=null,gl.value=[],bl.value=[],Cl.value=[],K.value=null,W.value=null,kl.value=[]},mt=o=>{const e=new FileReader;e.onload=v=>{try{const d=JSON.parse(v.target.result);if(typeof d!="object"||Array.isArray(d)){r.error('相关题文件格式错误，应为对象格式：{"题目ID": ["相关题ID1", ...]}');return}W.value=d,kl.value=[o];const n=Object.keys(d).length,f=Object.values(d).flat().length;r.success(`相关题文件解析成功：${n} 道题，${f} 条关联`)}catch(d){r.error(`相关题文件解析失败: ${d.message}`)}},e.readAsText(o.raw)},ft=async()=>{if(!W.value)return 0;let o=0;const e=Object.entries(W.value);for(const[v,d]of e)try{const n=d.filter(f=>f&&String(f).trim()!=="");if(n.length===0)continue;await h.saveRelatedQuestions({questionId:String(v),relatedIds:n.map(f=>String(f))}),o+=n.length}catch(n){console.error(`保存题目 ${v} 的相关题失败:`,n)}return o},ve=p(null),ll=p(""),hl=p([]),N=p([]),Vl=p(!1),Pe=p("file"),ie=p(""),yt=["单选题","多选题","填空题","解答题"],gt=["题目详解","考点","疑难点","一题多解","答疑","其他"],Fl=[{name:"基础运算",symbols:[{code:"\\frac{a}{b}",label:"分数",display:"\\frac{a}{b}"},{code:"\\sqrt{x}",label:"平方根",display:"\\sqrt{x}"},{code:"\\sqrt[n]{x}",label:"n次根",display:"\\sqrt[n]{x}"},{code:"x^{n}",label:"上标",display:"x^{n}"},{code:"x_{n}",label:"下标",display:"x_{n}"},{code:"\\pm",label:"正负",display:"\\pm"},{code:"\\times",label:"乘号",display:"\\times"},{code:"\\div",label:"除号",display:"\\div"}]},{name:"关系符号",symbols:[{code:"\\leq",label:"小于等于",display:"\\leq"},{code:"\\geq",label:"大于等于",display:"\\geq"},{code:"\\neq",label:"不等于",display:"\\neq"},{code:"\\approx",label:"约等于",display:"\\approx"},{code:"\\equiv",label:"恒等于",display:"\\equiv"},{code:"\\in",label:"属于",display:"\\in"},{code:"\\subset",label:"子集",display:"\\subset"},{code:"\\subseteq",label:"子集或等于",display:"\\subseteq"}]},{name:"集合运算",symbols:[{code:"\\cup",label:"并集",display:"\\cup"},{code:"\\cap",label:"交集",display:"\\cap"},{code:"\\emptyset",label:"空集",display:"\\emptyset"},{code:"\\forall",label:"任意",display:"\\forall"},{code:"\\exists",label:"存在",display:"\\exists"},{code:"\\Rightarrow",label:"推出",display:"\\Rightarrow"},{code:"\\Leftrightarrow",label:"等价",display:"\\Leftrightarrow"}]},{name:"希腊字母",symbols:[{code:"\\alpha",label:"alpha",display:"\\alpha"},{code:"\\beta",label:"beta",display:"\\beta"},{code:"\\gamma",label:"gamma",display:"\\gamma"},{code:"\\theta",label:"theta",display:"\\theta"},{code:"\\lambda",label:"lambda",display:"\\lambda"},{code:"\\mu",label:"mu",display:"\\mu"},{code:"\\pi",label:"pi",display:"\\pi"},{code:"\\Delta",label:"Delta",display:"\\Delta"}]},{name:"求和与极限",symbols:[{code:"\\sum",label:"求和",display:"\\sum"},{code:"\\sum_{i=1}^{n}",label:"求和(完整)",display:"\\sum_{i=1}^{n}"},{code:"\\prod",label:"求积",display:"\\prod"},{code:"\\prod_{i=1}^{n}",label:"求积(完整)",display:"\\prod_{i=1}^{n}"},{code:"\\lim",label:"极限",display:"\\lim"},{code:"\\lim_{x \\to \\infty}",label:"极限(完整)",display:"\\lim_{x \\to \\infty}"},{code:"\\infty",label:"无穷",display:"\\infty"}]},{name:"积分",symbols:[{code:"\\int",label:"积分",display:"\\int"},{code:"\\int_{a}^{b}",label:"定积分",display:"\\int_{a}^{b}"},{code:"\\iint",label:"二重积分",display:"\\iint"},{code:"\\iiint",label:"三重积分",display:"\\iiint"},{code:"\\oint",label:"环路积分",display:"\\oint"}]},{name:"函数",symbols:[{code:"\\sin",label:"sin",display:"\\sin"},{code:"\\cos",label:"cos",display:"\\cos"},{code:"\\tan",label:"tan",display:"\\tan"},{code:"\\log",label:"log",display:"\\log"},{code:"\\ln",label:"ln",display:"\\ln"},{code:"\\exp",label:"exp",display:"\\exp"}]},{name:"几何",symbols:[{code:"\\vec{a}",label:"向量",display:"\\vec{a}"},{code:"\\overline{AB}",label:"线段",display:"\\overline{AB}"},{code:"\\angle",label:"角",display:"\\angle"},{code:"\\perp",label:"垂直",display:"\\perp"},{code:"\\parallel",label:"平行",display:"\\parallel"},{code:"\\triangle",label:"三角形",display:"\\triangle"},{code:"\\odot",label:"圆",display:"\\odot"}]},{name:"其他",symbols:[{code:"\\binom{n}{k}",label:"组合",display:"\\binom{n}{k}"},{code:"\\partial",label:"偏导",display:"\\partial"},{code:"\\nabla",label:"梯度",display:"\\nabla"},{code:"\\degree",label:"度",display:"\\degree"}]}];Fl.flatMap(o=>o.symbols);const bt=o=>o?new Date(o).toLocaleString("zh-CN"):"-",Ct=o=>o?o.replace(/<[^>]+>/g,"").substring(0,100)+"...":"",wt=o=>{if(!o)return"";try{const e=/\\?(sum|prod|lim|int|iint|iiint|oint)/.test(o);return rt.renderToString(o,{displayMode:e,throwOnError:!1})}catch{return o}},te=o=>{if(!o)return"";const e=[],v=(D,Q="html")=>{const U=`__LATEX_JS_${Q.toUpperCase()}_PH_${e.length}__`;return e.push({p:U,content:D,type:Q}),U};let d=o.trim().replace(/\t/g," ").replace(/ {2,}/g," ");const n=[];let f;try{f=new RegExp("(\\$\\$[\\s\\S]*?\\$\\$)|((?<!\\\\)\\$([\\s\\S]+?)(?<!\\\\)\\$)|(\\\\\\[[\\s\\S]*?\\\\\\])|(\\\\\\([\\s\\S]*?\\\\\\))","g")}catch{f=/(\$\$[\s\S]*?\$\$)|(\$([\s\S]+?)\$)|(\\\[[\s\S]*?\\\])|(\\\([\s\S]*?\\\))/g}d=d.replace(f,D=>{const Q=D.replace(/\n/g," "),U=`__FORMULA_TEMP_${n.length}__`;return n.push({p:U,original:D,cleaned:Q}),U}),n.forEach(({p:D,cleaned:Q})=>{d=d.replace(D,Q)});let I;try{I=new RegExp("(\\$\\$[\\s\\S]*?\\$\\$)|((?<!\\\\)\\$([\\s\\S]+?)(?<!\\\\)\\$)|(\\\\\\[[\\s\\S]*?\\\\\\])|(\\\\\\([\\s\\S]*?\\\\\\))","g")}catch{I=/(\$\$[\s\S]*?\$\$)|(\$([\s\S]+?)\$)|(\\\[[\s\S]*?\\\])|(\\\([\s\S]*?\\\))/g}return d=d.replace(I,(D,Q,U,y,M,q)=>{let g="",B=!1;if(Q?(g=Q.slice(2,-2),B=!0):U?(g=y,B=!1):M?(g=M.slice(2,-2),B=!0):q&&(g=q.slice(2,-2),B=!1),!g.trim())return D;try{const L=rt.renderToString(g,{throwOnError:!1,displayMode:B,strict:!1});return v(L,"math")}catch(L){return console.warn("KaTeX render error:",L),D}}),d=d.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),d=d.replace(/《答案》/g,'<span class="custom-tag answer">【答案】</span>').replace(/《\/答案》/g,"").replace(/《分析》/g,'<span class="custom-tag analysis">【思路分析】</span>').replace(/《\/分析》/g,"").replace(/《点评》/g,'<span class="custom-tag commentary">【点评】</span>').replace(/《\/点评》/g,"").replace(/《注释》/g,'<span class="custom-tag note">').replace(/《\/注释》/g,"</span>").replace(/《步骤》/g,'<span class="custom-tag step">【步骤】</span>').replace(/《\/步骤》/g,""),d=d.replace(/\\color\{#([0-9A-Fa-f]{6})\}\{([^}]+)\}/g,'<span style="color:#$1;">$2</span>').replace(/\\bold\{([^}]+)\}/g,"<b>$1</b>").replace(/\\mathbf\{([^}]+)\}/g,"<b>$1</b>"),d=d.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(D,Q,U)=>{let y=U;try{y=decodeURIComponent(U)}catch{}return`<img src="${y.replace(/(_yjs|_thumb|_small|_medium|_large)(\?.*)?$/i,"$2")}" alt="${Q}" style="max-width:100%;height:auto;display:block;margin:10px 0;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display='none'" />`}),d=d.replace(/!\s*`\s*(https?:\/\/[^\s`]+\.(?:png|jpg|jpeg|gif|webp|svg|bmp)(?:_yjs|_thumb|_small|_medium|_large)?)\s*`/gi,(D,Q)=>{let U=Q;try{U=decodeURIComponent(Q)}catch{}return`<img src="${U.replace(/(_yjs|_thumb|_small|_medium|_large)(\?.*)?$/i,"$2")}" alt="" style="max-width:100%;height:auto;display:block;margin:10px 0;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display='none'" />`}),d=d.replace(/(https?:\/\/[^\s<>"]+\.(?:png|jpg|jpeg|gif|webp|svg|bmp))(?:_yjs|_thumb|_small|_medium|_large)?(?!["'])/gi,(D,Q)=>`<img src="${Q.replace(/(_yjs|_thumb|_small|_medium|_large)$/i,"")}" style="max-width:100%;height:auto;display:block;margin:10px 0;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display='none'" />`),e.forEach(({p:D,content:Q})=>{d=d.replace(D,Q)}),d=d.replace(/\n/g,"<br>"),d},Fe=async()=>{ul.value=!0;try{const o=await h.getMathCorrections({status:oe.status,page:oe.page,pageSize:oe.pageSize});zl.value=o.data.list||[],jl.value=o.data.total||0}catch(o){console.error("获取纠错反馈失败:",o),r.error("获取纠错反馈失败")}finally{ul.value=!1}},ne=async()=>{rl.value=!0;try{const o=await h.searchMathQuestions({keyword:J.keyword,subjectId:J.subjectId,questionType:J.questionType,page:J.page,pageSize:J.pageSize});Ll.value=o.data.list||[],Nl.value=o.data.total||0}catch(o){console.error("搜索题目失败:",o),r.error("搜索题目失败")}finally{rl.value=!1}},tl=async()=>{dl.value=!0;try{const o=await h.getMathSubjects();be.value=o.data||[]}catch(o){console.error("获取科目失败:",o),r.error("获取科目列表失败")}finally{dl.value=!1}},Z=async()=>{pl.value=!0;try{const o=await h.getMathBooks({keyword:P.keyword,subjectId:P.subjectId,contentType:P.contentType,countType:P.countType,page:P.page,pageSize:P.pageSize});Ce.value=o.data.list||[],Ol.value=o.data.total||0}catch(o){console.error("获取书籍失败:",o),r.error("获取书籍列表失败")}finally{pl.value=!1}},xl=async o=>{try{const e=await h.getMathQuestionDetail(o);if(e.code===0){if(Me.value=e.data.question,m.questionText=e.data.question.QuestionText||"",m.answerText=e.data.question.OriginalAnswerText||"",m.questionType=e.data.question.QuestionType||"",m.difficulty=e.data.question.Difficulty||3,m.bookId=e.data.question.LegacyOriginalBookID||"",m.bookChapter=e.data.question.BookChapter||"",m.questionPage=e.data.question.QuestionPage||"",m.questionSort=e.data.question.QuestionSort||"",m.chapterSort=e.data.question.ChapterSort||"",m.bookId)try{const v=await h.getMathBookChapters(m.bookId);pe.value=v.data||[]}catch(v){console.error("加载章节列表失败:",v),pe.value=[]}else pe.value=[];cl.value=e.data.knowledgePoints||[],m.details=(e.data.details||[]).map(v=>{const d={...v,_expanded:!1,_tmpId:v.ID||Date.now()+Math.random()};if(d.LinkedKnowledgePointID&&(!d.Context||d.Context.trim()==="")){const n=cl.value.find(f=>String(f.KnowledgePointID)===String(d.LinkedKnowledgePointID));n&&n.KPContent&&(d.Context=n.KPContent)}return d}),$e.value=!0,ut(()=>{pt()})}else r.error("获取题目详情失败")}catch(e){console.error("获取题目详情失败:",e),r.error("获取题目详情失败")}},kt=async o=>{if(m.bookChapter="",o)try{const e=await h.getMathBookChapters(o);pe.value=e.data||[]}catch(e){console.error("加载章节列表失败:",e),pe.value=[]}else pe.value=[]},Kl=o=>({analysis:"info",answer:"success",commentary:"warning",keypoint:"danger",solution:"primary"})[o]||"info",_t=o=>({book:"书籍",real_paper:"真题卷",mock_paper:"模拟卷"})[o]||o||"未知",Tt=o=>({book:"primary",real_paper:"success",mock_paper:"warning"})[o]||"info",al=o=>o?cl.value.find(e=>String(e.KnowledgePointID)===String(o)):null,ht=()=>{const o={ID:null,_tmpId:Date.now(),BusType:"analysis",Title:"",Context:"",Notes:"",Give:m.details.length,LinkedKnowledgePointID:null,_expanded:!0};m.details.push(o)},Vt=o=>{ee.confirm("确定要删除这个详情卡片吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.details.splice(o,1),r.success("已删除")})},Jl=(o,e)=>{const v=o+e;if(v<0||v>=m.details.length)return;const d=m.details[o];m.details[o]=m.details[v],m.details[v]=d,m.details.forEach((n,f)=>{n.Give=f})},El=()=>{m.details.sort((o,e)=>(o.Give||0)-(e.Give||0))},xt=o=>{navigator.clipboard.writeText(o).then(()=>{r.success(`已复制: ${o}`)})},St=async()=>{if(!m.questionText){r.warning("请输入题干");return}we.value=!0;try{const o={questionText:m.questionText,answerText:m.answerText,questionType:m.questionType,difficulty:m.difficulty,bookId:m.bookId,bookChapter:m.bookChapter,questionPage:m.questionPage,questionSort:m.questionSort,chapterSort:m.chapterSort,details:m.details.map(e=>({ID:e.ID,BusType:e.BusType,Title:e.Title,Context:e.Context,Notes:e.Notes,Give:e.Give,LinkedKnowledgePointID:e.LinkedKnowledgePointID?Number(e.LinkedKnowledgePointID):null}))};await h.updateMathQuestion(Me.value.QuestionID,o),r.success("保存成功"),$e.value=!1,ne()}catch(o){console.error("保存失败:",o),r.error("保存失败")}finally{we.value=!1}},It=o=>{ee.confirm("确定要删除这道题吗？","警告",{type:"error"}).then(async()=>{try{await h.deleteMathQuestion(o),r.success("删除成功"),ne()}catch(e){console.error("删除失败:",e),r.error("删除失败")}})},Dt=()=>{E.value={QuestionType:"单选题",QuestionText:"",OriginalAnswerText:"",Difficulty:3,bookIds:[]},Qe.value=!0},qt=async()=>{if(!E.value.QuestionText){r.warning("请输入题干");return}vl.value=!0;try{await h.createMathQuestion(E.value),r.success("题目创建成功"),Qe.value=!1,ne()}catch(o){console.error("创建题目失败:",o),r.error("创建题目失败")}finally{vl.value=!1}},Hl=(o=null)=>{o?H.value={...o}:H.value={SubjectName:"",description:""},Ue.value=!0},Bt=async()=>{if(!H.value.SubjectName){r.warning("请输入科目名称");return}try{H.value.SubjectID?(await h.updateMathSubject(H.value.SubjectID,H.value),r.success("科目更新成功")):(await h.createMathSubject(H.value),r.success("科目创建成功")),Ue.value=!1,tl()}catch(o){console.error("保存科目失败:",o),r.error("保存失败")}},$t=o=>{ee.confirm("确定要删除这个科目吗？","警告",{type:"warning"}).then(async()=>{try{await h.deleteMathSubject(o),r.success("删除成功"),tl()}catch(e){console.error("删除科目失败:",e),r.error("删除失败")}})},Rl=(o=null)=>{o?x.value={...o,SubjectIDs:o.SubjectIDs||[]}:x.value={BookTitle:"",ContentType:"book",CountType:"question",SubjectIDs:[],VersionInfo:"",LearnerCount:0,SortOrder:0,Description:""},ze.value=!0},Mt=async()=>{if(!x.value.BookTitle){r.warning("请输入书籍名称");return}if(!x.value.ContentType){r.warning("请选择内容类型");return}if(!x.value.SubjectIDs||x.value.SubjectIDs.length===0){r.warning("请选择所属科目");return}try{const o={BookTitle:x.value.BookTitle,ContentType:x.value.ContentType,CountType:x.value.CountType,SubjectIDs:x.value.SubjectIDs,VersionInfo:x.value.VersionInfo,LearnerCount:x.value.LearnerCount||0,SortOrder:x.value.SortOrder||0,Description:x.value.Description};x.value.BookID?(await h.updateMathBook(x.value.BookID,o),r.success("书籍更新成功")):(await h.createMathBook(o),r.success("书籍创建成功")),ze.value=!1,Z()}catch(o){console.error("保存书籍失败:",o),r.error("保存失败")}},Qt=o=>{ee.confirm("确定要删除这本书籍吗？删除书籍将同时删除所有关联的题目！","警告",{type:"warning"}).then(async()=>{try{await h.deleteMathBook(o),r.success("删除成功"),Z()}catch(e){console.error("删除书籍失败:",e),r.error("删除失败")}})},Ut=async o=>{F.value=o,ml.value=!0,R.value=null,await he(o.BookID),await zt(o.BookID)},he=async o=>{try{const e=await h.getMathBookChapters(o);Ze.value=e.data||[]}catch(e){console.error("获取章节列表失败:",e),r.error("获取章节列表失败")}},zt=async o=>{je.value=!0;try{const e=await h.getMathBookAllQuestions(o);el.value=e.data||[]}catch(e){console.error("获取书籍题目失败:",e),r.error("获取书籍题目失败")}finally{je.value=!1}},jt=async o=>{R.value=o,await ol(o.name)},ol=async o=>{je.value=!0;try{const e=await h.getMathBookChapterQuestions(F.value.BookID,o);el.value=e.data||[]}catch(e){console.error("获取章节题目失败:",e),r.error("获取章节题目失败")}finally{je.value=!1}},Lt=o=>{ee.prompt("请输入新的章节名称","编辑章节",{confirmButtonText:"保存",cancelButtonText:"取消",inputValue:o.name}).then(async({value:e})=>{if(!(!e||e===o.name))try{await h.updateMathBookChapter(F.value.BookID,o.name,{newName:e}),r.success("章节名称修改成功"),he(F.value.BookID)}catch(v){console.error("修改章节名称失败:",v),r.error("修改失败")}})},Nt=o=>{ee.confirm(`确定要删除章节 "${o.name}" 吗？该章节下的所有题目将被移出本书籍！`,"警告",{type:"warning"}).then(async()=>{try{await h.deleteMathBookChapter(F.value.BookID,o.name),r.success("章节删除成功"),he(F.value.BookID),R.value=null,el.value=[]}catch(e){console.error("删除章节失败:",e),r.error("删除失败")}})},Ot=o=>{xl(o.QuestionID)},At=o=>{ee.confirm("确定要将该题目从本书籍中移除吗？","提示").then(async()=>{try{await h.deleteMathBookQuestion(F.value.BookID,o.QuestionID),r.success("删除成功"),R.value&&await ol(R.value.name),await he(F.value.BookID)}catch(e){console.error("删除失败:",e),r.error("删除失败")}})},Pt=o=>{ke.value=o},Ft=()=>{if(ke.value.length===0){r.warning("请先选择要删除的题目");return}ee.confirm(`确定要删除选中的 ${ke.value.length} 道题目吗？`,"警告",{type:"warning"}).then(async()=>{try{const o=ke.value.map(e=>e.QuestionID);await h.batchDeleteMathBookQuestions(F.value.BookID,o),r.success("批量删除成功"),R.value&&await ol(R.value.name),await he(F.value.BookID),ke.value=[]}catch(o){console.error("批量删除失败:",o),r.error("批量删除失败")}})},Kt=()=>{ee.prompt("请输入章节名称","添加章节",{confirmButtonText:"添加",cancelButtonText:"取消",inputPlaceholder:"如：第一章 函数与极限"}).then(async({value:o})=>{if(o)try{await h.addMathBookChapter(F.value.BookID,{chapterName:o}),r.success("章节添加成功"),Ze.value.push({name:o,questionCount:0}),Ze.value.sort((e,v)=>e.name.localeCompare(v.name,"zh-CN"))}catch(e){console.error("添加章节失败:",e),r.error("添加失败")}})},Jt=()=>{if(!R.value){r.warning("请先选择一个章节");return}fl.value=F.value,Le.value=[],ce.value=[],G.keyword="",G.page=1,_e.value=!0,Ne.value=!0,Oe.value=R.value.name,Ke()},Et=o=>{fl.value=o,Le.value=[],ce.value=[],G.keyword="",G.page=1,_e.value=!0,Ne.value=!1,Oe.value="",Ke()},Ke=async()=>{yl.value=!0;try{const o=await h.searchMathQuestions({keyword:G.keyword,page:G.page,pageSize:G.pageSize});Le.value=o.data.list||[],Al.value=o.data.total||0}catch(o){console.error("搜索题目失败:",o)}finally{yl.value=!1}},Ht=o=>{ce.value=o},Rt=async()=>{if(ce.value.length===0){r.warning("请选择要添加的题目");return}try{const o=ce.value.map(v=>v.QuestionID),e={questionIds:o};Ne.value&&Oe.value&&(e.chapterName=Oe.value),await h.addQuestionsToMathBook(fl.value.BookID,e),r.success(`成功添加 ${o.length} 道题目`),_e.value=!1,Ne.value&&F.value&&(await he(F.value.BookID),R.value&&await ol(R.value.name)),Z()}catch(o){console.error("添加题目失败:",o),r.error("添加题目失败")}},Xt=async o=>{try{await h.updateMathCorrectionStatus(o.ID,{status:1}),r.success("已标记为处理"),Fe()}catch(e){console.error("处理纠错失败:",e),r.error("处理失败")}},Gt=async o=>{if(Y.value=o,se.value="",o)try{const e=await h.getMathBookChapters(o);ae.value=e.data||[]}catch(e){console.error("获取章节列表失败:",e),ae.value=[]}else ae.value=[]},Wt=()=>{ee.prompt("请输入章节名称","添加章节",{confirmButtonText:"添加",cancelButtonText:"取消",inputPlaceholder:"如：第一章 函数与极限"}).then(async({value:o})=>{if(o)try{await h.addMathBookChapter(Y.value,{chapterName:o});const e=await h.getMathBookChapters(Y.value);ae.value=e.data||[],se.value=o,r.success("章节添加成功")}catch(e){console.error("添加章节失败:",e),r.error("添加章节失败")}})},Yt=()=>{w.details.push({BusType:"题目详解",Title:"",Context:""})},Xl=(o,e)=>{const v=o+e;if(v>=0&&v<w.details.length){const d=w.details[o];w.details[o]=w.details[v],w.details[v]=d}},Zt=o=>{w.details.splice(o,1)},Sl=()=>{w.questionText="",w.answerText="",w.questionType="",w.difficulty=.5,w.questionSort="",w.details=[],le.value="",X.value=null},ea=()=>{Y.value=null,se.value="",ae.value=[],Te.value="form",Sl()},Gl=()=>{try{if(le.value.trim()){const o=JSON.parse(le.value);X.value=o}else X.value=null}catch{}},la=()=>{try{if(le.value.trim()){const o=JSON.parse(le.value);le.value=JSON.stringify(o,null,2),r.success("格式化成功")}}catch{r.error("JSON格式错误，无法格式化")}},ta=()=>{try{if(!le.value.trim()){r.warning("请输入JSON数据");return}let o=le.value;o=o.replace(/\/\/.*$/gm,""),o=o.replace(/\/\*[\s\S]*?\*\//g,"");const e=JSON.parse(o);w.questionText=e.QuestionText||"",w.questionType=e.QuestionType||"",w.answerText=e.OriginalAnswerText||"",w.difficulty=e.Difficulty||.5;const v=e.details||[];w.details=v.map(d=>({BusType:d.BusType||"题目详解",Title:d.Title||"",Context:d.Context||""})),w.questionSort=e.QuestionSort||e.Sort||"",r.success("已应用到表单"),Te.value="form"}catch(o){r.error("JSON解析失败："+o.message)}},aa=()=>{const o=w.questionText||w.details.length>0,e=ae.value.find(I=>I.name===se.value),v=e?(e.questionCount||0)+1:1,d=o?{QuestionText:w.questionText,QuestionType:w.questionType,OriginalAnswerText:w.answerText,Difficulty:w.difficulty,QuestionSort:v.toString(),Sort:v,details:w.details.map(I=>({BusType:I.BusType||"题目详解",Context:I.Context||""}))}:{QuestionText:"设 $f(x) = x^2$，求 $f'(x)$。",QuestionType:"解答题",OriginalAnswerText:"$f'(x) = 2x$",Difficulty:.3,QuestionSort:"1",Sort:1,details:[{BusType:"题目详解",Context:"根据导数定义，$f'(x) = \\lim_{h \\to 0} \\frac{f(x+h)-f(x)}{h} = 2x$。"}]};return`// 手动录入试题JSON格式
// 注意：手动录入的试题ID从 1000000000 开始自动递增
// 
// 字段说明：
// - QuestionText: 题干内容，支持LaTeX公式
// - QuestionType: 题型（单选题/多选题/填空题/解答题）
// - OriginalAnswerText: 答案内容，支持LaTeX公式
// - Difficulty: 难度系数（0-1之间的小数）
// - QuestionSort: 题目排序号（字符串格式，如 "1", "2"）
// - Sort: 题目排序号（数字格式，如 1, 2）
// - details: 题目详情列表
//   - BusType: 业务类型（题目详解/考点/疑难点/一题多解/答疑/其他）
//   - Context: 详情内容，支持LaTeX公式

`+JSON.stringify(d,null,2)};Sa(Te,o=>{o==="source"&&(le.value=aa(),Gl())});const oa=async()=>{if(!w.questionText||w.questionText.trim()===""){r.warning("请输入题干内容");return}if(!Y.value){r.warning("请选择书籍");return}if(!se.value){r.warning("请选择章节");return}we.value=!0;try{let o=w.questionSort;if(!o){const n=ae.value.find(f=>f.name===se.value);o=n?(n.questionCount||0)+1:1}const e={questionText:w.questionText,answerText:w.answerText,questionType:w.questionType,difficulty:w.difficulty,details:w.details.map(n=>({BusType:n.BusType,Title:n.Title,Context:n.Context})),bookId:Y.value,chapterName:se.value,questionSort:o.toString()},v=await h.createMathQuestion(e);r.success("保存成功"),Sl();const d=await h.getMathBookChapters(Y.value);ae.value=d.data||[]}catch(o){console.error("保存题目失败:",o),r.error("保存失败")}finally{we.value=!1}},sa=o=>{const e=new FileReader;e.onload=v=>{try{const d=JSON.parse(v.target.result);Array.isArray(d)?N.value=d:d.questions&&Array.isArray(d.questions)?N.value=d.questions:(r.error("JSON格式不正确"),N.value=[])}catch{r.error("JSON解析失败"),N.value=[]}},e.readAsText(o.raw)},Wl=()=>{const o={questions:[{QuestionID:10001,QuestionText:"设 $f(x) = x^2$，求 $f'(x)$。",QuestionType:"解答题",OriginalAnswerText:"$f'(x) = 2x$",Difficulty:.3,BookChapter:"第一章 函数与极限",details:[{BusType:"题目详解",Context:"根据导数定义，$f'(x) = \\lim_{h \\to 0} \\frac{f(x+h)-f(x)}{h} = 2x$。"}]}]};ee.alert(JSON.stringify(o,null,2),"导入模板",{confirmButtonText:"复制",callback:e=>{e==="confirm"&&(navigator.clipboard.writeText(JSON.stringify(o,null,2)),r.success("已复制到剪贴板"))}})},na=async()=>{var o;if(!ve.value){r.warning("请选择书籍");return}if(N.value.length===0){r.warning("没有可导入的题目");return}Vl.value=!0;try{const e={questions:N.value,bookId:ve.value,chapterName:ll.value||null},v=await h.importMathQuestions(e);r.success(`成功导入 ${((o=v.data)==null?void 0:o.count)||N.value.length} 道题目`),Yl(),Z()}catch(e){console.error("导入失败:",e),r.error("导入失败")}finally{Vl.value=!1}},Yl=()=>{ve.value=null,ll.value="",hl.value=[],N.value=[],ie.value="",Pe.value="file"},ia=()=>{try{if(ie.value.trim()){const o=JSON.parse(ie.value);ie.value=JSON.stringify(o,null,2),r.success("格式化成功")}}catch{r.error("JSON格式错误，无法格式化")}},ua=()=>{try{if(!ie.value.trim()){r.warning("请输入JSON数据");return}const o=JSON.parse(ie.value);let e=[];Array.isArray(o)?e=o:o.questions&&Array.isArray(o.questions)?e=o.questions:e=[o],N.value=e,r.success(`成功解析 ${e.length} 道题目`)}catch(o){r.error("JSON解析失败："+o.message),N.value=[]}},Je=p([]),Zl=p(!1),me=p(!1),Ee=p(!1),He=p(!1),sl=p(!1),nl=p(!1),Il=p(!1),Dl=p(!1),ql=p("0"),ue=p(null),Ve=p(null),xe=p(null),ra={children:"children",label:"CategoryName"},O=de({id:null,CategoryCode:"",CategoryName:"",Description:"",SortOrder:0,IsActive:1}),fe=o=>o!=null&&o.CategoryCode?o.CategoryCode.split("-").length:0,et=il(()=>{const o=Je.value,e=[];return o.filter(d=>{const n=d.CategoryCode.split("-");return n.length===1&&n[0]!=="0"}).forEach(d=>{const n={...d,children:[]};o.filter(I=>{const D=I.CategoryCode.split("-");return D.length===2&&D[0]===d.CategoryCode}).forEach(I=>{const D={...I,children:[]},Q=I.CategoryCode.split("-"),U=o.filter(y=>{const M=y.CategoryCode.split("-");return M.length===3&&M[0]===d.CategoryCode&&M[1]===Q[1]});D.children=U,n.children.push(D)}),e.push(n)}),e}),Re=async()=>{Zl.value=!0;try{const o=await h.getMathKnowledgeCategories();Je.value=[...o.data||[]]}catch(o){console.error("获取考点分类失败:",o),r.error("获取考点分类失败")}finally{Zl.value=!1}},da=()=>{He.value=!1,sl.value=!1,nl.value=!0,ql.value="0";const o=Math.max(0,...Je.value.filter(e=>e.CategoryCode.split("-").length===1).map(e=>parseInt(e.CategoryCode)||0));Object.assign(O,{id:null,CategoryCode:String(o+1),CategoryName:"",Description:"",SortOrder:0,IsActive:1}),me.value=!0},pa=o=>{He.value=!1,sl.value=!0,nl.value=!1,ql.value=o.CategoryCode;let e="";const v=fe(o);if(o.CategoryCode.split("-"),v===1){const d=Math.max(0,...Je.value.filter(n=>n.CategoryCode.startsWith(o.CategoryCode+"-")&&n.CategoryCode.split("-").length===2).map(n=>parseInt(n.CategoryCode.split("-")[1])||0));e=`${o.CategoryCode}-${d+1}`}else if(v===2){const d=Math.max(0,...Je.value.filter(n=>n.CategoryCode.startsWith(o.CategoryCode+"-")&&n.CategoryCode.split("-").length===3).map(n=>parseInt(n.CategoryCode.split("-")[2])||0));e=`${o.CategoryCode}-${d+1}`}Object.assign(O,{id:null,CategoryCode:e,CategoryName:"",Description:"",SortOrder:0,IsActive:1}),me.value=!0},ca=o=>{He.value=!0,sl.value=!1,nl.value=!1,Object.assign(O,{id:o.id,CategoryCode:o.CategoryCode,CategoryName:o.CategoryName,Description:o.Description,SortOrder:o.SortOrder,IsActive:o.IsActive}),me.value=!0},va=o=>{ue.value=o,Ve.value=null,xe.value=null,Ee.value=!0},ma=()=>{xe.value=null},fa=async()=>{if(!Ve.value||!xe.value){r.warning("请选择目标科目和章节");return}Dl.value=!0;try{const e=ue.value.CategoryCode.split("-")[2],v=`${xe.value.CategoryCode}-${e}`;await h.updateMathKnowledgeCategory(ue.value.id,{CategoryCode:v,CategoryName:ue.value.CategoryName,Description:ue.value.Description,SortOrder:ue.value.SortOrder,IsActive:ue.value.IsActive}),r.success("移动成功"),Ee.value=!1,await Re()}catch(o){console.error("移动失败:",o),r.error("移动失败")}finally{Dl.value=!1}},ya=async()=>{if(!O.CategoryCode||!O.CategoryName){r.warning("请填写分类编码和分类名称");return}Il.value=!0;try{He.value?(await h.updateMathKnowledgeCategory(O.id,O),r.success("更新成功")):(await h.createMathKnowledgeCategory(O),r.success("创建成功")),me.value=!1,Re()}catch(o){console.error("保存失败:",o),r.error("保存失败")}finally{Il.value=!1}},ga=async o=>{try{await ee.confirm("确定要删除该分类吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.deleteMathKnowledgeCategory(o),r.success("删除成功"),Re()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),r.error("删除失败"))}};return Ia(()=>{Fe(),tl(),ne(),Z(),Re()}),(o,e)=>{var lt,tt,at;const v=S("el-radio-button"),d=S("el-radio-group"),n=S("el-button"),f=S("el-table-column"),I=S("el-tag"),D=S("el-table"),Q=S("el-pagination"),U=S("el-tab-pane"),y=S("el-col"),M=S("el-icon"),q=S("el-input"),g=S("el-option"),B=S("el-select"),L=S("el-row"),Bl=S("el-rate"),k=S("el-form-item"),ba=S("el-slider"),Se=S("el-form"),$l=S("el-empty"),Xe=S("el-card"),Ge=S("el-upload"),We=S("el-descriptions-item"),Ca=S("el-descriptions"),wa=S("el-alert"),ka=S("el-link"),_a=S("el-scrollbar"),Ta=S("el-tree"),ha=S("el-tabs"),ye=S("el-input-number"),re=S("el-dialog"),Va=S("el-switch"),Ie=Da("loading");return i(),C("div",La,[l(ha,{modelValue:Ul.value,"onUpdate:modelValue":e[29]||(e[29]=a=>Ul.value=a),type:"border-card"},{default:t(()=>[l(U,{label:"纠错反馈",name:"corrections"},{default:t(()=>[s("div",Na,[l(d,{modelValue:oe.status,"onUpdate:modelValue":e[0]||(e[0]=a=>oe.status=a),onChange:Fe},{default:t(()=>[l(v,{label:0},{default:t(()=>[...e[83]||(e[83]=[u("待处理",-1)])]),_:1}),l(v,{label:1},{default:t(()=>[...e[84]||(e[84]=[u("已处理",-1)])]),_:1}),l(v,{label:""},{default:t(()=>[...e[85]||(e[85]=[u("全部",-1)])]),_:1})]),_:1},8,["modelValue"]),l(n,{class:"ml-10",onClick:Fe},{default:t(()=>[...e[86]||(e[86]=[u("刷新",-1)])]),_:1})]),De((i(),_(D,{data:zl.value,border:"",stripe:""},{default:t(()=>[l(f,{prop:"ID",label:"ID",width:"80",align:"center"}),l(f,{prop:"Type",label:"类型",width:"100",align:"center"}),l(f,{prop:"Content",label:"反馈内容","min-width":"200","show-overflow-tooltip":""}),l(f,{prop:"QuestionID",label:"题目ID",width:"100",align:"center"}),l(f,{prop:"Status",label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[l(I,{type:a.Status===1?"success":"danger"},{default:t(()=>[u(b(a.Status===1?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),l(f,{prop:"CreatedAt",label:"提交时间",width:"160",align:"center"},{default:t(({row:a})=>[u(b(bt(a.CreatedAt)),1)]),_:1}),l(f,{label:"操作",width:"180",align:"center",fixed:"right"},{default:t(({row:a})=>[l(n,{size:"small",type:"primary",onClick:c=>Xt(a)},{default:t(()=>[...e[87]||(e[87]=[u("处理",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",onClick:c=>xl(a.QuestionID)},{default:t(()=>[...e[88]||(e[88]=[u("编辑题目",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ie,ul.value]]),s("div",Oa,[l(Q,{"current-page":oe.page,"onUpdate:currentPage":e[1]||(e[1]=a=>oe.page=a),"page-size":oe.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>oe.pageSize=a),total:jl.value,layout:"total, prev, pager, next",onCurrentChange:Fe},null,8,["current-page","page-size","total"])])]),_:1}),l(U,{label:"题目管理",name:"questions"},{default:t(()=>[s("div",Aa,[l(L,{gutter:20,align:"middle"},{default:t(()=>[l(y,{span:4},{default:t(()=>[l(n,{type:"primary",onClick:Dt},{default:t(()=>[...e[89]||(e[89]=[u("+ 创建题目",-1)])]),_:1})]),_:1}),l(y,{span:8},{default:t(()=>[l(q,{modelValue:J.keyword,"onUpdate:modelValue":e[3]||(e[3]=a=>J.keyword=a),placeholder:"搜索题目内容或ID...",clearable:"",onKeyup:Ml(ne,["enter"])},{append:t(()=>[l(n,{onClick:ne},{default:t(()=>[l(M,null,{default:t(()=>[l(A(st))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(y,{span:6},{default:t(()=>[l(B,{modelValue:J.subjectId,"onUpdate:modelValue":e[4]||(e[4]=a=>J.subjectId=a),placeholder:"所属科目",clearable:"",onChange:ne,style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(be.value,a=>(i(),_(g,{key:a.SubjectID,label:a.SubjectName,value:a.SubjectID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{span:6},{default:t(()=>[l(B,{modelValue:J.questionType,"onUpdate:modelValue":e[5]||(e[5]=a=>J.questionType=a),placeholder:"题型",clearable:"",onChange:ne,style:{width:"100%"}},{default:t(()=>[l(g,{label:"单选题",value:"单选题"}),l(g,{label:"多选题",value:"多选题"}),l(g,{label:"填空题",value:"填空题"}),l(g,{label:"解答题",value:"解答题"}),l(g,{label:"判断题",value:"判断题"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),De((i(),_(D,{data:Ll.value,border:"",stripe:""},{default:t(()=>[l(f,{prop:"QuestionID",label:"题目ID",width:"100",align:"center"}),l(f,{prop:"QuestionType",label:"题型",width:"100",align:"center"}),l(f,{prop:"QuestionText",label:"题干摘要","min-width":"300","show-overflow-tooltip":""},{default:t(({row:a})=>[s("div",{innerHTML:Ct(a.QuestionText)},null,8,Pa)]),_:1}),l(f,{prop:"Difficulty",label:"难度",width:"100",align:"center"},{default:t(({row:a})=>[l(Bl,{modelValue:a.Difficulty,"onUpdate:modelValue":c=>a.Difficulty=c,max:5,disabled:"","show-score":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{label:"操作",width:"150",align:"center",fixed:"right"},{default:t(({row:a})=>[l(n,{size:"small",onClick:c=>xl(a.QuestionID)},{default:t(()=>[...e[90]||(e[90]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",type:"danger",onClick:c=>It(a.QuestionID)},{default:t(()=>[...e[91]||(e[91]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ie,rl.value]]),s("div",Fa,[l(Q,{"current-page":J.page,"onUpdate:currentPage":e[6]||(e[6]=a=>J.page=a),"page-size":J.pageSize,"onUpdate:pageSize":e[7]||(e[7]=a=>J.pageSize=a),total:Nl.value,layout:"total, prev, pager, next",onCurrentChange:ne},null,8,["current-page","page-size","total"])])]),_:1}),l(U,{label:"科目管理",name:"subjects"},{default:t(()=>[s("div",Ka,[l(n,{type:"primary",onClick:Hl},{default:t(()=>[...e[92]||(e[92]=[u("+ 创建科目",-1)])]),_:1})]),De((i(),_(D,{data:be.value,border:"",stripe:""},{default:t(()=>[l(f,{prop:"SubjectID",label:"ID",width:"80",align:"center"}),l(f,{prop:"SubjectName",label:"科目名称","min-width":"200"}),l(f,{prop:"description",label:"描述","min-width":"300","show-overflow-tooltip":""}),l(f,{label:"操作",width:"180",align:"center",fixed:"right"},{default:t(({row:a})=>[l(n,{size:"small",onClick:c=>Hl(a)},{default:t(()=>[...e[93]||(e[93]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",type:"danger",onClick:c=>$t(a.SubjectID)},{default:t(()=>[...e[94]||(e[94]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ie,dl.value]])]),_:1}),l(U,{label:"书籍管理",name:"books"},{default:t(()=>[s("div",Ja,[l(L,{gutter:20,align:"middle"},{default:t(()=>[l(y,{span:3},{default:t(()=>[l(n,{type:"primary",onClick:Rl},{default:t(()=>[...e[95]||(e[95]=[u("+ 创建书籍",-1)])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(q,{modelValue:P.keyword,"onUpdate:modelValue":e[8]||(e[8]=a=>P.keyword=a),placeholder:"搜索书籍名称...",clearable:"",onKeyup:Ml(Z,["enter"])},{append:t(()=>[l(n,{onClick:Z},{default:t(()=>[l(M,null,{default:t(()=>[l(A(st))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(y,{span:5},{default:t(()=>[l(B,{modelValue:P.subjectId,"onUpdate:modelValue":e[9]||(e[9]=a=>P.subjectId=a),placeholder:"所属科目",clearable:"",onChange:Z,style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(be.value,a=>(i(),_(g,{key:a.SubjectID,label:a.SubjectName,value:a.SubjectID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{span:5},{default:t(()=>[l(B,{modelValue:P.contentType,"onUpdate:modelValue":e[10]||(e[10]=a=>P.contentType=a),placeholder:"内容类型",clearable:"",onChange:Z,style:{width:"100%"}},{default:t(()=>[l(g,{label:"书籍",value:"book"}),l(g,{label:"真题卷",value:"real_paper"}),l(g,{label:"模拟卷",value:"mock_paper"})]),_:1},8,["modelValue"])]),_:1}),l(y,{span:5},{default:t(()=>[l(B,{modelValue:P.countType,"onUpdate:modelValue":e[11]||(e[11]=a=>P.countType=a),placeholder:"计数类型",clearable:"",onChange:Z,style:{width:"100%"}},{default:t(()=>[l(g,{label:"题数",value:"question"}),l(g,{label:"套数",value:"set"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),De((i(),_(D,{data:Ce.value,border:"",stripe:""},{default:t(()=>[l(f,{prop:"BookID",label:"ID",width:"80",align:"center"}),l(f,{prop:"BookTitle",label:"书籍名称","min-width":"200","show-overflow-tooltip":""}),l(f,{prop:"ContentType",label:"类型",width:"100",align:"center"},{default:t(({row:a})=>[l(I,{type:Tt(a.ContentType)},{default:t(()=>[u(b(_t(a.ContentType)),1)]),_:2},1032,["type"])]),_:1}),l(f,{label:"数量",width:"100",align:"center"},{default:t(({row:a})=>[u(b(a.QuestionCount||0)+" "+b(a.CountType==="set"?"套":"题"),1)]),_:1}),l(f,{prop:"LearnerCount",label:"学习人数",width:"100",align:"center"}),l(f,{prop:"SortOrder",label:"排序",width:"80",align:"center"}),l(f,{label:"操作",width:"300",align:"center",fixed:"right"},{default:t(({row:a})=>[l(n,{size:"small",type:"info",onClick:c=>Ut(a)},{default:t(()=>[...e[96]||(e[96]=[u("详情",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",type:"primary",onClick:c=>Et(a)},{default:t(()=>[...e[97]||(e[97]=[u("添加题目",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",onClick:c=>Rl(a)},{default:t(()=>[...e[98]||(e[98]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",type:"danger",onClick:c=>Qt(a.BookID)},{default:t(()=>[...e[99]||(e[99]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ie,pl.value]]),s("div",Ea,[l(Q,{"current-page":P.page,"onUpdate:currentPage":e[12]||(e[12]=a=>P.page=a),"page-size":P.pageSize,"onUpdate:pageSize":e[13]||(e[13]=a=>P.pageSize=a),total:Ol.value,layout:"total, prev, pager, next",onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),l(U,{label:"录入试题",name:"entry"},{default:t(()=>[s("div",Ha,[s("div",Ra,[l(L,{gutter:20},{default:t(()=>[l(y,{span:8},{default:t(()=>[e[100]||(e[100]=s("div",{class:"select-label"},"选择书籍",-1)),l(B,{modelValue:Y.value,"onUpdate:modelValue":e[14]||(e[14]=a=>Y.value=a),placeholder:"请选择书籍",style:{width:"100%"},onChange:Gt},{default:t(()=>[(i(!0),C(z,null,j(Ce.value,a=>(i(),_(g,{key:a.BookID,label:a.BookTitle,value:a.BookID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{span:8},{default:t(()=>[e[101]||(e[101]=s("div",{class:"select-label"},"选择章节",-1)),l(B,{modelValue:se.value,"onUpdate:modelValue":e[15]||(e[15]=a=>se.value=a),placeholder:"请选择章节",style:{width:"100%"},disabled:!Y.value||ae.value.length===0},{default:t(()=>[(i(!0),C(z,null,j(ae.value,a=>(i(),_(g,{key:a.name,label:a.name,value:a.name},{default:t(()=>[s("span",null,b(a.name),1),s("span",Xa,b(a.questionCount)+"题",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(y,{span:8},{default:t(()=>[e[104]||(e[104]=s("div",{class:"select-label"},"操作",-1)),l(n,{type:"primary",onClick:Wt,disabled:!Y.value},{default:t(()=>[...e[102]||(e[102]=[u("+ 添加章节",-1)])]),_:1},8,["disabled"]),l(n,{onClick:ea},{default:t(()=>[...e[103]||(e[103]=[u("重置",-1)])]),_:1})]),_:1})]),_:1}),l(L,{class:"mt-20"},{default:t(()=>[l(y,{span:24},{default:t(()=>[l(d,{modelValue:Te.value,"onUpdate:modelValue":e[16]||(e[16]=a=>Te.value=a),size:"small"},{default:t(()=>[l(v,{label:"form"},{default:t(()=>[...e[105]||(e[105]=[u("表单模式",-1)])]),_:1}),l(v,{label:"source"},{default:t(()=>[...e[106]||(e[106]=[u("源代码模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),Y.value?(i(),C("div",Ga,[Te.value==="form"?(i(),_(L,{key:0,gutter:20},{default:t(()=>[l(y,{span:12},{default:t(()=>[s("div",Wa,[e[112]||(e[112]=s("h4",null,"题目信息",-1)),l(Se,{"label-width":"80px"},{default:t(()=>[l(k,{label:"题型"},{default:t(()=>[l(B,{modelValue:w.questionType,"onUpdate:modelValue":e[17]||(e[17]=a=>w.questionType=a),placeholder:"请选择题型",style:{width:"100%"}},{default:t(()=>[(i(),C(z,null,j(yt,a=>l(g,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"难度"},{default:t(()=>[l(ba,{modelValue:w.difficulty,"onUpdate:modelValue":e[18]||(e[18]=a=>w.difficulty=a),min:0,max:1,step:.1,"show-stops":""},null,8,["modelValue"])]),_:1}),l(k,{label:"排序号"},{default:t(()=>[l(q,{modelValue:w.questionSort,"onUpdate:modelValue":e[19]||(e[19]=a=>w.questionSort=a),placeholder:"请输入排序号（留空则自动计算）"},null,8,["modelValue"])]),_:1}),l(k,{label:"题干"},{default:t(()=>[l(q,{modelValue:w.questionText,"onUpdate:modelValue":e[20]||(e[20]=a=>w.questionText=a),type:"textarea",rows:4,placeholder:"请输入题干内容（支持LaTeX）"},null,8,["modelValue"])]),_:1}),l(k,{label:"答案"},{default:t(()=>[l(q,{modelValue:w.answerText,"onUpdate:modelValue":e[21]||(e[21]=a=>w.answerText=a),type:"textarea",rows:4,placeholder:"请输入答案内容（支持LaTeX）"},null,8,["modelValue"])]),_:1})]),_:1}),s("div",Ya,[s("div",Za,[e[108]||(e[108]=s("h4",null,"题目详情",-1)),l(n,{size:"small",type:"primary",onClick:Yt},{default:t(()=>[...e[107]||(e[107]=[u("+ 添加详情",-1)])]),_:1})]),(i(!0),C(z,null,j(w.details,(a,c)=>(i(),C("div",{key:c,class:"detail-card"},[s("div",eo,[l(B,{modelValue:a.BusType,"onUpdate:modelValue":V=>a.BusType=V,size:"small",style:{width:"120px"}},{default:t(()=>[(i(),C(z,null,j(gt,V=>l(g,{key:V,label:V,value:V},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"]),l(q,{modelValue:a.Title,"onUpdate:modelValue":V=>a.Title=V,size:"small",placeholder:"标题",style:{width:"150px","margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),s("div",lo,[l(n,{size:"small",link:"",onClick:V=>Xl(c,-1),disabled:c===0},{default:t(()=>[...e[109]||(e[109]=[u("↑",-1)])]),_:1},8,["onClick","disabled"]),l(n,{size:"small",link:"",onClick:V=>Xl(c,1),disabled:c===w.details.length-1},{default:t(()=>[...e[110]||(e[110]=[u("↓",-1)])]),_:1},8,["onClick","disabled"]),l(n,{size:"small",link:"",type:"danger",onClick:V=>Zt(c)},{default:t(()=>[...e[111]||(e[111]=[u("删除",-1)])]),_:1},8,["onClick"])])]),l(q,{modelValue:a.Context,"onUpdate:modelValue":V=>a.Context=V,type:"textarea",rows:3,placeholder:"内容",class:"mt-10"},null,8,["modelValue","onUpdate:modelValue"])]))),128))])])]),_:1}),l(y,{span:12},{default:t(()=>[s("div",to,[e[118]||(e[118]=s("h4",null,"实时预览",-1)),s("div",ao,[e[113]||(e[113]=s("div",{class:"preview-label"},"题型",-1)),s("div",oo,b(w.questionType||"未选择"),1)]),s("div",so,[e[114]||(e[114]=s("div",{class:"preview-label"},"难度",-1)),s("div",no,b(w.difficulty),1)]),s("div",io,[e[115]||(e[115]=s("div",{class:"preview-label"},"排序号",-1)),s("div",uo,b(w.questionSort||"自动计算"),1)]),s("div",ro,[e[116]||(e[116]=s("div",{class:"preview-label"},"题干",-1)),s("div",{class:"preview-content",innerHTML:te(w.questionText)},null,8,po)]),s("div",co,[e[117]||(e[117]=s("div",{class:"preview-label"},"答案",-1)),s("div",{class:"preview-content",innerHTML:te(w.answerText)},null,8,vo)]),(i(!0),C(z,null,j(w.details,(a,c)=>(i(),C("div",{key:c,class:"preview-block"},[s("div",mo,b(a.BusType)+" "+b(a.Title?"- "+a.Title:""),1),s("div",{class:"preview-content",innerHTML:te(a.Context)},null,8,fo)]))),128))])]),_:1})]),_:1})):(i(),_(L,{key:1,gutter:20},{default:t(()=>[l(y,{span:12},{default:t(()=>[s("div",yo,[e[121]||(e[121]=s("h4",null,"源代码编辑（JSON格式）",-1)),l(q,{modelValue:le.value,"onUpdate:modelValue":e[22]||(e[22]=a=>le.value=a),type:"textarea",rows:25,placeholder:"请输入JSON格式的题目数据",class:"source-code-input",onChange:Gl},null,8,["modelValue"]),s("div",go,[l(n,{size:"small",onClick:la},{default:t(()=>[...e[119]||(e[119]=[u("格式化JSON",-1)])]),_:1}),l(n,{size:"small",type:"primary",onClick:ta},{default:t(()=>[...e[120]||(e[120]=[u("应用到表单",-1)])]),_:1})])])]),_:1}),l(y,{span:12},{default:t(()=>[s("div",bo,[e[126]||(e[126]=s("h4",null,"预览",-1)),X.value?(i(),C("div",Co,[s("div",wo,[e[122]||(e[122]=s("div",{class:"preview-label"},"题型",-1)),s("div",ko,b(X.value.QuestionType||X.value.questionType),1)]),s("div",_o,[e[123]||(e[123]=s("div",{class:"preview-label"},"难度",-1)),s("div",To,b(X.value.Difficulty||X.value.difficulty),1)]),s("div",ho,[e[124]||(e[124]=s("div",{class:"preview-label"},"题干",-1)),s("div",{class:"preview-content",innerHTML:te(X.value.QuestionText||X.value.questionText)},null,8,Vo)]),s("div",xo,[e[125]||(e[125]=s("div",{class:"preview-label"},"答案",-1)),s("div",{class:"preview-content",innerHTML:te(X.value.OriginalAnswerText||X.value.answerText)},null,8,So)]),(i(!0),C(z,null,j(X.value.details||X.value.Details,(a,c)=>(i(),C("div",{key:c,class:"preview-block"},[s("div",Io,b(a.BusType)+" "+b(a.Title?"- "+a.Title:""),1),s("div",{class:"preview-content",innerHTML:te(a.Context)},null,8,Do)]))),128))])):(i(),_($l,{key:1,description:"请输入有效的JSON数据"}))])]),_:1})]),_:1})),s("div",qo,[l(n,{type:"primary",size:"large",onClick:oa,loading:we.value},{default:t(()=>[...e[127]||(e[127]=[u("保存题目",-1)])]),_:1},8,["loading"]),l(n,{size:"large",onClick:Sl},{default:t(()=>[...e[128]||(e[128]=[u("清空",-1)])]),_:1})])])):(i(),C("div",Bo,[l($l,{description:"请先选择书籍和章节"})]))])]),_:1}),l(U,{label:"试题导入",name:"fileImport"},{default:t(()=>[s("div",$o,[l(Xe,{class:"mb-20",shadow:"hover"},{header:t(()=>[...e[129]||(e[129]=[s("div",{class:"card-header"},[s("span",null,"基础信息配置")],-1)])]),default:t(()=>[l(L,{gutter:20},{default:t(()=>[l(y,{span:8},{default:t(()=>[e[130]||(e[130]=s("div",{class:"select-label"},"选择科目",-1)),l(B,{modelValue:T.subjectId,"onUpdate:modelValue":e[23]||(e[23]=a=>T.subjectId=a),placeholder:"请选择科目",style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(be.value,a=>(i(),_(g,{key:a.SubjectID,label:a.SubjectName,value:a.SubjectID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{span:8},{default:t(()=>[e[131]||(e[131]=s("div",{class:"select-label"},"内容类型",-1)),l(B,{modelValue:T.contentType,"onUpdate:modelValue":e[24]||(e[24]=a=>T.contentType=a),placeholder:"请选择内容类型",style:{width:"100%"}},{default:t(()=>[l(g,{label:"书籍",value:"book"}),l(g,{label:"真题卷",value:"real_paper"}),l(g,{label:"模拟卷",value:"mock_paper"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Xe,{class:"mb-20",shadow:"hover"},{header:t(()=>[...e[132]||(e[132]=[s("div",{class:"card-header"},[s("span",null,"试题文件上传")],-1)])]),default:t(()=>[l(L,{gutter:20},{default:t(()=>[l(y,{span:8},{default:t(()=>[s("div",Mo,[s("div",Qo,[e[134]||(e[134]=s("span",{class:"upload-title"},"结构文件",-1)),T.structFile?(i(),_(I,{key:0,type:"success",size:"small"},{default:t(()=>[...e[133]||(e[133]=[u("已选择",-1)])]),_:1})):$("",!0)]),e[136]||(e[136]=s("div",{class:"upload-desc"},"包含书籍章节、题目顺序等信息",-1)),l(Ge,{action:"#","auto-upload":!1,"on-change":a=>Tl(a,"struct"),accept:".json",limit:1,"file-list":gl.value},{default:t(()=>[l(n,{type:"primary",size:"small"},{default:t(()=>[...e[135]||(e[135]=[u("选择文件",-1)])]),_:1})]),_:1},8,["on-change","file-list"]),T.structData?(i(),C("div",Uo,[l(M,null,{default:t(()=>[l(A(Ye))]),_:1}),s("span",null,b(T.structData.length)+" 条结构数据",1)])):$("",!0)])]),_:1}),l(y,{span:8},{default:t(()=>[s("div",zo,[s("div",jo,[e[138]||(e[138]=s("span",{class:"upload-title"},"题目文件",-1)),T.questionsFile?(i(),_(I,{key:0,type:"success",size:"small"},{default:t(()=>[...e[137]||(e[137]=[u("已选择",-1)])]),_:1})):$("",!0)]),e[140]||(e[140]=s("div",{class:"upload-desc"},"包含题目内容、答案等信息",-1)),l(Ge,{action:"#","auto-upload":!1,"on-change":a=>Tl(a,"questions"),accept:".json",limit:1,"file-list":bl.value},{default:t(()=>[l(n,{type:"primary",size:"small"},{default:t(()=>[...e[139]||(e[139]=[u("选择文件",-1)])]),_:1})]),_:1},8,["on-change","file-list"]),T.questionsData?(i(),C("div",Lo,[l(M,null,{default:t(()=>[l(A(Ye))]),_:1}),s("span",null,b(T.questionsData.length)+" 道题目",1)])):$("",!0)])]),_:1}),l(y,{span:8},{default:t(()=>[s("div",No,[s("div",Oo,[e[142]||(e[142]=s("span",{class:"upload-title"},"详情文件",-1)),T.detailsFile?(i(),_(I,{key:0,type:"success",size:"small"},{default:t(()=>[...e[141]||(e[141]=[u("已选择",-1)])]),_:1})):$("",!0)]),e[144]||(e[144]=s("div",{class:"upload-desc"},"包含题目详解、考点等信息",-1)),l(Ge,{action:"#","auto-upload":!1,"on-change":a=>Tl(a,"details"),accept:".json",limit:1,"file-list":Cl.value},{default:t(()=>[l(n,{type:"primary",size:"small"},{default:t(()=>[...e[143]||(e[143]=[u("选择文件",-1)])]),_:1})]),_:1},8,["on-change","file-list"]),T.detailsData?(i(),C("div",Ao,[l(M,null,{default:t(()=>[l(A(Ye))]),_:1}),s("span",null,b(Object.keys(T.detailsData).length)+" 条详情",1)])):$("",!0)])]),_:1})]),_:1})]),_:1}),l(Xe,{class:"mb-20",shadow:"hover"},{header:t(()=>[s("div",Po,[e[146]||(e[146]=s("span",null,"相关题导入",-1)),W.value?(i(),_(I,{key:0,type:"success",size:"small",class:"ml-10"},{default:t(()=>[...e[145]||(e[145]=[u("已加载",-1)])]),_:1})):$("",!0)])]),default:t(()=>[l(L,{gutter:20,align:"middle"},{default:t(()=>[l(y,{span:12},{default:t(()=>[l(Ge,{action:"#","auto-upload":!1,"on-change":mt,accept:".json",limit:1,"file-list":kl.value},{default:t(()=>[l(n,{type:"warning",size:"small"},{default:t(()=>[l(M,null,{default:t(()=>[l(A(qa))]),_:1}),e[147]||(e[147]=u(" 选择相关题文件 ",-1))]),_:1})]),_:1},8,["file-list"]),e[148]||(e[148]=s("div",{class:"upload-desc mt-10"},'JSON格式：{"题目ID": ["相关题ID1", "相关题ID2", ...]}',-1))]),_:1}),l(y,{span:12},{default:t(()=>[W.value?(i(),C("div",Fo,[l(M,null,{default:t(()=>[l(A(Ye))]),_:1}),s("span",null,b(Object.keys(W.value).length)+" 道题有相关题关联",1)])):$("",!0)]),_:1})]),_:1})]),_:1}),Ae.value.total>0||W.value?(i(),_(Xe,{key:0,class:"mb-20",shadow:"hover"},{header:t(()=>[...e[149]||(e[149]=[s("div",{class:"card-header"},[s("span",null,"导入预览")],-1)])]),default:t(()=>[l(Ca,{column:5,border:""},{default:t(()=>[l(We,{label:"结构数据"},{default:t(()=>[u(b(Ae.value.structCount)+" 条",1)]),_:1}),l(We,{label:"题目数据"},{default:t(()=>[u(b(Ae.value.questionsCount)+" 道",1)]),_:1}),l(We,{label:"详情数据"},{default:t(()=>[u(b(Ae.value.detailsCount)+" 条",1)]),_:1}),l(We,{label:"相关题关联"},{default:t(()=>[u(b(Pl.value)+" 条",1)]),_:1}),l(We,{label:"预计导入"},{default:t(()=>[u(b(Ae.value.total+Pl.value)+" 条",1)]),_:1})]),_:1})]),_:1})):$("",!0),s("div",Ko,[l(n,{type:"primary",size:"large",onClick:ct,loading:wl.value,disabled:!_l.value&&!W.value},{default:t(()=>[...e[150]||(e[150]=[u(" 开始导入 ",-1)])]),_:1},8,["loading","disabled"]),l(n,{size:"large",onClick:vt},{default:t(()=>[...e[151]||(e[151]=[u("清空",-1)])]),_:1})]),K.value?(i(),C("div",Jo,[l(wa,{title:K.value.success?"导入成功":"导入失败",type:K.value.success?"success":"error","show-icon":""},{default:t(()=>[K.value.success?(i(),C("div",Eo,[s("p",null,"创建书籍: "+b(K.value.data.totalBooks)+" 本",1),s("p",null,"创建题目: "+b(K.value.data.questionsCreated)+" 道",1),s("p",null,"更新题目: "+b(K.value.data.questionsUpdated)+" 道",1),s("p",null,"创建详情: "+b(K.value.data.detailsCreated)+" 条",1),s("p",null,"创建关联: "+b(K.value.data.linksCreated)+" 条",1),K.value.data.relatedQuestionsImported?(i(),C("p",Ho,"相关题关联: "+b(K.value.data.relatedQuestionsImported)+" 条",1)):$("",!0)])):(i(),C("div",Ro,b(K.value.message),1))]),_:1},8,["title","type"])])):$("",!0)])]),_:1}),l(U,{label:"题目导入",name:"import"},{default:t(()=>[s("div",Xo,[l(L,{gutter:20},{default:t(()=>[l(y,{span:8},{default:t(()=>[e[152]||(e[152]=s("div",{class:"select-label"},"选择书籍",-1)),l(B,{modelValue:ve.value,"onUpdate:modelValue":e[25]||(e[25]=a=>ve.value=a),placeholder:"请选择书籍",style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(Ce.value,a=>(i(),_(g,{key:a.BookID,label:a.BookTitle,value:a.BookID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{span:8},{default:t(()=>[e[153]||(e[153]=s("div",{class:"select-label"},"选择章节（可选）",-1)),l(B,{modelValue:ll.value,"onUpdate:modelValue":e[26]||(e[26]=a=>ll.value=a),placeholder:"不选择则按JSON中的章节导入",style:{width:"100%"},disabled:!ve.value||hl.value.length===0,clearable:""},{default:t(()=>[(i(!0),C(z,null,j(hl.value,a=>(i(),_(g,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(L,{class:"mt-20"},{default:t(()=>[l(y,{span:24},{default:t(()=>[l(d,{modelValue:Pe.value,"onUpdate:modelValue":e[27]||(e[27]=a=>Pe.value=a),size:"small"},{default:t(()=>[l(v,{label:"file"},{default:t(()=>[...e[154]||(e[154]=[u("文件上传",-1)])]),_:1}),l(v,{label:"source"},{default:t(()=>[...e[155]||(e[155]=[u("源代码编辑",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),Pe.value==="file"?(i(),C("div",Go,[l(Ge,{drag:"",action:"#","auto-upload":!1,"on-change":sa,accept:".json",limit:1},{tip:t(()=>[s("div",Wo,[e[157]||(e[157]=u(" 请上传JSON格式的题目文件，",-1)),l(ka,{type:"primary",onClick:Ql(Wl,["prevent"])},{default:t(()=>[...e[156]||(e[156]=[u("查看模板",-1)])]),_:1})])]),default:t(()=>[l(M,{class:"el-icon--upload"},{default:t(()=>[l(A(Ba))]),_:1}),e[158]||(e[158]=s("div",{class:"el-upload__text"},[u(" 拖拽文件到此处或 "),s("em",null,"点击上传")],-1))]),_:1})])):(i(),C("div",Yo,[l(L,{gutter:20},{default:t(()=>[l(y,{span:12},{default:t(()=>[s("div",Zo,[e[162]||(e[162]=s("h4",null,"源代码编辑（JSON格式）",-1)),l(q,{modelValue:ie.value,"onUpdate:modelValue":e[28]||(e[28]=a=>ie.value=a),type:"textarea",rows:20,placeholder:'请输入JSON格式的题目数据数组，如：[{"QuestionText": "...", ...}]',class:"source-code-input"},null,8,["modelValue"]),s("div",es,[l(n,{size:"small",onClick:ia},{default:t(()=>[...e[159]||(e[159]=[u("格式化JSON",-1)])]),_:1}),l(n,{size:"small",type:"primary",onClick:ua},{default:t(()=>[...e[160]||(e[160]=[u("解析数据",-1)])]),_:1}),l(n,{size:"small",onClick:Wl},{default:t(()=>[...e[161]||(e[161]=[u("查看模板",-1)])]),_:1})])])]),_:1}),l(y,{span:12},{default:t(()=>[s("div",ls,[e[163]||(e[163]=s("h4",null,"数据预览",-1)),N.value.length>0?(i(),C("div",ts,[s("p",as,"共 "+b(N.value.length)+" 道题目",1),l(_a,{height:"400px"},{default:t(()=>[(i(!0),C(z,null,j(N.value.slice(0,10),(a,c)=>(i(),C("div",{key:c,class:"preview-item"},[s("div",os,[s("span",ss,"#"+b(c+1),1),l(I,{size:"small"},{default:t(()=>[u(b(a.QuestionType||a.questionType||"未知题型"),1)]),_:2},1024),a.BookChapter||a.bookChapter?(i(),C("span",ns,b(a.BookChapter||a.bookChapter),1)):$("",!0)]),s("div",{class:"preview-item-content",innerHTML:te((a.QuestionText||a.questionText||"").substring(0,100))+"..."},null,8,is)]))),128)),N.value.length>10?(i(),C("div",us," 还有 "+b(N.value.length-10)+" 道题... ",1)):$("",!0)]),_:1})])):(i(),_($l,{key:1,description:"请输入JSON数据并点击解析"}))])]),_:1})]),_:1})])),N.value.length>0&&Pe.value==="file"?(i(),C("div",rs,[s("h4",null,"导入预览（共 "+b(N.value.length)+" 道题）",1),l(D,{data:N.value.slice(0,5),border:"",stripe:"",size:"small"},{default:t(()=>[l(f,{prop:"QuestionID",label:"ID",width:"80",align:"center"}),l(f,{prop:"QuestionType",label:"题型",width:"100",align:"center"}),l(f,{prop:"QuestionText",label:"题干","show-overflow-tooltip":""}),l(f,{prop:"BookChapter",label:"章节",width:"150"})]),_:1},8,["data"]),N.value.length>5?(i(),C("div",ds,"还有 "+b(N.value.length-5)+" 道题...",1)):$("",!0)])):$("",!0),s("div",ps,[l(n,{type:"primary",size:"large",onClick:na,loading:Vl.value,disabled:N.value.length===0||!ve.value},{default:t(()=>[...e[164]||(e[164]=[u("开始导入",-1)])]),_:1},8,["loading","disabled"]),l(n,{size:"large",onClick:Yl},{default:t(()=>[...e[165]||(e[165]=[u("清空",-1)])]),_:1})])])]),_:1}),l(U,{label:"考点分类",name:"knowledgeCategories"},{default:t(()=>[s("div",cs,[s("div",vs,[l(n,{type:"primary",onClick:da},{default:t(()=>[...e[166]||(e[166]=[u("+ 添加科目",-1)])]),_:1}),l(n,{onClick:Re},{default:t(()=>[...e[167]||(e[167]=[u("刷新",-1)])]),_:1})]),l(Ta,{data:et.value,props:ra,"node-key":"id","default-expand-all":"","highlight-current":""},{default:t(({node:a,data:c})=>[s("div",ms,[s("span",fs,[fe(c)===1?(i(),_(I,{key:0,size:"small",type:"danger"},{default:t(()=>[...e[168]||(e[168]=[u("科目",-1)])]),_:1})):fe(c)===2?(i(),_(I,{key:1,size:"small",type:"warning"},{default:t(()=>[...e[169]||(e[169]=[u("章节",-1)])]),_:1})):(i(),_(I,{key:2,size:"small",type:"success"},{default:t(()=>[...e[170]||(e[170]=[u("考点",-1)])]),_:1})),u(" "+b(a.label),1)]),s("span",ys,[l(I,{size:"small",type:"info"},{default:t(()=>[u(b(c.CategoryCode),1)]),_:2},1024),c.QuestionCount?(i(),_(I,{key:0,size:"small"},{default:t(()=>[u(b(c.QuestionCount)+"题",1)]),_:2},1024)):$("",!0),l(I,{type:c.IsActive===1?"success":"danger",size:"small"},{default:t(()=>[u(b(c.IsActive===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),s("span",gs,[l(n,{size:"small",onClick:V=>ca(c)},{default:t(()=>[...e[171]||(e[171]=[u("编辑",-1)])]),_:1},8,["onClick"]),fe(c)!==3?(i(),_(n,{key:0,size:"small",type:"primary",onClick:V=>pa(c)},{default:t(()=>[u(b(fe(c)===1?"添加章节":"添加考点"),1)]),_:2},1032,["onClick"])):$("",!0),fe(c)===3?(i(),_(n,{key:1,size:"small",type:"warning",onClick:V=>va(c)},{default:t(()=>[...e[172]||(e[172]=[u("移动",-1)])]),_:1},8,["onClick"])):$("",!0),l(n,{size:"small",type:"danger",onClick:V=>ga(c.id)},{default:t(()=>[...e[173]||(e[173]=[u("删除",-1)])]),_:1},8,["onClick"])])])]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"]),l(re,{modelValue:$e.value,"onUpdate:modelValue":e[44]||(e[44]=a=>$e.value=a),title:"编辑题目",width:"95%",top:"2vh","destroy-on-close":"","close-on-click-modal":!1,class:"edit-question-dialog"},{footer:t(()=>[s("span",Ks,[l(n,{onClick:e[43]||(e[43]=a=>$e.value=!1)},{default:t(()=>[...e[188]||(e[188]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:St,loading:we.value},{default:t(()=>[...e[189]||(e[189]=[u("保存",-1)])]),_:1},8,["loading"])])]),default:t(()=>[Me.value?(i(),C("div",bs,[s("div",Cs,[e[179]||(e[179]=s("div",{class:"sidebar-header"},"内容导航",-1)),s("div",ws,[s("div",{class:qe(["sidebar-item",{active:ge.value==="basic"}]),onClick:e[30]||(e[30]=a=>Be("basic"))},[l(M,null,{default:t(()=>[l(A($a))]),_:1}),e[174]||(e[174]=s("span",null,"基本信息",-1))],2),s("div",{class:qe(["sidebar-item",{active:ge.value==="question"}]),onClick:e[31]||(e[31]=a=>Be("question"))},[l(M,null,{default:t(()=>[l(A(Ye))]),_:1}),e[175]||(e[175]=s("span",null,"题干内容",-1))],2),s("div",{class:qe(["sidebar-item",{active:ge.value==="answer"}]),onClick:e[32]||(e[32]=a=>Be("answer"))},[l(M,null,{default:t(()=>[l(A(Ma))]),_:1}),e[176]||(e[176]=s("span",null,"答案内容",-1))],2),e[178]||(e[178]=s("div",{class:"sidebar-divider"},"详情卡片",-1)),(i(!0),C(z,null,j(m.details,(a,c)=>(i(),C("div",{key:a.ID||a._tmpId,class:qe(["sidebar-item",{active:ge.value==="detail-"+c}]),onClick:V=>Be("detail-"+c)},[l(I,{type:Kl(a.BusType),size:"small"},{default:t(()=>[u(b(a.BusType),1)]),_:2},1032,["type"]),s("span",_s,b(a.Title||a.BusType),1)],10,ks))),128)),s("div",{class:"sidebar-item add-item",onClick:dt},[l(M,null,{default:t(()=>[l(A(Qa))]),_:1}),e[177]||(e[177]=s("span",null,"新增卡片",-1))])])]),s("div",Ts,[s("div",hs,[e[180]||(e[180]=s("div",{class:"section-title"},"基本信息",-1)),l(L,{gutter:20},{default:t(()=>[l(y,{span:6},{default:t(()=>[l(k,{label:"题型"},{default:t(()=>[l(B,{modelValue:m.questionType,"onUpdate:modelValue":e[33]||(e[33]=a=>m.questionType=a),style:{width:"100%"}},{default:t(()=>[l(g,{label:"单选题",value:"单选题"}),l(g,{label:"多选题",value:"多选题"}),l(g,{label:"填空题",value:"填空题"}),l(g,{label:"解答题",value:"解答题"}),l(g,{label:"判断题",value:"判断题"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(k,{label:"难度"},{default:t(()=>[l(Bl,{modelValue:m.difficulty,"onUpdate:modelValue":e[34]||(e[34]=a=>m.difficulty=a),max:5},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(k,{label:"题目ID"},{default:t(()=>[l(q,{modelValue:Me.value.QuestionID,"onUpdate:modelValue":e[35]||(e[35]=a=>Me.value.QuestionID=a),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(k,{label:"所属书籍"},{default:t(()=>[l(B,{modelValue:m.bookId,"onUpdate:modelValue":e[36]||(e[36]=a=>m.bookId=a),placeholder:"请选择书籍",style:{width:"100%"},clearable:"",onChange:kt},{default:t(()=>[(i(!0),C(z,null,j(Ce.value,a=>(i(),_(g,{key:a.BookID,label:a.BookTitle,value:a.BookID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(L,{gutter:20},{default:t(()=>[l(y,{span:6},{default:t(()=>[l(k,{label:"所属章节"},{default:t(()=>[l(B,{modelValue:m.bookChapter,"onUpdate:modelValue":e[37]||(e[37]=a=>m.bookChapter=a),placeholder:"请选择章节",style:{width:"100%"},clearable:"",disabled:!m.bookId},{default:t(()=>[(i(!0),C(z,null,j(pe.value,a=>(i(),_(g,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(k,{label:"页码"},{default:t(()=>[l(ye,{modelValue:m.questionPage,"onUpdate:modelValue":e[38]||(e[38]=a=>m.questionPage=a),min:1,max:9999,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(k,{label:"排序"},{default:t(()=>[l(ye,{modelValue:m.questionSort,"onUpdate:modelValue":e[39]||(e[39]=a=>m.questionSort=a),min:1,max:9999,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:t(()=>[l(k,{label:"章节排序"},{default:t(()=>[l(ye,{modelValue:m.chapterSort,"onUpdate:modelValue":e[40]||(e[40]=a=>m.chapterSort=a),min:1,max:9999,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),s("div",Vs,[e[182]||(e[182]=s("div",{class:"section-title"},"题干内容",-1)),l(L,{gutter:20,class:"edit-preview-row"},{default:t(()=>[l(y,{span:12,class:"edit-area"},{default:t(()=>[l(k,{label:"编辑"},{default:t(()=>[l(q,{modelValue:m.questionText,"onUpdate:modelValue":e[41]||(e[41]=a=>m.questionText=a),type:"textarea",autosize:{minRows:10},placeholder:"请输入题干内容，支持LaTeX公式"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12,class:"preview-area"},{default:t(()=>[e[181]||(e[181]=s("div",{class:"preview-label"},"预览",-1)),s("div",{class:"latex-preview-box auto-height",innerHTML:te(m.questionText)},null,8,xs)]),_:1})]),_:1})]),s("div",Ss,[e[184]||(e[184]=s("div",{class:"section-title"},"答案内容",-1)),l(L,{gutter:20,class:"edit-preview-row"},{default:t(()=>[l(y,{span:12,class:"edit-area"},{default:t(()=>[l(k,{label:"编辑"},{default:t(()=>[l(q,{modelValue:m.answerText,"onUpdate:modelValue":e[42]||(e[42]=a=>m.answerText=a),type:"textarea",autosize:{minRows:10},placeholder:"请输入答案内容，支持LaTeX公式"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12,class:"preview-area"},{default:t(()=>[e[183]||(e[183]=s("div",{class:"preview-label"},"预览",-1)),s("div",{class:"latex-preview-box auto-height",innerHTML:te(m.answerText)},null,8,Is)]),_:1})]),_:1})]),s("div",Ds,[e[186]||(e[186]=s("div",{class:"section-title"},"题目详情 (解析/考点等)",-1)),s("div",qs,[(i(!0),C(z,null,j(m.details,(a,c)=>(i(),_(Xe,{key:a.ID||a._tmpId,id:"section-detail-"+c,class:qe(["detail-card mb-10",{"is-expanded":a._expanded,"kp-card":a.LinkedKnowledgePointID}])},{header:t(()=>[s("div",Bs,[s("div",$s,[l(I,{type:Kl(a.BusType),size:"small"},{default:t(()=>[u(b(a.BusType),1)]),_:2},1032,["type"]),l(q,{modelValue:a.Title,"onUpdate:modelValue":V=>a.Title=V,placeholder:"详情标题",size:"small",class:"detail-title-input"},null,8,["modelValue","onUpdate:modelValue"]),a.LinkedKnowledgePointID&&al(a.LinkedKnowledgePointID)?(i(),C("span",Ms,[l(M,null,{default:t(()=>[l(A(nt))]),_:1}),u(" "+b(al(a.LinkedKnowledgePointID).KPTitle),1)])):$("",!0)]),s("div",Qs,[c>0?(i(),_(n,{key:0,link:"",size:"small",onClick:V=>Jl(c,-1)},{default:t(()=>[l(M,null,{default:t(()=>[l(A(Ua))]),_:1})]),_:1},8,["onClick"])):$("",!0),c<m.details.length-1?(i(),_(n,{key:1,link:"",size:"small",onClick:V=>Jl(c,1)},{default:t(()=>[l(M,null,{default:t(()=>[l(A(za))]),_:1})]),_:1},8,["onClick"])):$("",!0),l(n,{link:"",type:"danger",size:"small",onClick:V=>Vt(c)},{default:t(()=>[l(M,null,{default:t(()=>[l(A(it))]),_:1})]),_:1},8,["onClick"])])])]),default:t(()=>[s("div",Us,[l(L,{gutter:20,class:"mb-10"},{default:t(()=>[l(y,{span:6},{default:t(()=>[l(k,{label:"业务类型"},{default:t(()=>[l(B,{modelValue:a.BusType,"onUpdate:modelValue":V=>a.BusType=V,style:{width:"100%"},onChange:El,size:"small"},{default:t(()=>[l(g,{label:"analysis",value:"analysis"}),l(g,{label:"answer",value:"answer"}),l(g,{label:"commentary",value:"commentary"}),l(g,{label:"keypoint",value:"keypoint"}),l(g,{label:"solution",value:"solution"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l(y,{span:4},{default:t(()=>[l(k,{label:"排序"},{default:t(()=>[l(ye,{modelValue:a.Give,"onUpdate:modelValue":V=>a.Give=V,min:0,onChange:El,style:{width:"100%"},size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l(y,{span:6},{default:t(()=>[l(k,{label:"关联考点ID"},{default:t(()=>[l(q,{modelValue:a.LinkedKnowledgePointID,"onUpdate:modelValue":V=>a.LinkedKnowledgePointID=V,placeholder:"考点ID",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a.LinkedKnowledgePointID&&al(a.LinkedKnowledgePointID)?(i(),_(y,{key:0,span:8},{default:t(()=>[l(k,{label:"考点名称"},{default:t(()=>[s("div",zs,[l(M,null,{default:t(()=>[l(A(nt))]),_:1}),s("span",null,b(al(a.LinkedKnowledgePointID).KPTitle),1)])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024),l(L,{gutter:20,class:"edit-preview-row"},{default:t(()=>[l(y,{span:12,class:"edit-area"},{default:t(()=>[l(k,{label:a.LinkedKnowledgePointID?"考点内容":"主要内容"},{default:t(()=>[l(q,{modelValue:a.Context,"onUpdate:modelValue":V=>a.Context=V,type:"textarea",autosize:{minRows:8},placeholder:a.LinkedKnowledgePointID?"编辑考点内容，支持LaTeX公式和图片":"支持LaTeX公式"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])]),_:2},1024),l(y,{span:12,class:"preview-area"},{default:t(()=>[e[185]||(e[185]=s("div",{class:"preview-label"},"预览",-1)),s("div",{class:"latex-preview-box auto-height",innerHTML:te(a.Context)},null,8,js)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["id","class"]))),128))])]),s("div",Ls,[e[187]||(e[187]=s("div",{class:"section-title"},"LaTeX公式助手",-1)),s("div",Ns,[(i(),C(z,null,j(Fl,a=>s("div",{key:a.name,class:"latex-category"},[s("div",Os,b(a.name),1),s("div",As,[(i(!0),C(z,null,j(a.symbols,c=>(i(),C("div",{key:c.code,class:"latex-symbol-btn",onClick:V=>xt(c.code),title:c.label+": "+c.code},[s("span",{class:"symbol-visual",innerHTML:wt(c.display)},null,8,Fs)],8,Ps))),128))])])),64))])])])])):$("",!0)]),_:1},8,["modelValue"]),l(re,{modelValue:Qe.value,"onUpdate:modelValue":e[51]||(e[51]=a=>Qe.value=a),title:"创建题目",width:"80%",top:"5vh","destroy-on-close":""},{footer:t(()=>[s("span",Js,[l(n,{onClick:e[50]||(e[50]=a=>Qe.value=!1)},{default:t(()=>[...e[190]||(e[190]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:qt,loading:vl.value},{default:t(()=>[...e[191]||(e[191]=[u("创建",-1)])]),_:1},8,["loading"])])]),default:t(()=>[E.value?(i(),_(Se,{key:0,model:E.value,"label-position":"top"},{default:t(()=>[l(L,{gutter:20},{default:t(()=>[l(y,{span:8},{default:t(()=>[l(k,{label:"题型",required:""},{default:t(()=>[l(B,{modelValue:E.value.QuestionType,"onUpdate:modelValue":e[45]||(e[45]=a=>E.value.QuestionType=a),style:{width:"100%"}},{default:t(()=>[l(g,{label:"单选题",value:"单选题"}),l(g,{label:"多选题",value:"多选题"}),l(g,{label:"填空题",value:"填空题"}),l(g,{label:"解答题",value:"解答题"}),l(g,{label:"判断题",value:"判断题"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{span:8},{default:t(()=>[l(k,{label:"难度"},{default:t(()=>[l(Bl,{modelValue:E.value.Difficulty,"onUpdate:modelValue":e[46]||(e[46]=a=>E.value.Difficulty=a),max:5},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,{label:"题干",required:""},{default:t(()=>[l(q,{modelValue:E.value.QuestionText,"onUpdate:modelValue":e[47]||(e[47]=a=>E.value.QuestionText=a),type:"textarea",rows:4,placeholder:"请输入题干，支持LaTeX公式"},null,8,["modelValue"])]),_:1}),l(k,{label:"答案"},{default:t(()=>[l(q,{modelValue:E.value.OriginalAnswerText,"onUpdate:modelValue":e[48]||(e[48]=a=>E.value.OriginalAnswerText=a),type:"textarea",rows:3,placeholder:"请输入答案"},null,8,["modelValue"])]),_:1}),l(k,{label:"关联书籍"},{default:t(()=>[l(B,{modelValue:E.value.bookIds,"onUpdate:modelValue":e[49]||(e[49]=a=>E.value.bookIds=a),multiple:"",placeholder:"选择关联书籍",style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(Ce.value,a=>(i(),_(g,{key:a.BookID,label:a.BookName,value:a.BookID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):$("",!0)]),_:1},8,["modelValue"]),l(re,{modelValue:Ue.value,"onUpdate:modelValue":e[55]||(e[55]=a=>Ue.value=a),title:(lt=H.value)!=null&&lt.SubjectID?"编辑科目":"创建科目",width:"500px","destroy-on-close":""},{footer:t(()=>[s("span",Es,[l(n,{onClick:e[54]||(e[54]=a=>Ue.value=!1)},{default:t(()=>[...e[192]||(e[192]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:Bt},{default:t(()=>[...e[193]||(e[193]=[u("保存",-1)])]),_:1})])]),default:t(()=>[H.value?(i(),_(Se,{key:0,model:H.value,"label-width":"100px"},{default:t(()=>[l(k,{label:"科目名称",required:""},{default:t(()=>[l(q,{modelValue:H.value.SubjectName,"onUpdate:modelValue":e[52]||(e[52]=a=>H.value.SubjectName=a),placeholder:"请输入科目名称"},null,8,["modelValue"])]),_:1}),l(k,{label:"描述"},{default:t(()=>[l(q,{modelValue:H.value.description,"onUpdate:modelValue":e[53]||(e[53]=a=>H.value.description=a),type:"textarea",rows:3,placeholder:"请输入科目描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):$("",!0)]),_:1},8,["modelValue","title"]),l(re,{modelValue:ze.value,"onUpdate:modelValue":e[65]||(e[65]=a=>ze.value=a),title:(tt=x.value)!=null&&tt.BookID?"编辑书籍":"创建书籍",width:"600px","destroy-on-close":""},{footer:t(()=>[s("span",Hs,[l(n,{onClick:e[64]||(e[64]=a=>ze.value=!1)},{default:t(()=>[...e[194]||(e[194]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:Mt},{default:t(()=>[...e[195]||(e[195]=[u("保存",-1)])]),_:1})])]),default:t(()=>[x.value?(i(),_(Se,{key:0,model:x.value,"label-width":"100px"},{default:t(()=>[l(k,{label:"书籍名称",required:""},{default:t(()=>[l(q,{modelValue:x.value.BookTitle,"onUpdate:modelValue":e[56]||(e[56]=a=>x.value.BookTitle=a),placeholder:"请输入书籍名称"},null,8,["modelValue"])]),_:1}),l(k,{label:"内容类型",required:""},{default:t(()=>[l(B,{modelValue:x.value.ContentType,"onUpdate:modelValue":e[57]||(e[57]=a=>x.value.ContentType=a),style:{width:"100%"}},{default:t(()=>[l(g,{label:"书籍",value:"book"}),l(g,{label:"真题卷",value:"real_paper"}),l(g,{label:"模拟卷",value:"mock_paper"})]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"计数类型",required:""},{default:t(()=>[l(B,{modelValue:x.value.CountType,"onUpdate:modelValue":e[58]||(e[58]=a=>x.value.CountType=a),style:{width:"100%"}},{default:t(()=>[l(g,{label:"题数",value:"question"}),l(g,{label:"套数",value:"set"})]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"所属科目",required:""},{default:t(()=>[l(B,{modelValue:x.value.SubjectIDs,"onUpdate:modelValue":e[59]||(e[59]=a=>x.value.SubjectIDs=a),multiple:"",style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(be.value,a=>(i(),_(g,{key:a.SubjectID,label:a.SubjectName,value:a.SubjectID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"版本信息"},{default:t(()=>[l(q,{modelValue:x.value.VersionInfo,"onUpdate:modelValue":e[60]||(e[60]=a=>x.value.VersionInfo=a),placeholder:"如：2024版"},null,8,["modelValue"])]),_:1}),l(k,{label:"学习人数"},{default:t(()=>[l(ye,{modelValue:x.value.LearnerCount,"onUpdate:modelValue":e[61]||(e[61]=a=>x.value.LearnerCount=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(k,{label:"排序"},{default:t(()=>[l(ye,{modelValue:x.value.SortOrder,"onUpdate:modelValue":e[62]||(e[62]=a=>x.value.SortOrder=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(k,{label:"描述"},{default:t(()=>[l(q,{modelValue:x.value.Description,"onUpdate:modelValue":e[63]||(e[63]=a=>x.value.Description=a),type:"textarea",rows:"3",placeholder:"书籍描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):$("",!0)]),_:1},8,["modelValue","title"]),l(re,{modelValue:_e.value,"onUpdate:modelValue":e[70]||(e[70]=a=>_e.value=a),title:Ne.value?`添加题目到章节: ${Oe.value}`:"添加题目到书籍",width:"80%","destroy-on-close":""},{footer:t(()=>[s("span",Gs,[l(n,{onClick:e[69]||(e[69]=a=>_e.value=!1)},{default:t(()=>[...e[197]||(e[197]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:Rt,disabled:ce.value.length===0},{default:t(()=>[u(" 添加选中题目 ("+b(ce.value.length)+") ",1)]),_:1},8,["disabled"])])]),default:t(()=>[s("div",Rs,[l(q,{modelValue:G.keyword,"onUpdate:modelValue":e[66]||(e[66]=a=>G.keyword=a),placeholder:"搜索题目...",clearable:"",onKeyup:Ml(Ke,["enter"])},{append:t(()=>[l(n,{onClick:Ke},{default:t(()=>[...e[196]||(e[196]=[u("搜索",-1)])]),_:1})]),_:1},8,["modelValue"])]),De((i(),_(D,{key:Le.value.length,data:Le.value,border:"",stripe:"",onSelectionChange:Ht},{default:t(()=>[l(f,{type:"selection",width:"55",align:"center"}),l(f,{prop:"QuestionID",label:"题目ID",width:"100",align:"center"}),l(f,{prop:"QuestionText",label:"题干","min-width":"300","show-overflow-tooltip":""}),l(f,{prop:"QuestionType",label:"题型",width:"100",align:"center"})]),_:1},8,["data"])),[[Ie,yl.value]]),s("div",Xs,[l(Q,{"current-page":G.page,"onUpdate:currentPage":e[67]||(e[67]=a=>G.page=a),"page-size":G.pageSize,"onUpdate:pageSize":e[68]||(e[68]=a=>G.pageSize=a),total:Al.value,layout:"total, prev, pager, next",onCurrentChange:Ke},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"]),l(re,{modelValue:ml.value,"onUpdate:modelValue":e[71]||(e[71]=a=>ml.value=a),title:((at=F.value)==null?void 0:at.BookTitle)+" - 书籍详情",width:"90%",top:"2vh","destroy-on-close":"",class:"book-detail-dialog"},{default:t(()=>{var a;return[F.value?(i(),C("div",Ws,[s("div",Ys,[s("div",Zs,[e[199]||(e[199]=s("span",null,"章节列表",-1)),l(n,{size:"small",type:"primary",onClick:Kt},{default:t(()=>[...e[198]||(e[198]=[u("+ 添加章节",-1)])]),_:1})]),s("div",en,[(i(!0),C(z,null,j(Ze.value,c=>{var V;return i(),C("div",{key:c.name,class:qe(["chapter-item",{active:((V=R.value)==null?void 0:V.name)===c.name}]),onClick:ot=>jt(c)},[s("div",tn,[s("span",an,b(c.name||"未分类"),1),s("span",on,"("+b(c.questionCount)+"题)",1)]),s("div",sn,[l(n,{size:"small",link:"",onClick:Ql(ot=>Lt(c),["stop"])},{default:t(()=>[l(M,null,{default:t(()=>[l(A(ja))]),_:1})]),_:1},8,["onClick"]),l(n,{size:"small",link:"",type:"danger",onClick:Ql(ot=>Nt(c),["stop"])},{default:t(()=>[l(M,null,{default:t(()=>[l(A(it))]),_:1})]),_:1},8,["onClick"])])],10,ln)}),128))])]),s("div",nn,[s("div",un,[s("h3",null,b(((a=R.value)==null?void 0:a.name)||"全部题目"),1),s("div",rn,[R.value?(i(),_(n,{key:0,size:"small",type:"primary",onClick:Jt},{default:t(()=>[...e[200]||(e[200]=[u("添加题目",-1)])]),_:1})):$("",!0),l(n,{size:"small",type:"danger",onClick:Ft,disabled:ke.value.length===0},{default:t(()=>[...e[201]||(e[201]=[u("批量删除",-1)])]),_:1},8,["disabled"])])]),De((i(),_(D,{data:el.value,border:"",stripe:"",onSelectionChange:Pt},{default:t(()=>[l(f,{type:"selection",width:"55",align:"center"}),l(f,{prop:"QuestionID",label:"题目ID",width:"100",align:"center"}),l(f,{prop:"BookChapter",label:"所属章节",width:"150",align:"center","show-overflow-tooltip":""}),l(f,{prop:"QuestionPage",label:"页码",width:"80",align:"center"}),l(f,{prop:"QuestionSort",label:"排序",width:"80",align:"center"}),l(f,{prop:"QuestionText",label:"题干","min-width":"300","show-overflow-tooltip":""},{default:t(({row:c})=>{var V;return[s("div",{innerHTML:te(((V=c.QuestionText)==null?void 0:V.substring(0,100))+"...")},null,8,dn)]}),_:1}),l(f,{prop:"QuestionType",label:"题型",width:"100",align:"center"}),l(f,{label:"操作",width:"150",align:"center",fixed:"right"},{default:t(({row:c})=>[l(n,{size:"small",onClick:V=>Ot(c)},{default:t(()=>[...e[202]||(e[202]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",type:"danger",onClick:V=>At(c)},{default:t(()=>[...e[203]||(e[203]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ie,je.value]])])])):$("",!0)]}),_:1},8,["modelValue","title"]),l(re,{modelValue:me.value,"onUpdate:modelValue":e[78]||(e[78]=a=>me.value=a),title:He.value?"编辑":nl.value?"添加科目":sl.value?fe({CategoryCode:ql.value})===1?"添加章节":"添加考点":"",width:"600px"},{footer:t(()=>[l(n,{onClick:e[77]||(e[77]=a=>me.value=!1)},{default:t(()=>[...e[204]||(e[204]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:ya,loading:Il.value},{default:t(()=>[...e[205]||(e[205]=[u("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Se,{model:O,"label-width":"100px"},{default:t(()=>[l(k,{label:"分类编码"},{default:t(()=>[l(q,{modelValue:O.CategoryCode,"onUpdate:modelValue":e[72]||(e[72]=a=>O.CategoryCode=a),placeholder:"自动生成",disabled:""},null,8,["modelValue"])]),_:1}),l(k,{label:"分类名称"},{default:t(()=>[l(q,{modelValue:O.CategoryName,"onUpdate:modelValue":e[73]||(e[73]=a=>O.CategoryName=a),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(k,{label:"描述"},{default:t(()=>[l(q,{modelValue:O.Description,"onUpdate:modelValue":e[74]||(e[74]=a=>O.Description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(k,{label:"排序"},{default:t(()=>[l(ye,{modelValue:O.SortOrder,"onUpdate:modelValue":e[75]||(e[75]=a=>O.SortOrder=a),min:0},null,8,["modelValue"])]),_:1}),l(k,{label:"状态"},{default:t(()=>[l(Va,{modelValue:O.IsActive,"onUpdate:modelValue":e[76]||(e[76]=a=>O.IsActive=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(re,{modelValue:Ee.value,"onUpdate:modelValue":e[82]||(e[82]=a=>Ee.value=a),title:"移动考点",width:"500px"},{footer:t(()=>[l(n,{onClick:e[81]||(e[81]=a=>Ee.value=!1)},{default:t(()=>[...e[206]||(e[206]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:fa,loading:Dl.value},{default:t(()=>[...e[207]||(e[207]=[u("确定移动",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Se,{"label-width":"100px"},{default:t(()=>[l(k,{label:"当前考点"},{default:t(()=>[l(I,null,{default:t(()=>{var a;return[u(b((a=ue.value)==null?void 0:a.CategoryName),1)]}),_:1})]),_:1}),l(k,{label:"目标科目"},{default:t(()=>[l(B,{modelValue:Ve.value,"onUpdate:modelValue":e[79]||(e[79]=a=>Ve.value=a),placeholder:"请选择目标科目",style:{width:"100%"},onChange:ma},{default:t(()=>[(i(!0),C(z,null,j(et.value,a=>(i(),_(g,{key:a.id,label:a.CategoryName,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Ve.value?(i(),_(k,{key:0,label:"目标章节"},{default:t(()=>[l(B,{modelValue:xe.value,"onUpdate:modelValue":e[80]||(e[80]=a=>xe.value=a),placeholder:"请选择目标章节",style:{width:"100%"}},{default:t(()=>[(i(!0),C(z,null,j(Ve.value.children,a=>(i(),_(g,{key:a.id,label:a.CategoryName,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):$("",!0)]),_:1})]),_:1},8,["modelValue"])])}}},fn=xa(pn,[["__scopeId","data-v-e9f15bf3"]]);export{fn as default};
