import{_ as me,i as ve,o as n,c as u,a as o,w as s,p as g,r as c,g as pe,f,m as j,F as C,y as V,e as i,z as X,d as y,t as h,k as _e,O as fe,n as Y,M as Z,G as ee,E as B,q as ye}from"./index-CYafs7gL.js";const ke={class:"politics-manage"},ge={class:"card-header"},he={style:{padding:"20px"}},be={key:0,class:"empty-state"},we={class:"section-header"},Ce={class:"section-info"},Ve={class:"section-title"},Be={class:"section-actions"},Se={class:"books-grid"},xe={key:0,class:"empty-hint"},$e={class:"dialog-footer"},Pe={key:0,class:"mb-20"},ze={class:"book-selector-container"},Ne={key:0,class:"empty-tip"},Me={class:"category-header-mini"},Ue={class:"books-list"},Fe=["onClick"],Ie={class:"book-name"},De={class:"category-header-mini"},je={class:"books-list"},Ee=["onClick"],Le={class:"book-name"},Oe={class:"dialog-footer"},qe={__name:"PoliticsManage",setup(Ae){const E=f(!1),L=f(!1),M=f([]),S=f({}),O=f([]),U=f([]),q=f([]),F=f(""),G=f([]),z=f(!1),I=f(!1),b=f(null),d=pe({id:null,name:"",display_rows:1,sort:0,status:1}),A=async()=>{E.value=!0;try{const t=await g.getPoliticsSections();M.value=t.data||[];for(const e of M.value)R(e.id)}catch(t){console.error("获取板块失败:",t)}finally{E.value=!1}},R=async t=>{try{const e=await g.getPoliticsSectionBooks(t);S.value[t]=e.data||[]}catch(e){console.error(`获取板块 ${t} 的书籍失败:`,e)}},te=async()=>{L.value=!0;try{const t=await g.getPublicCategories({subject:"politics"});U.value=t.data||[];const e=await g.getBooks({subject:"politics"});O.value=(e.data||[]).map(a=>({...a,displayName:a.title||a.name||"未命名书籍"})),le()}catch(t){console.error("加载数据失败:",t)}finally{L.value=!1}},le=()=>{const t=U.value.filter(v=>v.level===1),e=U.value.filter(v=>v.level===2),a=U.value.filter(v=>v.level===3),m=t.map(v=>{const w=e.filter(r=>r.parentId===v.id);return{...v,children:w.map(r=>{const x=a.filter(p=>p.parentId===r.id),$=O.value.filter(p=>p.second_category_id===r.id&&!p.third_category_id);return{...r,books:$,children:x.map(p=>{const D=O.value.filter(T=>T.third_category_id===p.id);return{...p,books:D}}).filter(p=>p.books.length>0)}}).filter(r=>r.books.length>0||r.children.length>0)}}).filter(v=>v.children.length>0);q.value=m},Q=ye(()=>{if(!F.value)return q.value;const t=F.value.toLowerCase();return q.value.map(e=>{const a=e.children.map(m=>{const v=m.children.map(r=>{const x=r.books.filter($=>$.displayName.toLowerCase().includes(t));return{...r,books:x}}).filter(r=>r.books.length>0),w=m.books.filter(r=>r.displayName.toLowerCase().includes(t));return{...m,children:v,books:w}}).filter(m=>m.books.length>0||m.children.length>0);return{...e,children:a}}).filter(e=>e.children.length>0)}),H=(t=null)=>{t?Object.assign(d,t):Object.assign(d,{id:null,name:"",display_rows:1,sort:0,status:1}),z.value=!0},oe=t=>{H(t)},se=async()=>{if(!d.name){B.warning("请输入板块名称");return}try{d.id?(await g.updatePoliticsSection(d.id,d),B.success("更新成功")):(await g.createPoliticsSection(d),B.success("创建成功")),z.value=!1,A()}catch(t){console.error("保存板块失败:",t)}},ae=t=>{ee.confirm(`确定要删除板块 "${t.name}" 吗？`,"提示",{type:"warning"}).then(async()=>{try{await g.deletePoliticsSection(t.id),B.success("删除成功"),A()}catch(e){console.error("删除板块失败:",e)}})},ne=t=>{b.value=t,I.value=!0},N=t=>!b.value||!S.value[b.value.id]?!1:S.value[b.value.id].some(e=>e.id===t),J=async t=>{if(!b.value)return;const e=b.value.id,a=t.id;try{N(a)?(await g.removePoliticsBookFromSection(e,a),B.success("已移除")):(await g.addPoliticsBookToSection(e,{bookId:a}),B.success("已添加")),R(e)}catch(m){console.error("操作失败:",m)}},ie=(t,e)=>{ee.confirm(`确定从板块 "${t.name}" 中移除 "${e.title||e.name}" 吗？`,"提示",{type:"warning"}).then(async()=>{try{await g.removePoliticsBookFromSection(t.id,e.id),B.success("移除成功"),R(t.id)}catch(a){console.error("移除书籍失败:",a)}})};return ve(()=>{A(),te()}),(t,e)=>{const a=c("el-button"),m=c("el-skeleton-item"),v=c("el-empty"),w=c("el-tag"),r=c("el-card"),x=c("el-skeleton"),$=c("el-input"),p=c("el-form-item"),D=c("el-input-number"),T=c("el-switch"),re=c("el-form"),K=c("el-dialog"),de=c("el-icon"),W=c("el-checkbox"),ue=c("el-collapse-item"),ce=c("el-collapse");return n(),u("div",ke,[o(r,{class:"box-card"},{header:s(()=>[i("div",ge,[e[14]||(e[14]=i("span",null,"考研政治板块管理",-1)),o(a,{type:"primary",onClick:e[0]||(e[0]=l=>H())},{default:s(()=>[...e[13]||(e[13]=[y("添加板块",-1)])]),_:1})])]),default:s(()=>[o(x,{loading:E.value,animated:""},{template:s(()=>[i("div",he,[o(m,{variant:"p",style:{width:"50%"}}),o(m,{variant:"text",style:{"margin-top":"10px"}}),o(m,{variant:"text"})])]),default:s(()=>[M.value.length===0?(n(),u("div",be,[o(v,{description:"暂无自定义板块，请点击上方“添加板块”开始"})])):j("",!0),(n(!0),u(C,null,V(M.value,l=>(n(),u("div",{key:l.id,class:"section-item mb-20"},[o(r,{shadow:"hover"},{header:s(()=>[i("div",we,[i("div",Ce,[i("span",Ve,h(l.name),1),o(w,{size:"small",type:"info",class:"ml-10"},{default:s(()=>[y("显示 "+h(l.display_rows)+" 行",1)]),_:2},1024),o(w,{size:"small",type:"warning",class:"ml-10"},{default:s(()=>[y("排序: "+h(l.sort),1)]),_:2},1024)]),i("div",Be,[o(a,{size:"small",onClick:_=>oe(l)},{default:s(()=>[...e[15]||(e[15]=[y("编辑板块",-1)])]),_:1},8,["onClick"]),o(a,{size:"small",type:"primary",onClick:_=>ne(l)},{default:s(()=>[...e[16]||(e[16]=[y("分配书籍/试卷",-1)])]),_:1},8,["onClick"]),o(a,{size:"small",type:"danger",onClick:_=>ae(l)},{default:s(()=>[...e[17]||(e[17]=[y("删除",-1)])]),_:1},8,["onClick"])])])]),default:s(()=>[i("div",Se,[(n(!0),u(C,null,V(S.value[l.id],_=>(n(),X(w,{key:_.id,class:"book-tag",closable:"",onClose:k=>ie(l,_)},{default:s(()=>[y(h(_.title||_.name||"未命名书籍"),1)]),_:2},1032,["onClose"]))),128)),!S.value[l.id]||S.value[l.id].length===0?(n(),u("div",xe," 该板块下暂无内容，请点击“分配书籍/试卷”添加 ")):j("",!0)])]),_:2},1024)]))),128))]),_:1},8,["loading"])]),_:1}),o(K,{modelValue:z.value,"onUpdate:modelValue":e[6]||(e[6]=l=>z.value=l),title:d.id?"编辑板块":"添加板块",width:"500px"},{footer:s(()=>[i("span",$e,[o(a,{onClick:e[5]||(e[5]=l=>z.value=!1)},{default:s(()=>[...e[19]||(e[19]=[y("取消",-1)])]),_:1}),o(a,{type:"primary",onClick:se},{default:s(()=>[...e[20]||(e[20]=[y("保存",-1)])]),_:1})])]),default:s(()=>[o(re,{model:d,"label-width":"100px"},{default:s(()=>[o(p,{label:"板块名称",required:""},{default:s(()=>[o($,{modelValue:d.name,"onUpdate:modelValue":e[1]||(e[1]=l=>d.name=l),placeholder:"如：重中之重"},null,8,["modelValue"])]),_:1}),o(p,{label:"显示行数"},{default:s(()=>[o(D,{modelValue:d.display_rows,"onUpdate:modelValue":e[2]||(e[2]=l=>d.display_rows=l),min:1,max:10},null,8,["modelValue"])]),_:1}),o(p,{label:"排序值"},{default:s(()=>[o(D,{modelValue:d.sort,"onUpdate:modelValue":e[3]||(e[3]=l=>d.sort=l)},null,8,["modelValue"]),e[18]||(e[18]=i("div",{class:"form-tip"},"值越小越靠前",-1))]),_:1}),o(p,{label:"状态"},{default:s(()=>[o(T,{modelValue:d.status,"onUpdate:modelValue":e[4]||(e[4]=l=>d.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),o(K,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=l=>I.value=l),title:"分配内容",width:"800px",top:"5vh"},{footer:s(()=>[i("span",Oe,[o(a,{type:"primary",onClick:e[11]||(e[11]=l=>I.value=!1)},{default:s(()=>[...e[23]||(e[23]=[y("完成",-1)])]),_:1})])]),default:s(()=>[b.value?(n(),u("div",Pe,[e[21]||(e[21]=y(" 正在为板块 ",-1)),i("strong",null,h(b.value.name),1),e[22]||(e[22]=y(" 分配内容 ",-1))])):j("",!0),o($,{modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=l=>F.value=l),placeholder:"搜索书籍名称...",class:"mb-20",clearable:""},{prefix:s(()=>[o(de,null,{default:s(()=>[o(_e(fe))]),_:1})]),_:1},8,["modelValue"]),i("div",ze,[o(x,{loading:L.value,animated:""},{default:s(()=>[Q.value.length===0?(n(),u("div",Ne,"暂无可选书籍")):j("",!0),o(ce,{modelValue:G.value,"onUpdate:modelValue":e[10]||(e[10]=l=>G.value=l)},{default:s(()=>[(n(!0),u(C,null,V(Q.value,l=>(n(),X(ue,{key:l.id,title:l.name,name:l.id},{default:s(()=>[(n(!0),u(C,null,V(l.children,_=>(n(),u("div",{key:_.id,class:"category-level-2"},[i("div",Me,h(_.name),1),i("div",Ue,[(n(!0),u(C,null,V(_.books,k=>(n(),u("div",{key:k.id,class:Y(["book-selection-item",{selected:N(k.id)}]),onClick:P=>J(k)},[o(W,{"model-value":N(k.id),onClick:e[8]||(e[8]=Z(()=>{},["stop"]))},null,8,["model-value"]),i("span",Ie,h(k.displayName),1)],10,Fe))),128))]),(n(!0),u(C,null,V(_.children,k=>(n(),u("div",{key:k.id,class:"category-level-3"},[i("div",De,h(k.name),1),i("div",je,[(n(!0),u(C,null,V(k.books,P=>(n(),u("div",{key:P.id,class:Y(["book-selection-item",{selected:N(P.id)}]),onClick:Re=>J(P)},[o(W,{"model-value":N(P.id),onClick:e[9]||(e[9]=Z(()=>{},["stop"]))},null,8,["model-value"]),i("span",Le,h(P.displayName),1)],10,Ee))),128))])]))),128))]))),128))]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading"])])]),_:1},8,["modelValue"])])}}},Ge=me(qe,[["__scopeId","data-v-f7adc685"]]);export{Ge as default};
