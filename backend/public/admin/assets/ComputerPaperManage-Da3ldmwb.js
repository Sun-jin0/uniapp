import{_ as da,i as pa,o as _,c as w,e as m,a,b as ma,w as o,C as _a,z as j,p as x,E as b,f as g,r as C,D as ca,F as U,y as $,d as y,t as B,M as va,m as R,k as ie,O as fa,J as we,G as de}from"./index-CYafs7gL.js";import{R as A}from"./RichEditor-DhNxoQ6j.js";import{k as ze}from"./katex.min-DPBfLjbn.js";import"./style-Ca15nGLt.js";const ga={class:"computer-paper-manage"},ya={class:"filter-bar mb-20"},ha={class:"pagination-container mt-20"},ba={class:"dialog-header"},Va={key:0,class:"paper-detail"},wa={class:"mt-10 flex-end"},xa={class:"mt-20 flex-between"},Ca={class:"questions-list mt-10"},ka={class:"question-header"},Ta={class:"question-index"},ja={class:"question-type"},Sa={class:"question-score"},Ua=["innerHTML"],$a={key:0,class:"question-options"},za={class:"option-label"},Ma=["innerHTML"],Ea={key:1,class:"question-subs"},La={class:"sub-header"},Da=["innerHTML"],qa={key:0,class:"sub-answer"},Ba=["innerHTML"],Na={class:"question-answer"},Pa=["innerHTML"],Ia={key:2,class:"question-analysis"},Ha=["innerHTML"],Qa={style:{display:"flex",gap:"8px"}},Ra={class:"tags-list"},Aa={class:"editor-wrapper"},Ka={class:"options-list"},Fa={class:"option-editor-wrapper"},Oa={class:"subs-list"},Ja={class:"sub-header"},Xa={class:"sub-index"},Ga={class:"sub-content"},Wa={class:"editor-wrapper"},Ya={class:"editor-wrapper"},Za={__name:"ComputerPaperManage",setup(el){const te=g(""),oe=g(""),ne=g(""),xe=g([]),pe=g(!1),K=g(1),se=g(20),Ce=g(0),ke=g([]),F=g([]),N=g([]),L=g(""),re=g(""),me=g(!1),_e=g(!1),O=g(!1),k=g({major_id:"",chapter_id:"",tag_id:""}),W=g([]),Q=g([]),Y=g(!1),ce=g(!1),V=g({id:"",title:"",exam_full_name:"",year:"",school:"",paper_type:1,total_score:150,duration:180,difficulty:"中等"}),ve=g(!1),d=g(null),Z=g(!1),fe=g(!1),ge=g(!1),ye=g(!1),J=g(!1),he=g(!1),s=g({question_id:"",exercise_type:1,exercise_type_name:"",stem:"",options:[],answer:"",analysis:"",paper_score:2,subs:[]}),X=n=>{if(!n)return"";let e=n;e=e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" style="max-width:100%;height:auto;display:block;margin:10px 0;">'),e=e.replace(/\$([^$]+)\$/g,(u,i)=>{try{return ze.renderToString(i,{throwOnError:!1,displayMode:!1,strict:!1})}catch(r){return console.warn("KaTeX render error:",r),u}}),e=e.replace(/\$\$([^$]+)\$\$/g,(u,i)=>{try{return ze.renderToString(i,{throwOnError:!1,displayMode:!0,strict:!1})}catch(r){return console.warn("KaTeX render error:",r),u}}),e=e.replace(/<code>([\s\S]*?)<\/code>/g,'<code class="code-block">$1</code>'),e=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const t=[];if(e=e.replace(/<img[^>]*>/gi,u=>{const i=`__RENDERED_ELEMENT_${t.length}__`;return t.push({placeholder:i,content:u}),i}),e=e.replace(/<pre[^>]*>[\s\S]*?<\/pre>/gi,u=>{const i=`__RENDERED_ELEMENT_${t.length}__`;return t.push({placeholder:i,content:u}),i}),e=e.replace(/<span[^>]*class="katex"[^>]*>[\s\S]*?<\/span>/gi,u=>{const i=`__RENDERED_ELEMENT_${t.length}__`;return t.push({placeholder:i,content:u}),i}),!e.includes("<p")&&!e.includes("<div")){const u=e.split(/\n{2,}/).filter(i=>i.trim());u.length>1?e=u.map(i=>`<p style="margin: 0 0 8px 0; line-height: 1.6;">${i.replace(/\n/g,"<br>")}</p>`).join(""):u.length===1&&(e=u[0].replace(/\n/g,"<br>"))}else e=e.replace(/\n/g,"<br>");return t.forEach(({placeholder:u,content:i})=>{e=e.replace(u,i)}),e},Me=async()=>{try{const n=await x.getComputerSubjects({admin:1});ke.value=n.data||[]}catch(n){console.error("获取科目列表失败:",n)}},I=async()=>{pe.value=!0;try{const e=(await x.getComputerPaperList({page:K.value,pageSize:se.value,keyword:te.value,paperType:oe.value,majorId:ne.value})).data||{};xe.value=e.list||[],Ce.value=e.total||0}catch(n){console.error("获取试卷列表失败:",n),b.error("获取试卷列表失败")}finally{pe.value=!1}},ue=()=>{K.value=1,I()},Ee=()=>{te.value="",oe.value="",ne.value="",K.value=1,I()},Le=n=>{se.value=n,I()},De=n=>{K.value=n,I()},Te=async n=>{try{const e=await x.getComputerPaperDetail(n.id);d.value=e.data||null,ve.value=!0,Z.value=!1}catch(e){console.error("获取试卷详情失败:",e),b.error("获取试卷详情失败")}},qe=async()=>{var u,i;if(!d.value||!d.value.questions||d.value.questions.length===0){b.warning("试卷中没有题目，无需同步");return}const n=d.value.questions,e=d.value,t=[];if(n.forEach(r=>{(r.exam_time!==e.year||r.from_school!==e.school||r.exam_code!==e.exam_code||r.exam_full_name!==e.exam_full_name)&&t.push(r)}),t.length===0){b.info("所有题目信息已与试卷一致，无需更新");return}try{await de.confirm(`检测到 ${t.length} 道题目需要更新：

试卷年份: ${e.year||"未设置"}
试卷学校/来源: ${e.school||"未设置"}
试卷科目代码: ${e.exam_code||"未设置"}
试卷考试全称: ${e.exam_full_name||"未设置"}

是否将这些信息同步到所有题目？`,"确认统一题目信息",{confirmButtonText:"同步更新",cancelButtonText:"取消",type:"warning"}),ge.value=!0;let r=0,c=0;for(const h of t)try{await x.updateComputerQuestion(h.question_id,{...h,exam_time:e.year,from_school:e.school,exam_code:e.exam_code,exam_full_name:e.exam_full_name}),r++}catch(f){console.error(`更新题目 ${h.question_id} 失败:`,f),c++}c===0?b.success(`成功更新 ${r} 道题目`):b.warning(`更新完成：成功 ${r} 道，失败 ${c} 道`),await Te({id:e.id})}catch(r){r!=="cancel"&&(console.error("同步题目信息失败:",r),b.error("同步失败: "+(((i=(u=r.response)==null?void 0:u.data)==null?void 0:i.message)||r.message)))}finally{ge.value=!1}},Be=n=>{V.value={id:n.id,title:n.title||"",exam_full_name:n.exam_full_name||"",year:n.year||"",school:n.school||"",paper_type:n.paper_type||1,total_score:n.total_score||150,duration:n.duration||180,difficulty:n.difficulty||"中等"},Y.value=!0},Ne=async()=>{var n,e;if(!V.value.title){b.warning("请输入试卷名称");return}ce.value=!0;try{await x.updateComputerPaper(V.value.id,{title:V.value.title,exam_full_name:V.value.exam_full_name,year:V.value.year,school:V.value.school,paper_type:V.value.paper_type,total_score:V.value.total_score,duration:V.value.duration,difficulty:V.value.difficulty}),b.success("保存成功"),Y.value=!1,I()}catch(t){console.error("保存试卷失败:",t),b.error("保存失败: "+(((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||t.message))}finally{ce.value=!1}},Pe=async n=>{var e,t;try{await de.confirm(`确定要删除试卷"${n.title}"吗？此操作将同时删除试卷与题目的关联关系，但不会删除题目本身。`,"确认删除",{type:"warning"}),await x.deleteComputerPaper(n.id),b.success("删除成功"),I()}catch(u){u!=="cancel"&&(console.error("删除试卷失败:",u),b.error("删除失败: "+(((t=(e=u.response)==null?void 0:e.data)==null?void 0:t.message)||u.message)))}},Ie=async n=>{console.log("点击编辑按钮:",n),await He(n)},He=async n=>{console.log("编辑题目:",n.question_id);try{await Qe();const t=(await x.getComputerQuestionDetail(n.question_id)).data;let u=t.major_id,i=t.chapter_id;if((!u||!i)&&t.tags&&t.tags.length>0){const r=await Ae(t.tags);r&&(u=r.major_id,i=r.chapter_id,console.log("从标签推断:",r))}if(t.chapter_id){const r=await je(t.chapter_id);r&&(L.value=r.chapter_name,!u&&r.major_id&&(u=r.major_id))}if(u&&await ee(u),L.value="",re.value="",i){const r=N.value.find(c=>String(c.chapter_id||c.id)===String(i));if(r){const c=[],h=F.value.find(f=>String(f.major_id||f.id)===String(u));h&&c.push(h.subject_name||h.name),(r.parent_name||r.parent_chapter_name)&&c.push(r.parent_name||r.parent_chapter_name),c.push(r.chapter_name||r.name),re.value=c.join(" > ")}else{const c=await je(i);c&&(re.value=c.chapter_name)}}s.value={question_id:t.question_id,exercise_type:t.exercise_type,exercise_type_name:t.exercise_type_name,stem:t.stem||"",options:t.options?typeof t.options=="string"?JSON.parse(t.options):t.options:[],answer:t.answer||"",analysis:t.analysis||"",paper_score:n.paper_score||t.total_score||2,subs:t.subs||[],knowledgeTags:t.tags||[],major_id:u?String(u):null,chapter_id:i?String(i):null,exam_group_id:t.exam_group_id,level:t.level||1,total_score:t.total_score||0,exam_id:t.exam_id,category_id:t.category_id,from_school:t.from_school||"",exam_time:t.exam_time||"",exam_code:t.exam_code||"",exam_full_name:t.exam_full_name||"",exercise_number:t.exercise_number||1,video_url:t.video_url||""},J.value=!0,console.log("对话框状态:",J.value),console.log("题目详情（含小题）:",s.value)}catch(e){console.error("获取题目详情失败:",e),b.error("获取题目详情失败")}},Qe=async()=>{me.value=!0;try{const n=await x.getComputerSubjects();F.value=n.data||[]}catch(n){console.error("获取科目列表失败:",n),F.value=[]}finally{me.value=!1}},ee=async n=>{if(!n){N.value=[];return}_e.value=!0;try{const e=await x.getComputerChapters({majorId:String(n)});Array.isArray(e.data)?N.value=e.data:e.data&&Array.isArray(e.data.list)?N.value=e.data.list:e.data&&Array.isArray(e.data.data)?N.value=e.data.data:N.value=[]}catch(e){console.error("获取章节列表失败:",e),N.value=[]}finally{_e.value=!1}},Re=n=>{if(!n)return"";const e=[];return(n.parent_name||n.parent_chapter_name)&&e.push(n.parent_name||n.parent_chapter_name),e.push(n.chapter_name||n.name),e.join(" > ")},Ae=async n=>{var e,t;if(!n||n.length===0)return null;try{const u=n.map(r=>typeof r=="string"?r:r.tag_id).filter(r=>r&&/^\d+$/.test(String(r))),i=n.map(r=>typeof r=="string"?r:r.tag_name).filter(r=>r&&!/^\d+$/.test(String(r)));if(u.length>0){const c=((e=(await x.getComputerTags({keyword:u.join(","),pageSize:u.length})).data)==null?void 0:e.list)||[];for(const h of c)if(h.chapter_id){const f=[];return h.major_name&&f.push(h.major_name),h.parent_chapter_name&&f.push(h.parent_chapter_name),h.chapter_name&&f.push(h.chapter_name),L.value=f.length>0?f.join(" > "):"未分配章节",{major_id:h.major_id||h.chapter_id,chapter_id:h.chapter_id,chapter_name:L.value}}}if(i.length>0)for(const r of i){const h=((t=(await x.getComputerTags({keyword:r,pageSize:1})).data)==null?void 0:t.list)||[];if(h.length>0){const f=h[0];if(f.chapter_id){const z=[];return f.major_name&&z.push(f.major_name),f.parent_chapter_name&&z.push(f.parent_chapter_name),f.chapter_name&&z.push(f.chapter_name),L.value=z.length>0?z.join(" > "):"未分配章节",{major_id:f.major_id||f.chapter_id,chapter_id:f.chapter_id,chapter_name:L.value}}}}return L.value="",null}catch(u){return console.error("推断科目章节失败:",u),L.value="",null}},Ke=()=>{const n=String.fromCharCode(65+s.value.options.length);s.value.options.push({option_key:n,option_value:""})},Fe=n=>{s.value.options.splice(n,1),s.value.options.forEach((e,t)=>{e.option_key=String.fromCharCode(65+t)})},Oe=async n=>{s.value.chapter_id=null,re.value="",L.value="",await ee(n)},je=async n=>{var e;if(!n)return null;try{const u=((e=(await x.getComputerTags({keyword:n,pageSize:1})).data)==null?void 0:e.list)||[];if(u.length>0){const i=u[0],r=[];return i.major_name&&r.push(i.major_name),i.parent_chapter_name&&r.push(i.parent_chapter_name),i.chapter_name&&r.push(i.chapter_name),{chapter_name:r.join(" > "),major_id:i.major_id,major_name:i.major_name}}return null}catch(t){return console.warn("获取章节信息失败:",t),null}},Je=n=>{const e={1:"单选题",2:"多选题",3:"填空题",4:"解答题",5:"判断题"};s.value.exercise_type_name=e[n]||"",(n===1||n===2||n===5)&&(!s.value.options||s.value.options.length===0)&&(s.value.options=[{option_key:"A",option_value:""},{option_key:"B",option_value:""},{option_key:"C",option_value:""},{option_key:"D",option_value:""}]),n===4&&(!s.value.subs||s.value.subs.length===0)&&(s.value.subs=[])},Xe=()=>{s.value.subs||(s.value.subs=[]),s.value.subs.push({stem:"",answer:"",analysis:"",score:0})},Ge=n=>{s.value.subs.splice(n,1)},We=n=>{s.value.knowledgeTags.splice(n,1)},Ye=()=>{k.value={major_id:s.value.major_id||"",chapter_id:s.value.chapter_id||"",tag_id:""},W.value=[],Q.value=[],k.value.major_id&&Se(k.value.major_id),k.value.chapter_id&&Ue(k.value.chapter_id),O.value=!0},Ze=async n=>{k.value.chapter_id="",k.value.tag_id="",W.value=[],Q.value=[],n&&await Se(n)},ea=async n=>{k.value.tag_id="",Q.value=[],n&&await Ue(n)},Se=async n=>{var e;try{const t=await x.getComputerChapters({majorId:n});console.log("获取章节列表:",t.data);const u=((e=t.data)==null?void 0:e.data)||t.data||[],i=Array.isArray(u)?u:u.chapters||[];W.value=i.map(r=>({id:r.id||r.chapter_id,name:r.name||r.chapter_name||"未命名章节"}))}catch(t){console.error("获取章节列表失败:",t),W.value=[]}},Ue=async n=>{var e;try{const t=await x.getComputerTags({chapterId:n,pageSize:1e3});console.log("获取考点列表:",t.data);const u=((e=t.data)==null?void 0:e.data)||t.data||{},i=u.list||u||[];Q.value=i.map(r=>({tag_id:r.tag_id||r.id,tag_name:r.tag_name||r.name||"未命名考点"}))}catch(t){console.error("获取考点列表失败:",t),Q.value=[]}},aa=async()=>{var u,i,r,c,h;const n=k.value.tag_id;if(!n)return;const e=Q.value.find(f=>String(f.tag_id)===String(n));if(!e){b.error("未找到选中的考点");return}if((u=s.value.knowledgeTags)==null?void 0:u.some(f=>String(f.tag_id||f)===String(n))){b.warning("该标签已存在"),O.value=!1;return}try{const f=await x.getKnowledgeTagById(n),z=((i=f.data)==null?void 0:i.data)||f.data;if(z&&z.chapter_id){const v=await x.getChapterById(z.chapter_id),M=((r=v.data)==null?void 0:r.data)||v.data;if(M){const G=s.value.major_id,S=s.value.chapter_id,D=String(M.major_id),H=String(M.chapter_id);if(!G&&!S)s.value.major_id=D,await ee(D),s.value.chapter_id=H,b.success(`已自动关联科目和章节：${M.chapter_name}`);else if(G!==D||S!==H){const q=((c=F.value.find(ae=>String(ae.id)===String(G)))==null?void 0:c.name)||G||"无",be=((h=N.value.find(ae=>String(ae.chapter_id)===String(S)))==null?void 0:h.chapter_name)||S||"无";try{await de.confirm(`考点的所属信息与您当前设置不一致：

当前：${q} / ${be}
考点：${M.subject_name||D} / ${M.chapter_name}

是否更新为考点的所属科目和章节？`,"科目章节不一致",{confirmButtonText:"更新",cancelButtonText:"保持当前",type:"warning",dangerouslyUseHTMLString:!1}),s.value.major_id=D,await ee(D),s.value.chapter_id=H,b.success(`已更新为：${M.chapter_name}`)}catch{b.info("保持当前科目章节设置")}}}}}catch(f){console.error("获取考点信息失败:",f)}s.value.knowledgeTags||(s.value.knowledgeTags=[]),s.value.knowledgeTags.push({tag_id:e.tag_id,tag_name:e.tag_name}),b.success("添加成功"),O.value=!1},la=async()=>{de.prompt("请输入知识点标签名称或ID","添加标签",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:n=>!n||n.trim()===""?"标签名称或ID不能为空":!0}).then(async({value:n})=>{const e=n.trim();try{let t=null;if(/^\d+$/.test(e))try{const i=await x.getKnowledgeTagById(e);i.data&&(t=i.data)}catch{}if(!t){const i=await x.getKnowledgeTagByName(e);i.data&&(t=i.data)}if(t&&t.chapter_id){const r=(await x.getChapterById(t.chapter_id)).data;r&&(r.major_id&&!s.value.major_id&&(s.value.major_id=r.major_id,await ee(r.major_id)),s.value.chapter_id||(s.value.chapter_id=r.chapter_id),b.success(`已自动关联科目和章节：${r.chapter_name}`))}if(s.value.knowledgeTags||(s.value.knowledgeTags=[]),s.value.knowledgeTags.some(i=>(typeof i=="string"?i:i.tag_name)===((t==null?void 0:t.tag_name)||e))){b.warning("该标签已存在");return}s.value.knowledgeTags.push({tag_id:t==null?void 0:t.tag_id,tag_name:(t==null?void 0:t.tag_name)||e}),b.success("添加成功")}catch(t){console.error("添加标签失败:",t),s.value.knowledgeTags||(s.value.knowledgeTags=[]),s.value.knowledgeTags.push({tag_name:e}),b.success("添加成功（未找到对应考点信息）")}}).catch(()=>{})},ta=async()=>{var n,e;he.value=!0;try{const t={stem:s.value.stem,answer:s.value.answer,analysis:s.value.analysis,options:s.value.options,subs:s.value.subs,exercise_type:s.value.exercise_type,exercise_type_name:s.value.exercise_type_name,knowledgeTags:s.value.knowledgeTags,major_id:s.value.major_id,chapter_id:s.value.chapter_id,exam_group_id:s.value.exam_group_id,level:s.value.level,total_score:s.value.total_score,exam_id:s.value.exam_id,category_id:s.value.category_id,from_school:s.value.from_school,exam_time:s.value.exam_time,exam_code:s.value.exam_code,exam_full_name:s.value.exam_full_name,exercise_number:s.value.exercise_number,video_url:s.value.video_url};await x.updateComputerQuestion(s.value.question_id,t);const u=d.value.questions.findIndex(i=>i.question_id===s.value.question_id);u!==-1&&(d.value.questions[u].stem=s.value.stem,d.value.questions[u].answer=s.value.answer,d.value.questions[u].analysis=s.value.analysis,d.value.questions[u].options=s.value.options,d.value.questions[u].subs=s.value.subs,d.value.questions[u].paper_score=s.value.paper_score,d.value.questions[u].exercise_type=s.value.exercise_type,d.value.questions[u].exercise_type_name=s.value.exercise_type_name),b.success("保存成功"),J.value=!1,L.value=""}catch(t){console.error("保存题目失败:",t),b.error("保存失败: "+(((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||t.message))}finally{he.value=!1}},oa=async()=>{var n,e;fe.value=!0;try{const t=d.value.questions.map((u,i)=>({question_id:u.question_id,sort_order:i+1,score:u.paper_score||u.total_score||2}));await x.updateComputerPaperQuestions(d.value.id,{questions:t}),b.success("保存成功")}catch(t){console.error("保存题目顺序失败:",t),b.error("保存失败: "+(((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||t.message))}finally{fe.value=!1}},na=async()=>{var n,e;if(d.value){ye.value=!0;try{const t={title:d.value.title,exam_full_name:d.value.exam_full_name,year:d.value.year,school:d.value.school,paper_type:d.value.paper_type,exam_code:d.value.exam_code,total_score:d.value.total_score,duration:d.value.duration};await x.updateComputerPaper(d.value.id,t),b.success("试卷信息保存成功"),await I()}catch(t){console.error("保存试卷信息失败:",t),b.error("保存失败: "+(((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||t.message))}finally{ye.value=!1}}},sa=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return pa(()=>{Me(),I()}),(n,e)=>{const t=C("el-input"),u=C("el-option"),i=C("el-select"),r=C("el-button"),c=C("el-table-column"),h=C("el-tag"),f=C("el-table"),z=C("el-pagination"),v=C("el-form-item"),M=C("el-radio-button"),G=C("el-radio-group"),S=C("el-input-number"),D=C("el-form"),H=C("el-dialog"),q=C("el-descriptions-item"),be=C("el-descriptions"),ae=C("DocumentChecked"),le=C("el-icon"),P=C("el-col"),ra=C("el-rate"),Ve=C("el-row"),ua=C("el-button-group"),ia=ca("loading");return _(),w("div",ga,[e[79]||(e[79]=m("h2",null,"计算机试卷管理",-1)),m("div",ya,[a(t,{modelValue:te.value,"onUpdate:modelValue":e[0]||(e[0]=l=>te.value=l),placeholder:"搜索试卷名称/学校/考试名称",style:{width:"300px"},clearable:"",onKeyup:ma(ue,["enter"])},null,8,["modelValue"]),a(i,{modelValue:oe.value,"onUpdate:modelValue":e[1]||(e[1]=l=>oe.value=l),placeholder:"试卷类型",clearable:"",style:{width:"150px","margin-left":"10px"},onChange:ue},{default:o(()=>[a(u,{label:"真题卷",value:1}),a(u,{label:"模拟卷",value:2}),a(u,{label:"组卷",value:3})]),_:1},8,["modelValue"]),a(i,{modelValue:ne.value,"onUpdate:modelValue":e[2]||(e[2]=l=>ne.value=l),placeholder:"科目",clearable:"",style:{width:"150px","margin-left":"10px"},onChange:ue},{default:o(()=>[(_(!0),w(U,null,$(ke.value,l=>(_(),j(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(r,{type:"primary",onClick:ue,style:{"margin-left":"10px"}},{default:o(()=>[...e[47]||(e[47]=[y("搜索",-1)])]),_:1}),a(r,{onClick:Ee},{default:o(()=>[...e[48]||(e[48]=[y("重置",-1)])]),_:1})]),_a((_(),j(f,{data:xe.value,border:""},{default:o(()=>[a(c,{type:"index",label:"序号",width:"60",align:"center"}),a(c,{prop:"title",label:"试卷名称","min-width":"200","show-overflow-tooltip":""}),a(c,{prop:"exam_full_name",label:"考试全称","min-width":"200","show-overflow-tooltip":""}),a(c,{prop:"year",label:"年份",width:"80",align:"center"}),a(c,{prop:"school",label:"学校/来源",width:"120","show-overflow-tooltip":""}),a(c,{prop:"paper_type",label:"类型",width:"80",align:"center"},{default:o(({row:l})=>[l.paper_type===1?(_(),j(h,{key:0,type:"success"},{default:o(()=>[...e[49]||(e[49]=[y("真题卷",-1)])]),_:1})):l.paper_type===2?(_(),j(h,{key:1,type:"warning"},{default:o(()=>[...e[50]||(e[50]=[y("模拟卷",-1)])]),_:1})):(_(),j(h,{key:2,type:"info"},{default:o(()=>[...e[51]||(e[51]=[y("组卷",-1)])]),_:1}))]),_:1}),a(c,{prop:"exam_code",label:"科目",width:"80",align:"center"}),a(c,{prop:"question_count",label:"题目数",width:"80",align:"center"}),a(c,{prop:"total_score",label:"总分",width:"80",align:"center"}),a(c,{prop:"duration",label:"时长(分)",width:"80",align:"center"}),a(c,{prop:"difficulty",label:"难度",width:"80",align:"center"}),a(c,{prop:"created_at",label:"创建时间",width:"160"},{default:o(({row:l})=>[y(B(sa(l.created_at)),1)]),_:1}),a(c,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[a(r,{type:"primary",size:"small",onClick:p=>Te(l)},{default:o(()=>[...e[52]||(e[52]=[y("详情",-1)])]),_:1},8,["onClick"]),a(r,{type:"warning",size:"small",onClick:p=>Be(l)},{default:o(()=>[...e[53]||(e[53]=[y("编辑",-1)])]),_:1},8,["onClick"]),a(r,{type:"danger",size:"small",onClick:p=>Pe(l)},{default:o(()=>[...e[54]||(e[54]=[y("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ia,pe.value]]),m("div",ha,[a(z,{"current-page":K.value,"onUpdate:currentPage":e[3]||(e[3]=l=>K.value=l),"page-size":se.value,"onUpdate:pageSize":e[4]||(e[4]=l=>se.value=l),"page-sizes":[10,20,50,100],total:Ce.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Le,onCurrentChange:De},null,8,["current-page","page-size","total"])]),a(H,{modelValue:Y.value,"onUpdate:modelValue":e[14]||(e[14]=l=>Y.value=l),title:"编辑试卷",width:"600px"},{footer:o(()=>[a(r,{onClick:e[13]||(e[13]=l=>Y.value=!1)},{default:o(()=>[...e[58]||(e[58]=[y("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:Ne,loading:ce.value},{default:o(()=>[...e[59]||(e[59]=[y("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(D,{model:V.value,"label-width":"100px"},{default:o(()=>[a(v,{label:"试卷名称"},{default:o(()=>[a(t,{modelValue:V.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value.title=l)},null,8,["modelValue"])]),_:1}),a(v,{label:"考试全称"},{default:o(()=>[a(t,{modelValue:V.value.exam_full_name,"onUpdate:modelValue":e[6]||(e[6]=l=>V.value.exam_full_name=l)},null,8,["modelValue"])]),_:1}),a(v,{label:"年份"},{default:o(()=>[a(t,{modelValue:V.value.year,"onUpdate:modelValue":e[7]||(e[7]=l=>V.value.year=l)},null,8,["modelValue"])]),_:1}),a(v,{label:"学校/来源"},{default:o(()=>[a(t,{modelValue:V.value.school,"onUpdate:modelValue":e[8]||(e[8]=l=>V.value.school=l)},null,8,["modelValue"])]),_:1}),a(v,{label:"试卷类型"},{default:o(()=>[a(G,{modelValue:V.value.paper_type,"onUpdate:modelValue":e[9]||(e[9]=l=>V.value.paper_type=l)},{default:o(()=>[a(M,{label:1},{default:o(()=>[...e[55]||(e[55]=[y("真题卷",-1)])]),_:1}),a(M,{label:2},{default:o(()=>[...e[56]||(e[56]=[y("模拟卷",-1)])]),_:1}),a(M,{label:3},{default:o(()=>[...e[57]||(e[57]=[y("组卷",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"总分"},{default:o(()=>[a(S,{modelValue:V.value.total_score,"onUpdate:modelValue":e[10]||(e[10]=l=>V.value.total_score=l),min:0,max:300},null,8,["modelValue"])]),_:1}),a(v,{label:"考试时长"},{default:o(()=>[a(S,{modelValue:V.value.duration,"onUpdate:modelValue":e[11]||(e[11]=l=>V.value.duration=l),min:0,max:300},null,8,["modelValue"])]),_:1}),a(v,{label:"难度"},{default:o(()=>[a(i,{modelValue:V.value.difficulty,"onUpdate:modelValue":e[12]||(e[12]=l=>V.value.difficulty=l),placeholder:"选择难度",style:{width:"100%"}},{default:o(()=>[a(u,{label:"简单",value:"简单"}),a(u,{label:"中等",value:"中等"}),a(u,{label:"困难",value:"困难"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(H,{modelValue:ve.value,"onUpdate:modelValue":e[24]||(e[24]=l=>ve.value=l),title:"试卷详情",width:"95%",top:"3vh",fullscreen:Z.value},{header:o(()=>[m("div",ba,[e[60]||(e[60]=m("span",null,"试卷详情",-1)),a(r,{type:"primary",size:"small",onClick:e[15]||(e[15]=l=>Z.value=!Z.value)},{default:o(()=>[y(B(Z.value?"退出全屏":"全屏"),1)]),_:1})])]),default:o(()=>{var l;return[d.value?(_(),w("div",Va,[a(be,{column:4,border:""},{default:o(()=>[a(q,{label:"试卷名称"},{default:o(()=>[a(t,{modelValue:d.value.title,"onUpdate:modelValue":e[16]||(e[16]=p=>d.value.title=p),size:"small",placeholder:"试卷名称"},null,8,["modelValue"])]),_:1}),a(q,{label:"考试全称"},{default:o(()=>[a(t,{modelValue:d.value.exam_full_name,"onUpdate:modelValue":e[17]||(e[17]=p=>d.value.exam_full_name=p),size:"small",placeholder:"考试全称"},null,8,["modelValue"])]),_:1}),a(q,{label:"年份"},{default:o(()=>[a(t,{modelValue:d.value.year,"onUpdate:modelValue":e[18]||(e[18]=p=>d.value.year=p),size:"small",placeholder:"如：2024年"},null,8,["modelValue"])]),_:1}),a(q,{label:"学校/来源"},{default:o(()=>[a(t,{modelValue:d.value.school,"onUpdate:modelValue":e[19]||(e[19]=p=>d.value.school=p),size:"small",placeholder:"如：全国统考"},null,8,["modelValue"])]),_:1}),a(q,{label:"类型"},{default:o(()=>[a(i,{modelValue:d.value.paper_type,"onUpdate:modelValue":e[20]||(e[20]=p=>d.value.paper_type=p),size:"small",style:{width:"100%"}},{default:o(()=>[a(u,{label:"真题卷",value:1}),a(u,{label:"模拟卷",value:2}),a(u,{label:"组卷",value:3})]),_:1},8,["modelValue"])]),_:1}),a(q,{label:"科目"},{default:o(()=>[a(t,{modelValue:d.value.exam_code,"onUpdate:modelValue":e[21]||(e[21]=p=>d.value.exam_code=p),size:"small",placeholder:"如：408"},null,8,["modelValue"])]),_:1}),a(q,{label:"总分"},{default:o(()=>[a(S,{modelValue:d.value.total_score,"onUpdate:modelValue":e[22]||(e[22]=p=>d.value.total_score=p),size:"small",min:0,max:300,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(q,{label:"时长"},{default:o(()=>[a(S,{modelValue:d.value.duration,"onUpdate:modelValue":e[23]||(e[23]=p=>d.value.duration=p),size:"small",min:0,max:300,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),m("div",wa,[a(r,{type:"primary",size:"small",onClick:na,loading:ye.value},{default:o(()=>[...e[61]||(e[61]=[y("保存试卷信息",-1)])]),_:1},8,["loading"])]),m("div",xa,[m("h3",null,"题目列表（共 "+B(((l=d.value.questions)==null?void 0:l.length)||0)+" 题）",1),m("div",null,[a(r,{type:"danger",onClick:qe,loading:ge.value},{default:o(()=>[a(le,null,{default:o(()=>[a(ae)]),_:1}),e[62]||(e[62]=y(" 统一题目信息 ",-1))]),_:1},8,["loading"]),a(r,{type:"primary",onClick:oa,loading:fe.value},{default:o(()=>[...e[63]||(e[63]=[y("保存题目修改",-1)])]),_:1},8,["loading"])])]),m("div",Ca,[(_(!0),w(U,null,$(d.value.questions,(p,T)=>(_(),w("div",{key:p.question_id,class:"question-item"},[m("div",ka,[m("span",Ta,"第 "+B(p.sort_order||T+1)+" 题",1),m("span",ja,B(p.exercise_type_name),1),m("span",Sa,"分值: "+B(p.paper_score||p.total_score)+"分",1),a(r,{type:"primary",size:"small",onClick:va(E=>Ie(p),["stop"])},{default:o(()=>[...e[64]||(e[64]=[y("编辑",-1)])]),_:1},8,["onClick"])]),m("div",{class:"question-content math-content",innerHTML:X(p.stem)},null,8,Ua),p.options&&p.options.length>0?(_(),w("div",$a,[(_(!0),w(U,null,$(p.options,E=>(_(),w("div",{key:E.option_key,class:"option-item-inline"},[m("span",za,B(E.option_key)+".",1),m("span",{class:"math-content",innerHTML:X(E.option_value)},null,8,Ma)]))),128))])):R("",!0),p.subs&&p.subs.length>0?(_(),w("div",Ea,[(_(!0),w(U,null,$(p.subs,(E,$e)=>(_(),w("div",{key:$e,class:"sub-item"},[m("div",La,"("+B(String.fromCharCode(97+$e))+")",1),m("div",{class:"sub-content math-content",innerHTML:X(E.stem||E.sub_stem)},null,8,Da),E.answer||E.sub_answer?(_(),w("div",qa,[e[65]||(e[65]=m("strong",null,"答案：",-1)),m("span",{class:"math-content",innerHTML:X(E.answer||E.sub_answer)},null,8,Ba)])):R("",!0)]))),128))])):R("",!0),m("div",Na,[e[66]||(e[66]=m("strong",null,"答案：",-1)),m("span",{class:"math-content",innerHTML:X(p.answer)},null,8,Pa)]),p.analysis?(_(),w("div",Ia,[e[67]||(e[67]=m("strong",null,"解析：",-1)),m("span",{class:"math-content",innerHTML:X(p.analysis)},null,8,Ha)])):R("",!0)]))),128))])])):R("",!0)]}),_:1},8,["modelValue","fullscreen"]),a(H,{modelValue:J.value,"onUpdate:modelValue":e[41]||(e[41]=l=>J.value=l),title:"编辑题目",width:"1000px",top:"3vh",class:"question-edit-dialog"},{footer:o(()=>[a(r,{onClick:e[40]||(e[40]=l=>J.value=!1)},{default:o(()=>[...e[75]||(e[75]=[y("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:ta,loading:he.value},{default:o(()=>[...e[76]||(e[76]=[y("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(D,{model:s.value,"label-width":"100px",class:"question-edit-form"},{default:o(()=>[a(Ve,{gutter:20},{default:o(()=>[a(P,{span:8},{default:o(()=>[a(v,{label:"题型"},{default:o(()=>[a(i,{modelValue:s.value.exercise_type,"onUpdate:modelValue":e[25]||(e[25]=l=>s.value.exercise_type=l),style:{width:"100%"},onChange:Je},{default:o(()=>[a(u,{label:"单选题",value:1}),a(u,{label:"多选题",value:2}),a(u,{label:"填空题",value:3}),a(u,{label:"解答题",value:4}),a(u,{label:"判断题",value:5})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(P,{span:8},{default:o(()=>[a(v,{label:"难度"},{default:o(()=>[a(ra,{modelValue:s.value.level,"onUpdate:modelValue":e[26]||(e[26]=l=>s.value.level=l),max:5},null,8,["modelValue"])]),_:1})]),_:1}),a(P,{span:8},{default:o(()=>[a(v,{label:"分值"},{default:o(()=>[a(S,{modelValue:s.value.total_score,"onUpdate:modelValue":e[27]||(e[27]=l=>s.value.total_score=l),min:0,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(Ve,{gutter:20},{default:o(()=>[a(P,{span:6},{default:o(()=>[a(v,{label:"所属科目"},{default:o(()=>[a(i,{modelValue:s.value.major_id,"onUpdate:modelValue":e[28]||(e[28]=l=>s.value.major_id=l),style:{width:"100%"},placeholder:"请选择科目",onChange:Oe,loading:me.value},{default:o(()=>[(_(!0),w(U,null,$(F.value,l=>(_(),j(u,{key:l.major_id||l.id,label:l.subject_name||l.name,value:String(l.major_id||l.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),a(P,{span:12},{default:o(()=>[a(v,{label:"所属章节"},{default:o(()=>[m("div",Qa,[a(i,{modelValue:s.value.chapter_id,"onUpdate:modelValue":e[29]||(e[29]=l=>s.value.chapter_id=l),style:{flex:"1","min-width":"200px"},placeholder:"请选择章节",loading:_e.value},{default:o(()=>[(_(!0),w(U,null,$(N.value,l=>(_(),j(u,{key:l.chapter_id||l.id,label:Re(l),value:String(l.chapter_id||l.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])])]),_:1})]),_:1}),a(P,{span:6},{default:o(()=>[a(v,{label:"题号"},{default:o(()=>[a(S,{modelValue:s.value.exercise_number,"onUpdate:modelValue":e[30]||(e[30]=l=>s.value.exercise_number=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(Ve,{gutter:20},{default:o(()=>[a(P,{span:8},{default:o(()=>[a(v,{label:"考试年份"},{default:o(()=>[a(t,{modelValue:s.value.exam_time,"onUpdate:modelValue":e[31]||(e[31]=l=>s.value.exam_time=l),placeholder:"如：2025年"},null,8,["modelValue"])]),_:1})]),_:1}),a(P,{span:8},{default:o(()=>[a(v,{label:"学校/来源"},{default:o(()=>[a(t,{modelValue:s.value.from_school,"onUpdate:modelValue":e[32]||(e[32]=l=>s.value.from_school=l),placeholder:"如：全国统考"},null,8,["modelValue"])]),_:1})]),_:1}),a(P,{span:8},{default:o(()=>[a(v,{label:"科目代码"},{default:o(()=>[a(t,{modelValue:s.value.exam_code,"onUpdate:modelValue":e[33]||(e[33]=l=>s.value.exam_code=l),placeholder:"如：408"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(v,{label:"知识点标签"},{default:o(()=>[m("div",Ra,[(_(!0),w(U,null,$(s.value.knowledgeTags,(l,p)=>(_(),j(h,{key:p,closable:"",onClose:T=>We(p),class:"tag-item"},{default:o(()=>[y(B(l.tag_name||l),1)]),_:2},1032,["onClose"]))),128)),a(ua,null,{default:o(()=>[a(r,{type:"primary",link:"",size:"small",onClick:Ye},{default:o(()=>[a(le,null,{default:o(()=>[a(ie(fa))]),_:1}),e[68]||(e[68]=y(" 从考点选择 ",-1))]),_:1}),a(r,{type:"success",link:"",size:"small",onClick:la},{default:o(()=>[a(le,null,{default:o(()=>[a(ie(we))]),_:1}),e[69]||(e[69]=y(" 输入添加 ",-1))]),_:1})]),_:1})])]),_:1}),a(v,{label:"题干",class:"form-item-stem"},{default:o(()=>[m("div",Aa,[a(A,{modelValue:s.value.stem,"onUpdate:modelValue":e[34]||(e[34]=l=>s.value.stem=l),placeholder:"请输入题干",height:120},null,8,["modelValue"])])]),_:1}),s.value.exercise_type===1||s.value.exercise_type===2||s.value.exercise_type===5?(_(),j(v,{key:0,label:"选项",class:"form-item-options"},{default:o(()=>[m("div",Ka,[(_(!0),w(U,null,$(s.value.options,(l,p)=>(_(),w("div",{key:p,class:"option-edit-row"},[a(t,{modelValue:l.option_key,"onUpdate:modelValue":T=>l.option_key=T,style:{width:"50px"},placeholder:"选项",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),m("div",Fa,[a(A,{modelValue:l.option_value,"onUpdate:modelValue":T=>l.option_value=T,placeholder:"选项内容",height:80},null,8,["modelValue","onUpdate:modelValue"])]),a(r,{type:"danger",size:"small",onClick:T=>Fe(p)},{default:o(()=>[...e[70]||(e[70]=[y("删除",-1)])]),_:1},8,["onClick"])]))),128))]),a(r,{type:"primary",size:"small",onClick:Ke,class:"add-option-btn"},{default:o(()=>[a(le,null,{default:o(()=>[a(ie(we))]),_:1}),e[71]||(e[71]=y(" 添加选项 ",-1))]),_:1})]),_:1})):R("",!0),s.value.exercise_type===4?(_(),j(v,{key:1,label:"小题列表"},{default:o(()=>[m("div",Oa,[(_(!0),w(U,null,$(s.value.subs,(l,p)=>(_(),w("div",{key:p,class:"sub-item-editor"},[m("div",Ja,[m("span",Xa,"小题 "+B(p+1),1),a(t,{modelValue:l.score,"onUpdate:modelValue":T=>l.score=T,placeholder:"分值",style:{width:"80px"},size:"small"},{append:o(()=>[...e[72]||(e[72]=[y("分",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"]),a(r,{type:"danger",size:"small",onClick:T=>Ge(p)},{default:o(()=>[...e[73]||(e[73]=[y("删除",-1)])]),_:1},8,["onClick"])]),m("div",Ga,[a(v,{label:"小题题干"},{default:o(()=>[a(A,{modelValue:l.stem,"onUpdate:modelValue":T=>l.stem=T,placeholder:"请输入小题题干",height:80},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(v,{label:"小题答案"},{default:o(()=>[a(A,{modelValue:l.answer,"onUpdate:modelValue":T=>l.answer=T,placeholder:"请输入小题答案",height:80},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(v,{label:"小题解析"},{default:o(()=>[a(A,{modelValue:l.analysis,"onUpdate:modelValue":T=>l.analysis=T,placeholder:"请输入小题解析",height:80},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]))),128))]),a(r,{type:"primary",size:"small",onClick:Xe,class:"mt-10"},{default:o(()=>[a(le,null,{default:o(()=>[a(ie(we))]),_:1}),e[74]||(e[74]=y(" 添加小题 ",-1))]),_:1})]),_:1})):R("",!0),a(v,{label:"答案",class:"form-item-answer"},{default:o(()=>[m("div",Wa,[a(A,{modelValue:s.value.answer,"onUpdate:modelValue":e[35]||(e[35]=l=>s.value.answer=l),placeholder:"请输入答案",height:100},null,8,["modelValue"])])]),_:1}),a(v,{label:"解析",class:"form-item-analysis"},{default:o(()=>[m("div",Ya,[a(A,{modelValue:s.value.analysis,"onUpdate:modelValue":e[36]||(e[36]=l=>s.value.analysis=l),placeholder:"请输入解析",height:120},null,8,["modelValue"])])]),_:1}),a(v,{label:"试卷分值",class:"form-item-score"},{default:o(()=>[a(S,{modelValue:s.value.paper_score,"onUpdate:modelValue":e[37]||(e[37]=l=>s.value.paper_score=l),min:0,max:100},null,8,["modelValue"])]),_:1}),a(v,{label:"考试全称"},{default:o(()=>[a(t,{modelValue:s.value.exam_full_name,"onUpdate:modelValue":e[38]||(e[38]=l=>s.value.exam_full_name=l),placeholder:"如：计算机学科基础综合"},null,8,["modelValue"])]),_:1}),a(v,{label:"视频URL"},{default:o(()=>[a(t,{modelValue:s.value.video_url,"onUpdate:modelValue":e[39]||(e[39]=l=>s.value.video_url=l),placeholder:"请输入视频链接（如有）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(H,{modelValue:O.value,"onUpdate:modelValue":e[46]||(e[46]=l=>O.value=l),title:"选择考点",width:"600px","close-on-click-modal":!1},{footer:o(()=>[a(r,{onClick:e[45]||(e[45]=l=>O.value=!1)},{default:o(()=>[...e[77]||(e[77]=[y("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:aa,disabled:!k.value.tag_id},{default:o(()=>[...e[78]||(e[78]=[y("确定",-1)])]),_:1},8,["disabled"])]),default:o(()=>[a(D,{"label-width":"80px"},{default:o(()=>[a(v,{label:"选择科目"},{default:o(()=>[a(i,{modelValue:k.value.major_id,"onUpdate:modelValue":e[42]||(e[42]=l=>k.value.major_id=l),placeholder:"请选择科目",clearable:"",style:{width:"100%"},onChange:Ze},{default:o(()=>[(_(!0),w(U,null,$(F.value,l=>(_(),j(u,{key:l.id,label:l.name,value:String(l.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"选择章节"},{default:o(()=>[a(i,{modelValue:k.value.chapter_id,"onUpdate:modelValue":e[43]||(e[43]=l=>k.value.chapter_id=l),placeholder:"请选择章节",clearable:"",style:{width:"100%"},onChange:ea,disabled:!k.value.major_id},{default:o(()=>[(_(!0),w(U,null,$(W.value,l=>(_(),j(u,{key:l.id,label:l.name,value:String(l.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(v,{label:"选择考点"},{default:o(()=>[a(i,{modelValue:k.value.tag_id,"onUpdate:modelValue":e[44]||(e[44]=l=>k.value.tag_id=l),placeholder:"请选择考点",clearable:"",style:{width:"100%"},disabled:!k.value.chapter_id,filterable:""},{default:o(()=>[(_(!0),w(U,null,$(Q.value,l=>(_(),j(u,{key:l.tag_id,label:l.tag_name,value:String(l.tag_id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},nl=da(Za,[["__scopeId","data-v-1de223bd"]]);export{nl as default};
