import{_ as G,i as L,o as u,c as C,a,w as t,p as _,E as r,r as s,f as d,D as T,C as H,z as V,d as v,e as b,F as M,y as B,G as J}from"./index-CYafs7gL.js";const K={class:"chapter-manage"},O={class:"card-header"},P={class:"header-actions"},Q={class:"dialog-footer"},R={__name:"ChapterManage",setup(W){const k=d([]),y=d([]),i=d(null),g=d(!1),c=d(!1),o=d({id:null,name:"",subject_id:null,sort:0}),D=async()=>{try{const n=await _.getAdminSubjects();y.value=n.data||[]}catch(n){console.error("加载科目失败:",n)}},f=async()=>{g.value=!0;try{const n={};i.value&&(n.subject_id=i.value);const e=await _.getChapters(n);k.value=e.data||[]}catch(n){console.error("加载章节失败:",n),r.error("加载章节失败")}finally{g.value=!1}},j=(n=null)=>{n?o.value={...n}:o.value={id:null,name:"",subject_id:i.value,sort:0},c.value=!0},I=async()=>{if(!o.value.subject_id||!o.value.name){r.warning("请填写完整信息");return}try{o.value.id?(await _.updateChapter(o.value.id,o.value),r.success("更新成功")):(await _.createChapter(o.value),r.success("创建成功")),c.value=!1,f()}catch{r.error("保存失败")}},U=n=>{J.confirm("确定要删除该章节吗？","提示",{type:"warning"}).then(async()=>{try{await _.deleteChapter(n.id),r.success("删除成功"),f()}catch{r.error("删除失败")}})};return L(()=>{D(),f()}),(n,e)=>{const h=s("el-option"),x=s("el-select"),p=s("el-button"),m=s("el-table-column"),E=s("el-table"),$=s("el-card"),w=s("el-form-item"),N=s("el-input"),S=s("el-input-number"),q=s("el-form"),A=s("el-dialog"),F=T("loading");return u(),C("div",K,[a($,{class:"box-card"},{header:t(()=>[b("div",O,[e[8]||(e[8]=b("span",null,"章节管理",-1)),b("div",P,[a(x,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),placeholder:"筛选科目",clearable:"",onChange:f,style:{"margin-right":"10px"}},{default:t(()=>[(u(!0),C(M,null,B(y.value,l=>(u(),V(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(p,{type:"primary",onClick:e[1]||(e[1]=l=>j())},{default:t(()=>[...e[7]||(e[7]=[v("添加章节",-1)])]),_:1})])])]),default:t(()=>[H((u(),V(E,{data:k.value,style:{width:"100%"}},{default:t(()=>[a(m,{prop:"id",label:"ID",width:"80"}),a(m,{prop:"name",label:"章节名称"}),a(m,{prop:"subject_name",label:"所属科目"}),a(m,{prop:"sort",label:"排序",width:"80"}),a(m,{label:"操作",width:"150"},{default:t(l=>[a(p,{link:"",type:"primary",onClick:z=>j(l.row)},{default:t(()=>[...e[9]||(e[9]=[v("编辑",-1)])]),_:1},8,["onClick"]),a(p,{link:"",type:"danger",onClick:z=>U(l.row)},{default:t(()=>[...e[10]||(e[10]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,g.value]])]),_:1}),a(A,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value=l),title:o.value.id?"编辑章节":"添加章节",width:"500px"},{footer:t(()=>[b("span",Q,[a(p,{onClick:e[5]||(e[5]=l=>c.value=!1)},{default:t(()=>[...e[11]||(e[11]=[v("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:I},{default:t(()=>[...e[12]||(e[12]=[v("确定",-1)])]),_:1})])]),default:t(()=>[a(q,{model:o.value,"label-width":"100px"},{default:t(()=>[a(w,{label:"所属科目",required:""},{default:t(()=>[a(x,{modelValue:o.value.subject_id,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.subject_id=l),placeholder:"请选择科目"},{default:t(()=>[(u(!0),C(M,null,B(y.value,l=>(u(),V(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(w,{label:"章节名称",required:""},{default:t(()=>[a(N,{modelValue:o.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.name=l),placeholder:"如：第一章 绪论"},null,8,["modelValue"])]),_:1}),a(w,{label:"排序值"},{default:t(()=>[a(S,{modelValue:o.value.sort,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.sort=l),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Y=G(R,[["__scopeId","data-v-38ff137e"]]);export{Y as default};
