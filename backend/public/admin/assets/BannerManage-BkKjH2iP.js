import{_ as Y,i as Z,o as h,c as E,e as r,a as l,w as a,p as f,r as n,f as d,D as ee,k,J as L,d as u,C as le,z as S,N as ae,t as M,O as te,q as oe,E as y,G as se}from"./index-CYafs7gL.js";const ne={class:"banner-manage"},re={class:"page-header"},ue={class:"right"},ie={class:"card-header"},de={class:"image-error"},ce={class:"status-label"},pe=["src"],me={class:"dialog-footer"},fe={__name:"BannerManage",setup(_e){const _=d(!1),C=d(!1),x=d([]),v=d(""),p=d(!1),g=d(!1),B=d(null),s=d({id:null,title:"",imageUrl:"",link:"",sort:0,status:1}),R={title:[{required:!0,message:"请输入标题",trigger:"blur"}],imageUrl:[{required:!0,message:"请上传图片或输入图片URL",trigger:"blur"}]},I=oe(()=>v.value?x.value.filter(o=>o.title.toLowerCase().includes(v.value.toLowerCase())||o.id&&o.id.toString().includes(v.value)):x.value),V=async()=>{_.value=!0;try{const o=await f.getBanners();o.code===0&&(x.value=o.data.list||[])}catch(o){console.error("Fetch banners failed:",o)}finally{_.value=!1}},N=()=>{g.value=!1,s.value={id:null,title:"",imageUrl:"",link:"",sort:0,status:1},p.value=!0},T=o=>{g.value=!0,s.value={...o},p.value=!0},$=o=>{se.confirm("确定要删除该轮播图吗?","提示",{type:"warning"}).then(async()=>{try{(await f.deleteBanner(o.id)).code===0&&(y.success("删除成功"),V())}catch(e){console.error("Delete banner failed:",e)}})},q=async(o,e)=>{try{(await f.updateBannerStatus(o.id,e)).code===0?y.success(`已${e===1?"启用":"禁用"}`):o.status=e===1?0:1}catch(c){o.status=e===1?0:1,console.error("Update status failed:",c)}},A=async o=>{try{_.value=!0;const e=await f.uploadImage(o.raw);e.code===0&&e.data.url&&(s.value.imageUrl=e.data.url,y.success("图片上传成功"))}catch(e){console.error("Upload failed:",e),y.error("图片上传失败")}finally{_.value=!1}},F=async()=>{B.value&&await B.value.validate(async o=>{if(o){C.value=!0;try{let e;g.value?e=await f.updateBanner(s.value.id,s.value):e=await f.createBanner(s.value),e.code===0&&(y.success(g.value?"修改成功":"添加成功"),p.value=!1,V())}catch(e){console.error("Save banner failed:",e)}finally{C.value=!1}}})},z=o=>o?new Date(o).toLocaleString():"-";return Z(()=>{V()}),(o,e)=>{const c=n("el-icon"),m=n("el-button"),U=n("el-input"),i=n("el-table-column"),G=n("el-image"),J=n("el-switch"),O=n("el-table"),Q=n("el-card"),w=n("el-form-item"),j=n("el-upload"),H=n("el-input-number"),D=n("el-radio"),K=n("el-radio-group"),P=n("el-form"),W=n("el-dialog"),X=ee("loading");return h(),E("div",ne,[r("div",re,[e[9]||(e[9]=r("div",{class:"left"},[r("h2",null,"轮播图管理"),r("p",{class:"subtitle"},"管理首页顶部轮播图及其跳转链接")],-1)),r("div",ue,[l(m,{type:"primary",onClick:N},{default:a(()=>[l(c,null,{default:a(()=>[l(k(L))]),_:1}),e[8]||(e[8]=u("添加轮播图 ",-1))]),_:1})])]),l(Q,{shadow:"never",class:"table-card"},{header:a(()=>[r("div",ie,[l(U,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),placeholder:"搜索轮播图标题...",style:{width:"300px"},clearable:""},{prefix:a(()=>[l(c,null,{default:a(()=>[l(k(te))]),_:1})]),_:1},8,["modelValue"]),l(m,{onClick:V},{default:a(()=>[...e[10]||(e[10]=[u("刷新",-1)])]),_:1})])]),default:a(()=>[le((h(),S(O,{data:I.value,style:{width:"100%"}},{default:a(()=>[l(i,{prop:"id",label:"ID",width:"80"}),l(i,{label:"预览图",width:"180"},{default:a(t=>[l(G,{style:{width:"140px",height:"70px","border-radius":"4px"},src:t.row.imageUrl,"preview-src-list":[t.row.imageUrl],fit:"cover","preview-teleported":""},{error:a(()=>[r("div",de,[l(c,null,{default:a(()=>[l(k(ae))]),_:1})])]),_:1},8,["src","preview-src-list"])]),_:1}),l(i,{prop:"title",label:"标题","min-width":"150"}),l(i,{prop:"link",label:"跳转链接","min-width":"150","show-overflow-tooltip":""}),l(i,{prop:"sort",label:"排序",width:"100",sortable:""}),l(i,{label:"状态",width:"120"},{default:a(t=>[l(J,{modelValue:t.row.status,"onUpdate:modelValue":b=>t.row.status=b,"active-value":1,"inactive-value":0,onChange:b=>q(t.row,b)},null,8,["modelValue","onUpdate:modelValue","onChange"]),r("span",ce,M(t.row.status===1?"启用":"禁用"),1)]),_:1}),l(i,{prop:"createTime",label:"创建时间",width:"180"},{default:a(t=>[u(M(z(t.row.createTime)),1)]),_:1}),l(i,{label:"操作",width:"150",fixed:"right"},{default:a(t=>[l(m,{link:"",type:"primary",onClick:b=>T(t.row)},{default:a(()=>[...e[11]||(e[11]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(m,{link:"",type:"danger",onClick:b=>$(t.row)},{default:a(()=>[...e[12]||(e[12]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,_.value]])]),_:1}),l(W,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=t=>p.value=t),title:g.value?"编辑轮播图":"添加轮播图",width:"500px","destroy-on-close":""},{footer:a(()=>[r("span",me,[l(m,{onClick:e[6]||(e[6]=t=>p.value=!1)},{default:a(()=>[...e[16]||(e[16]=[u("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:F,loading:C.value},{default:a(()=>[...e[17]||(e[17]=[u(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l(P,{ref_key:"formRef",ref:B,model:s.value,rules:R,"label-width":"100px",class:"banner-form"},{default:a(()=>[l(w,{label:"标题",prop:"title"},{default:a(()=>[l(U,{modelValue:s.value.title,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.title=t),placeholder:"请输入轮播图标题"},null,8,["modelValue"])]),_:1}),l(w,{label:"轮播图片",prop:"imageUrl"},{default:a(()=>[l(j,{class:"banner-uploader",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":A},{default:a(()=>[s.value.imageUrl?(h(),E("img",{key:0,src:s.value.imageUrl,class:"banner-preview"},null,8,pe)):(h(),S(c,{key:1,class:"banner-uploader-icon"},{default:a(()=>[l(k(L))]),_:1}))]),_:1}),e[13]||(e[13]=r("div",{class:"upload-tip"},"建议尺寸: 750x350，点击图片更换",-1)),l(U,{modelValue:s.value.imageUrl,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.imageUrl=t),placeholder:"或输入图片URL",class:"mt-10"},null,8,["modelValue"])]),_:1}),l(w,{label:"跳转链接",prop:"link"},{default:a(()=>[l(U,{modelValue:s.value.link,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.link=t),placeholder:"请输入页面路径或URL"},null,8,["modelValue"])]),_:1}),l(w,{label:"排序值",prop:"sort"},{default:a(()=>[l(H,{modelValue:s.value.sort,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.sort=t),min:0},null,8,["modelValue"])]),_:1}),l(w,{label:"启用状态",prop:"status"},{default:a(()=>[l(K,{modelValue:s.value.status,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.status=t)},{default:a(()=>[l(D,{label:1},{default:a(()=>[...e[14]||(e[14]=[u("启用",-1)])]),_:1}),l(D,{label:0},{default:a(()=>[...e[15]||(e[15]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ge=Y(fe,[["__scopeId","data-v-44a7f6ca"]]);export{ge as default};
