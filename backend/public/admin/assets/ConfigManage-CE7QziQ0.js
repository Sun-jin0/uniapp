import{_ as S,i as U,o as h,c as F,e as t,a,w as l,p as C,E as f,r as d,f as w,D as H,C as N,z as T,d as V,t as r}from"./index-1rGkZLYp.js";const $={class:"config-manage"},I={class:"preview-container"},O={class:"countdown-preview"},j={class:"preview-title"},z={class:"preview-days"},A={class:"days-num"},P={class:"preview-date"},q={class:"preview-note"},G={__name:"ConfigManage",setup(J){const _=w(!1),v=w(!1),o=w({countdown_title:"",countdown_date:"",countdown_days:0,countdown_note:""}),g=n=>{if(!n)return 0;const e=new Date(n),u=new Date;e.setHours(0,0,0,0),u.setHours(0,0,0,0);const s=e.getTime()-u.getTime(),i=Math.ceil(s/(1e3*60*60*24));return i>0?i:0},k=n=>{n&&(o.value.countdown_days=g(n))},b=n=>{if(n!==null){const e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+n);const u=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");o.value.countdown_date=`${u}-${s}-${i}`}},m=async()=>{_.value=!0;try{const n=await C.getConfigs();n.code===0&&n.data&&(n.data.forEach(e=>{Object.prototype.hasOwnProperty.call(o.value,e.config_key)&&(e.config_key==="countdown_days"?o.value[e.config_key]=parseInt(e.config_value)||0:o.value[e.config_key]=e.config_value)}),o.value.countdown_date&&!o.value.countdown_days&&(o.value.countdown_days=g(o.value.countdown_date)))}catch(n){console.error("Failed to load configs:",n),f.error("加载配置失败")}finally{_.value=!1}},M=async()=>{v.value=!0;try{const n=[{key:"countdown_title",value:o.value.countdown_title,description:"倒计时标题"},{key:"countdown_date",value:o.value.countdown_date,description:"目标日期"},{key:"countdown_note",value:o.value.countdown_note,description:"备注信息"}];for(const e of n)await C.saveConfigs(e);f.success("保存成功")}catch(n){console.error("Failed to save configs:",n),f.error("保存失败")}finally{v.value=!1}};return U(()=>{m()}),(n,e)=>{const u=d("el-input"),s=d("el-form-item"),i=d("el-date-picker"),Y=d("el-input-number"),y=d("el-button"),x=d("el-form"),p=d("el-card"),D=d("el-col"),B=d("el-row"),E=H("loading");return h(),F("div",$,[e[12]||(e[12]=t("div",{class:"page-header"},[t("div",{class:"left"},[t("h2",null,"系统配置"),t("p",{class:"subtitle"},"管理首页倒计时、考研目标日期及全局设置")])],-1)),a(B,{gutter:20},{default:l(()=>[a(D,{span:12},{default:l(()=>[a(p,{shadow:"never",class:"config-card"},{header:l(()=>[...e[4]||(e[4]=[t("div",{class:"card-header"},[t("span",null,"倒计时设置")],-1)])]),default:l(()=>[N((h(),T(x,{model:o.value,"label-width":"120px"},{default:l(()=>[a(s,{label:"标题"},{default:l(()=>[a(u,{modelValue:o.value.countdown_title,"onUpdate:modelValue":e[0]||(e[0]=c=>o.value.countdown_title=c),placeholder:"例如：考研倒计时"},null,8,["modelValue"])]),_:1}),a(s,{label:"目标日期"},{default:l(()=>[a(i,{modelValue:o.value.countdown_date,"onUpdate:modelValue":e[1]||(e[1]=c=>o.value.countdown_date=c),type:"date",placeholder:"选择目标日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:k,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(s,{label:"剩余天数"},{default:l(()=>[a(Y,{modelValue:o.value.countdown_days,"onUpdate:modelValue":e[2]||(e[2]=c=>o.value.countdown_days=c),min:0,onChange:b,style:{width:"100%"}},null,8,["modelValue"]),e[5]||(e[5]=t("div",{class:"form-tip"},"修改天数会自动更新目标日期",-1))]),_:1}),a(s,{label:"备注/鼓励语"},{default:l(()=>[a(u,{modelValue:o.value.countdown_note,"onUpdate:modelValue":e[3]||(e[3]=c=>o.value.countdown_note=c),type:"textarea",rows:"3",placeholder:"例如：加油，考研人！"},null,8,["modelValue"])]),_:1}),a(s,null,{default:l(()=>[a(y,{type:"primary",onClick:M,loading:v.value},{default:l(()=>[...e[6]||(e[6]=[V(" 保存设置 ",-1)])]),_:1},8,["loading"]),a(y,{onClick:m},{default:l(()=>[...e[7]||(e[7]=[V("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[E,_.value]])]),_:1})]),_:1}),a(D,{span:12},{default:l(()=>[a(p,{shadow:"never",class:"config-card"},{header:l(()=>[...e[8]||(e[8]=[t("div",{class:"card-header"},[t("span",null,"预览效果")],-1)])]),default:l(()=>[t("div",I,[t("div",O,[t("div",j,r(o.value.countdown_title||"考研倒计时"),1),t("div",z,[t("span",A,r(o.value.countdown_days||0),1),e[9]||(e[9]=t("span",{class:"days-unit"},"天",-1))]),t("div",P,"目标日期: "+r(o.value.countdown_date||"未设置"),1),t("div",q,r(o.value.countdown_note||"坚持就是胜利！"),1)])])]),_:1}),a(p,{shadow:"never",class:"config-card mt-20"},{header:l(()=>[...e[10]||(e[10]=[t("div",{class:"card-header"},[t("span",null,"其他系统配置")],-1)])]),default:l(()=>[e[11]||(e[11]=t("div",{class:"placeholder-text"},"暂无其他配置项",-1))]),_:1})]),_:1})]),_:1})])}}},L=S(G,[["__scopeId","data-v-3886bc7b"]]);export{L as default};
