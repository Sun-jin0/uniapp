import{_ as ze,i as Be,o as f,c as P,e as g,a,w as o,b as Ie,z,m as Q,C as Ne,p as v,f as n,r as u,D as Re,F as le,y as ae,d as r,t as _,G as W,E as p}from"./index-1rGkZLYp.js";const Se={class:"pan-manage"},$e={class:"header-actions"},Te={class:"left"},Me={class:"right"},Ae={class:"title-cell"},Qe={class:"title-text"},Ee={key:0,class:"link-item"},Fe={key:1,class:"link-item"},qe={class:"pagination-container"},Oe={class:"category-modal-body"},Ke={class:"add-cat-form"},Le={class:"sync-tips"},je={__name:"PanManage",setup(Ge){const E=n(!1),F=n(!1),H=n([]),B=n([]),J=n([]),I=n(""),q=n(""),C=n([]),h=n(1),N=n(20),X=n(0),V=n(!1),R=n(!1),s=n({ResourceID:null,Title:"",Category:"",QuarkUrl:"",BaiduUrl:"",Description:"",IsNew:!1}),O=n(!1),U=n(""),x=n(!1),S=n(""),K=n(!1),D=n(!1),k=n([]),L=n(!1),y=async()=>{E.value=!0;try{const t={page:h.value,limit:N.value,search:q.value,category:I.value},e=await v.getPanResources(t);e.code===0&&(H.value=e.data.list||e.data||[],X.value=e.data.total||(Array.isArray(e.data)?e.data.length:0))}catch(t){console.error("获取资源失败:",t)}finally{E.value=!1}},w=async()=>{try{const t=await v.getPanCategories();t.code===0&&(B.value=t.data||[])}catch(t){console.error("获取分类失败:",t)}},j=async()=>{try{const t=await v.getPanCategories(!0);t.code===0&&(J.value=t.data||[])}catch(t){console.error("获取完整分类失败:",t)}},$=()=>{h.value=1,y()},te=t=>{N.value=t,y()},oe=t=>{h.value=t,y()},ne=t=>{C.value=t.map(e=>e.ResourceID)},re=()=>{s.value={ResourceID:null,Title:"",Category:I.value||B.value[0]||"",QuarkUrl:"",BaiduUrl:"",Description:"",IsNew:!1},R.value=!1,V.value=!0},se=t=>{s.value={...t},R.value=!0,V.value=!0},ue=async()=>{if(!s.value.Title||!s.value.Category)return p.warning("标题和分类必填");F.value=!0;try{let t;R.value?t=await v.updatePanResource(s.value.ResourceID,s.value):t=await v.createPanResource(s.value),t.code===0&&(p.success("保存成功"),V.value=!1,y(),w())}catch{p.error("保存失败")}finally{F.value=!1}},de=t=>{W.confirm("确定要删除该资源吗？","提示",{type:"warning"}).then(async()=>{try{(await v.deletePanResource(t.ResourceID)).code===0&&(p.success("删除成功"),y())}catch{p.error("删除失败")}}).catch(()=>{})},ie=()=>{W.confirm(`确定要批量删除选中的 ${C.value.length} 条资源吗？`,"警告",{type:"danger"}).then(async()=>{try{(await v.batchDeletePanResources({ids:C.value})).code===0&&(p.success("批量删除成功"),C.value=[],y())}catch{p.error("批量删除失败")}}).catch(()=>{})},ce=async()=>{if(U.value.trim())try{(await v.createPanCategory({name:U.value.trim()})).code===0&&(U.value="",j(),w())}catch{p.error("添加分类失败")}},pe=async t=>{try{await v.updatePanCategory(t.CategoryID,{name:t.CategoryName,sortOrder:t.SortOrder}),w()}catch(e){console.error("更新分类失败:",e)}},me=t=>{W.confirm(`确定要删除分类“${t.CategoryName}”吗？`,"提示",{type:"warning"}).then(async()=>{try{(await v.deletePanCategory(t.CategoryID)).code===0&&(j(),w())}catch{p.error("删除失败")}}).catch(()=>{})},ve=async()=>{if(!S.value.trim())return p.warning("请粘贴文本");K.value=!0;try{const t=await v.parsePanResources({rawText:S.value});t.code===0&&(t.data.length===0?p.warning("未识别到任何资源"):(k.value=t.data,x.value=!1,D.value=!0))}catch{p.error("解析失败")}finally{K.value=!1}},fe=t=>{k.value.splice(t,1)},ge=async()=>{if(k.value.length!==0){L.value=!0;try{const t=await v.importPanResources({resources:k.value});t.code===0&&(p.success(`导入成功: 新增${t.data.createdCount}, 更新${t.data.updatedCount}`),D.value=!1,y(),w())}catch{p.error("导入失败")}finally{L.value=!1}}},ye=t=>({create:"success",update:"warning",supplement:"info",ignore:"danger"})[t]||"info",_e=t=>({create:"新增",update:"更新",supplement:"补充",ignore:"忽略"})[t]||t,Ce=t=>t?new Date(t).toLocaleString():"-";return Be(()=>{y(),w(),j()}),(t,e)=>{const Ve=u("Search"),T=u("el-icon"),d=u("el-button"),m=u("el-input"),Y=u("el-option"),Z=u("el-select"),ke=u("Plus"),we=u("Connection"),be=u("FolderOpened"),i=u("el-table-column"),M=u("el-tag"),ee=u("el-link"),G=u("el-table"),he=u("el-pagination"),b=u("el-form-item"),Ue=u("el-switch"),xe=u("el-form"),A=u("el-dialog"),De=u("el-alert"),Pe=Re("loading");return f(),P("div",Se,[g("div",$e,[g("div",Te,[a(m,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=l=>q.value=l),placeholder:"搜索资源标题...",class:"search-input",clearable:"",onClear:$,onKeyup:Ie($,["enter"])},{append:o(()=>[a(d,{onClick:$},{default:o(()=>[a(T,null,{default:o(()=>[a(Ve)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Z,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=l=>I.value=l),placeholder:"全部分类",onChange:$,clearable:"",class:"category-select"},{default:o(()=>[(f(!0),P(le,null,ae(B.value,l=>(f(),z(Y,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(d,{type:"primary",onClick:re},{default:o(()=>[a(T,null,{default:o(()=>[a(ke)]),_:1}),e[21]||(e[21]=r(" 添加资源 ",-1))]),_:1}),a(d,{type:"success",onClick:e[2]||(e[2]=l=>x.value=!0)},{default:o(()=>[a(T,null,{default:o(()=>[a(we)]),_:1}),e[22]||(e[22]=r(" 批量获取 ",-1))]),_:1})]),g("div",Me,[a(d,{onClick:e[3]||(e[3]=l=>O.value=!0)},{default:o(()=>[a(T,null,{default:o(()=>[a(be)]),_:1}),e[23]||(e[23]=r(" 分类管理 ",-1))]),_:1}),C.value.length>0?(f(),z(d,{key:0,type:"danger",onClick:ie},{default:o(()=>[r(" 批量删除 ("+_(C.value.length)+") ",1)]),_:1})):Q("",!0)])]),Ne((f(),z(G,{data:H.value,border:"",stripe:"",style:{width:"100%"},onSelectionChange:ne},{default:o(()=>[a(i,{type:"selection",width:"55"}),a(i,{label:"资源标题","min-width":"200"},{default:o(({row:l})=>[g("div",Ae,[l.IsNew?(f(),z(M,{key:0,size:"small",type:"danger",effect:"dark",class:"mr-5"},{default:o(()=>[...e[24]||(e[24]=[r("NEW",-1)])]),_:1})):Q("",!0),g("span",Qe,_(l.Title),1)])]),_:1}),a(i,{prop:"Category",label:"分类",width:"120",align:"center"}),a(i,{label:"网盘链接","min-width":"200"},{default:o(({row:l})=>[l.QuarkUrl?(f(),P("div",Ee,[a(M,{size:"small",class:"link-tag quark"},{default:o(()=>[...e[25]||(e[25]=[r("夸克",-1)])]),_:1}),a(ee,{href:l.QuarkUrl,target:"_blank",type:"primary",underline:!1,class:"link-text"},{default:o(()=>[r(_(l.QuarkUrl),1)]),_:2},1032,["href"])])):Q("",!0),l.BaiduUrl?(f(),P("div",Fe,[a(M,{size:"small",type:"warning",class:"link-tag baidu"},{default:o(()=>[...e[26]||(e[26]=[r("百度",-1)])]),_:1}),a(ee,{href:l.BaiduUrl,target:"_blank",type:"primary",underline:!1,class:"link-text"},{default:o(()=>[r(_(l.BaiduUrl),1)]),_:2},1032,["href"])])):Q("",!0)]),_:1}),a(i,{prop:"CreatedAt",label:"发布时间",width:"180",align:"center"},{default:o(({row:l})=>[r(_(Ce(l.CreatedAt)),1)]),_:1}),a(i,{label:"操作",width:"150",align:"center",fixed:"right"},{default:o(({row:l})=>[a(d,{size:"small",onClick:c=>se(l)},{default:o(()=>[...e[27]||(e[27]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(d,{size:"small",type:"danger",onClick:c=>de(l)},{default:o(()=>[...e[28]||(e[28]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Pe,E.value]]),g("div",qe,[a(he,{"current-page":h.value,"onUpdate:currentPage":e[4]||(e[4]=l=>h.value=l),"page-size":N.value,"onUpdate:pageSize":e[5]||(e[5]=l=>N.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:X.value,onSizeChange:te,onCurrentChange:oe},null,8,["current-page","page-size","total"])]),a(A,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=l=>V.value=l),title:R.value?"编辑资源":"添加资源",width:"600px","destroy-on-close":""},{footer:o(()=>[a(d,{onClick:e[12]||(e[12]=l=>V.value=!1)},{default:o(()=>[...e[29]||(e[29]=[r("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:ue,loading:F.value},{default:o(()=>[...e[30]||(e[30]=[r("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(xe,{model:s.value,"label-width":"100px"},{default:o(()=>[a(b,{label:"标题",required:""},{default:o(()=>[a(m,{modelValue:s.value.Title,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.Title=l),placeholder:"请输入资源标题"},null,8,["modelValue"])]),_:1}),a(b,{label:"分类",required:""},{default:o(()=>[a(Z,{modelValue:s.value.Category,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.Category=l),placeholder:"请选择或输入分类",filterable:"","allow-create":"",style:{width:"100%"}},{default:o(()=>[(f(!0),P(le,null,ae(B.value,l=>(f(),z(Y,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"夸克链接"},{default:o(()=>[a(m,{modelValue:s.value.QuarkUrl,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.QuarkUrl=l),placeholder:"https://pan.quark.cn/s/..."},null,8,["modelValue"])]),_:1}),a(b,{label:"百度链接"},{default:o(()=>[a(m,{modelValue:s.value.BaiduUrl,"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.BaiduUrl=l),placeholder:"https://pan.baidu.com/s/..."},null,8,["modelValue"])]),_:1}),a(b,{label:"描述"},{default:o(()=>[a(m,{modelValue:s.value.Description,"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.Description=l),type:"textarea",rows:3,placeholder:"资源详细描述"},null,8,["modelValue"])]),_:1}),a(b,{label:"标记为新"},{default:o(()=>[a(Ue,{modelValue:s.value.IsNew,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.IsNew=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(A,{modelValue:O.value,"onUpdate:modelValue":e[15]||(e[15]=l=>O.value=l),title:"分类管理",width:"400px"},{default:o(()=>[g("div",Oe,[g("div",Ke,[a(m,{modelValue:U.value,"onUpdate:modelValue":e[14]||(e[14]=l=>U.value=l),placeholder:"新分类名称"},{append:o(()=>[a(d,{onClick:ce},{default:o(()=>[...e[31]||(e[31]=[r("添加",-1)])]),_:1})]),_:1},8,["modelValue"])]),a(G,{data:J.value,height:"300px",style:{"margin-top":"20px"}},{default:o(()=>[a(i,{label:"分类名称"},{default:o(({row:l})=>[a(m,{modelValue:l.CategoryName,"onUpdate:modelValue":c=>l.CategoryName=c,size:"small",onBlur:c=>pe(l)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),a(i,{label:"操作",width:"80",align:"center"},{default:o(({row:l})=>[a(d,{type:"danger",link:"",onClick:c=>me(l)},{default:o(()=>[...e[32]||(e[32]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),a(A,{modelValue:x.value,"onUpdate:modelValue":e[18]||(e[18]=l=>x.value=l),title:"批量解析网盘链接",width:"700px"},{footer:o(()=>[a(d,{onClick:e[17]||(e[17]=l=>x.value=!1)},{default:o(()=>[...e[33]||(e[33]=[r("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:ve,loading:K.value},{default:o(()=>[...e[34]||(e[34]=[r("开始解析",-1)])]),_:1},8,["loading"])]),default:o(()=>[g("div",Le,[a(De,{title:"系统将自动从文本中提取标题、分类和网盘链接。支持多种格式。",type:"info",closable:!1,"show-icon":""})]),a(m,{modelValue:S.value,"onUpdate:modelValue":e[16]||(e[16]=l=>S.value=l),type:"textarea",rows:12,placeholder:`例如：
【2026考研资料】链接：https://pan.quark.cn/s/xxxx
资源名称2 https://pan.baidu.com/s/yyyy`,style:{"margin-top":"15px"}},null,8,["modelValue"])]),_:1},8,["modelValue"]),a(A,{modelValue:D.value,"onUpdate:modelValue":e[20]||(e[20]=l=>D.value=l),title:"解析结果预览",width:"90%",top:"5vh"},{footer:o(()=>[a(d,{onClick:e[19]||(e[19]=l=>D.value=!1)},{default:o(()=>[...e[36]||(e[36]=[r("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:ge,loading:L.value},{default:o(()=>[r("确认并导入 ("+_(k.value.length)+"条)",1)]),_:1},8,["loading"])]),default:o(()=>[a(G,{data:k.value,height:"60vh",border:"",stripe:""},{default:o(()=>[a(i,{label:"状态",width:"100",align:"center"},{default:o(({row:l})=>[a(M,{type:ye(l.action)},{default:o(()=>[r(_(_e(l.action)),1)]),_:2},1032,["type"])]),_:1}),a(i,{label:"标题"},{default:o(({row:l})=>[a(m,{modelValue:l.Title,"onUpdate:modelValue":c=>l.Title=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(i,{label:"分类",width:"150"},{default:o(({row:l})=>[a(m,{modelValue:l.Category,"onUpdate:modelValue":c=>l.Category=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(i,{label:"夸克链接"},{default:o(({row:l})=>[a(m,{modelValue:l.QuarkUrl,"onUpdate:modelValue":c=>l.QuarkUrl=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(i,{label:"百度链接"},{default:o(({row:l})=>[a(m,{modelValue:l.BaiduUrl,"onUpdate:modelValue":c=>l.BaiduUrl=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(i,{label:"操作",width:"80",align:"center"},{default:o(({$index:l})=>[a(d,{type:"danger",link:"",onClick:c=>fe(l)},{default:o(()=>[...e[35]||(e[35]=[r("排除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},He=ze(je,[["__scopeId","data-v-560e3283"]]);export{He as default};
