import{_ as O,H as Q,i as X,o as s,c as x,a,w as t,I as Y,f as g,r as u,u as Z,e as f,d,t as N,z as p,m as c,F as ee,y as le,k as te,J as ae,E as V,q as oe}from"./index-1rGkZLYp.js";import{R as re}from"./RichEditor-DCYX-Nb-.js";import"./style-BS9iE4ZN.js";const ne={class:"article-edit"},ue={class:"page-title"},ie={class:"header-actions"},se={class:"wechat-parse-box"},de=["src"],pe={class:"status-text"},ce={__name:"ArticleEdit",setup(ve){const{proxy:B}=Q(),y=B.$api.adminApi,h=Z(),R=Y(),k=g(null),b=g(!1),U=g(!1),_=g(""),q=["资料","备考经验","政策动态","考试技巧","系统通知"],l=g({id:null,type:"article",noticeType:"article",category:"",title:"",description:"",content:"",author:"管理员",imageUrl:"",linkUrl:"",buttonText:"",isActive:!0}),D={title:[{required:!0,message:"请输入标题",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],linkUrl:[{validator:(n,e,o)=>{(l.value.noticeType==="link"||l.value.noticeType==="wechat"||l.value.type==="ad")&&!e?o(new Error("请输入跳转链接")):o()},trigger:"blur"}]},I=oe(()=>{const n=!!l.value.id;return{article:n?"编辑文章":"发布文章",notice:n?"编辑通知":"添加通知",ad:n?"编辑广告":"添加广告"}[l.value.type]||"内容编辑"});X(()=>{const{id:n,type:e}=R.query;n&&(l.value.id=n,M(n)),e&&(l.value.type=e,e==="ad"&&(l.value.noticeType="link"))});const M=async n=>{try{const e=await y.getNoticeDetail(n);if(e.code===0&&e.data){const o=e.data;l.value={id:o._id||o.id,type:o.type||"notice",noticeType:o.noticeType||"article",category:o.category||"",title:o.title||"",description:o.description||"",content:o.content||"",author:o.author||"管理员",imageUrl:o.imageUrl||"",linkUrl:o.linkUrl||"",buttonText:o.buttonText||"",isActive:o.isActive!==void 0?!!o.isActive:!0}}}catch(e){console.error("Fetch detail error:",e)}},F=n=>{n==="ad"&&(l.value.noticeType="link")},S=async n=>{try{const e=await y.uploadImage(n.raw);e.code===0&&(l.value.imageUrl=e.data.url,V.success("上传成功"))}catch(e){console.error("Upload error:",e)}},$=async()=>{if(!_.value)return V.warning("请输入微信链接");U.value=!0;try{const n=await y.parseWechatUrl(_.value);if(n.code===0&&n.data){const e=n.data;l.value.title=e.title||l.value.title,l.value.imageUrl=e.cover||l.value.imageUrl,l.value.linkUrl=_.value,V.success("解析成功")}}catch(n){console.error("Parse error:",n)}finally{U.value=!1}},A=async n=>{k.value&&await k.value.validate(async e=>{if(e){l.value.isActive=n,b.value=!0;try{let o;const v={...l.value};v.id?o=await y.updateNotice(v.id,v):o=await y.createNotice(v),o.code===0&&(V.success(n?"发布成功":"已存为草稿"),h.back())}catch(o){console.error("Save error:",o)}finally{b.value=!1}}})},W=()=>{h.back()};return(n,e)=>{const o=u("el-button"),v=u("el-page-header"),w=u("el-radio-button"),C=u("el-radio-group"),i=u("el-form-item"),T=u("el-radio"),m=u("el-input"),j=u("el-option"),z=u("el-select"),E=u("el-col"),H=u("el-icon"),J=u("el-upload"),L=u("el-switch"),P=u("el-row"),G=u("el-form"),K=u("el-card");return s(),x("div",ne,[a(v,{onBack:W},{content:t(()=>[f("span",ue,N(I.value),1)]),extra:t(()=>[f("div",ie,[a(o,{onClick:e[0]||(e[0]=r=>A(!1)),loading:b.value},{default:t(()=>[...e[13]||(e[13]=[d("存为草稿",-1)])]),_:1},8,["loading"]),a(o,{type:"primary",onClick:e[1]||(e[1]=r=>A(!0)),loading:b.value},{default:t(()=>[...e[14]||(e[14]=[d("发布内容",-1)])]),_:1},8,["loading"])])]),_:1}),a(K,{class:"edit-card"},{default:t(()=>[a(G,{ref_key:"formRef",ref:k,model:l.value,rules:D,"label-width":"100px",class:"edit-form"},{default:t(()=>[a(P,{gutter:20},{default:t(()=>[a(E,{span:16},{default:t(()=>[a(i,{label:"内容类型",prop:"type"},{default:t(()=>[a(C,{modelValue:l.value.type,"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.type=r),onChange:F},{default:t(()=>[a(w,{label:"article"},{default:t(()=>[...e[15]||(e[15]=[d("文章",-1)])]),_:1}),a(w,{label:"notice"},{default:t(()=>[...e[16]||(e[16]=[d("通知",-1)])]),_:1}),a(w,{label:"ad"},{default:t(()=>[...e[17]||(e[17]=[d("广告",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l.value.type!=="ad"?(s(),p(i,{key:0,label:"表现形式",prop:"noticeType"},{default:t(()=>[a(C,{modelValue:l.value.noticeType,"onUpdate:modelValue":e[3]||(e[3]=r=>l.value.noticeType=r)},{default:t(()=>[a(T,{label:"article"},{default:t(()=>[...e[18]||(e[18]=[d("富文本文章",-1)])]),_:1}),a(T,{label:"link"},{default:t(()=>[...e[19]||(e[19]=[d("跳转链接",-1)])]),_:1}),a(T,{label:"wechat"},{default:t(()=>[...e[20]||(e[20]=[d("微信链接",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):c("",!0),l.value.noticeType==="wechat"&&l.value.type!=="ad"?(s(),p(i,{key:1,label:"微信链接"},{default:t(()=>[f("div",se,[a(m,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=r=>_.value=r),placeholder:"请输入微信公众号文章链接",clearable:""},{append:t(()=>[a(o,{loading:U.value,onClick:$},{default:t(()=>[...e[21]||(e[21]=[d("解析",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"]),e[22]||(e[22]=f("div",{class:"form-tip"},"解析后将自动填充标题、封面和链接地址",-1))])]),_:1})):c("",!0),a(i,{label:"内容标题",prop:"title"},{default:t(()=>[a(m,{modelValue:l.value.title,"onUpdate:modelValue":e[5]||(e[5]=r=>l.value.title=r),placeholder:"请输入内容标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l.value.type!=="ad"?(s(),p(i,{key:2,label:"分类标签",prop:"category"},{default:t(()=>[a(z,{modelValue:l.value.category,"onUpdate:modelValue":e[6]||(e[6]=r=>l.value.category=r),placeholder:"请选择或输入分类",filterable:"","allow-create":""},{default:t(()=>[(s(),x(ee,null,le(q,r=>a(j,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):c("",!0),l.value.type==="article"?(s(),p(i,{key:3,label:"作者",prop:"author"},{default:t(()=>[a(m,{modelValue:l.value.author,"onUpdate:modelValue":e[7]||(e[7]=r=>l.value.author=r),placeholder:"请输入作者"},null,8,["modelValue"])]),_:1})):c("",!0),l.value.type!=="ad"?(s(),p(i,{key:4,label:"摘要/描述",prop:"description"},{default:t(()=>[a(m,{modelValue:l.value.description,"onUpdate:modelValue":e[8]||(e[8]=r=>l.value.description=r),type:"textarea",placeholder:"请输入摘要内容",rows:3,maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})):c("",!0),l.value.noticeType==="link"||l.value.noticeType==="wechat"||l.value.type==="ad"?(s(),p(i,{key:5,label:"跳转链接",prop:"linkUrl"},{default:t(()=>[a(m,{modelValue:l.value.linkUrl,"onUpdate:modelValue":e[9]||(e[9]=r=>l.value.linkUrl=r),placeholder:"请输入完整的跳转链接 (http:// 或 https://)"},null,8,["modelValue"])]),_:1})):c("",!0),l.value.type==="ad"?(s(),p(i,{key:6,label:"按钮文字",prop:"buttonText"},{default:t(()=>[a(m,{modelValue:l.value.buttonText,"onUpdate:modelValue":e[10]||(e[10]=r=>l.value.buttonText=r),placeholder:"默认：查看详情"},null,8,["modelValue"])]),_:1})):c("",!0),l.value.noticeType==="article"&&l.value.type!=="ad"?(s(),p(i,{key:7,label:"正文内容",prop:"content"},{default:t(()=>[a(re,{modelValue:l.value.content,"onUpdate:modelValue":e[11]||(e[11]=r=>l.value.content=r),placeholder:"请输入文章正文内容",height:400},null,8,["modelValue"])]),_:1})):c("",!0)]),_:1}),a(E,{span:8},{default:t(()=>[a(i,{label:"封面图",prop:"imageUrl"},{default:t(()=>[a(J,{class:"cover-uploader",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":S},{default:t(()=>[l.value.imageUrl?(s(),x("img",{key:0,src:l.value.imageUrl,class:"cover-preview"},null,8,de)):(s(),p(H,{key:1,class:"cover-uploader-icon"},{default:t(()=>[a(te(ae))]),_:1}))]),_:1}),e[23]||(e[23]=f("div",{class:"form-tip"},"建议比例 4:3，支持 jpg/png 格式",-1))]),_:1}),a(i,{label:"启用状态",prop:"isActive"},{default:t(()=>[a(L,{modelValue:l.value.isActive,"onUpdate:modelValue":e[12]||(e[12]=r=>l.value.isActive=r)},null,8,["modelValue"]),f("span",pe,N(l.value.isActive?"立即发布/启用":"存为草稿/禁用"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},_e=O(ce,[["__scopeId","data-v-498f1cf5"]]);export{_e as default};
