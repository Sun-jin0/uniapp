import{_ as We,i as Je,K as Xe,o as V,c as I,a as l,w as a,p as H,E as g,r as p,f as m,g as de,D as Ze,e as i,t as f,d as o,C as ke,z as Q,k as pe,P as el,m as q,V as Ve,F as ll,y as al,G as Z,aC as tl,h as me}from"./index-CYafs7gL.js";const sl={class:"image-storage-manage"},ol={class:"stats-value"},nl={class:"stats-value"},ul={class:"stats-value"},rl={class:"stats-value"},il={class:"table-header"},dl={class:"table-actions"},pl={class:"pagination-wrapper"},ml={key:0,class:"image-detail"},cl={class:"url-item"},gl={class:"url-item"},vl={key:0,class:"usage-section"},_l=["element-loading-text"],fl={class:"scan-actions mb-20"},bl={key:0,class:"scan-stats mb-10"},yl={key:0,class:"replace-info"},wl={__name:"ImageStorageManage",setup(kl){const E=m({}),ee=m(!1),N=m([]),L=m([]),d=de({keyword:"",sourceType:"",usageStatus:"",storageStatus:"",dateRange:[]}),x=de({page:1,pageSize:20,total:0}),y=m(null),ce=m(!1),j=m(!1),le=m(!1),_=de({id:null,image_name:"",source_type:"",oss_url:"",imgbb_url:"",remark:""}),A=m(!1),xe={sourceType:"other"},$=m(!1),ae=m(!1),D=m(null),te=m(null),F=m(null),Se={Authorization:"Bearer "+localStorage.getItem("admin_token")},se=m(!1),P=m(!1),oe=m(""),C=m([]),z=m([]),Y=m(""),U=m(""),T=m(""),G=m([]),ge={question:{label:"题目图片",type:"primary"},avatar:{label:"用户头像",type:"success"},banner:{label:"轮播图",type:"warning"},exam_answer:{label:"考试答题",type:"danger"},article:{label:"文章内容",type:"info"},other:{label:"其他",type:""}},ve=s=>{var e;return((e=ge[s])==null?void 0:e.label)||s||"其他"},he=s=>{var e;return((e=ge[s])==null?void 0:e.type)||""},ne=s=>{if(s===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],w=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,w)).toFixed(2))+" "+n[w]},B=async()=>{try{const s=await H.getImageStats();s.code===0&&(E.value=s.data.total)}catch(s){console.error("加载统计失败:",s)}},S=async()=>{ee.value=!0;try{const s={page:x.page,pageSize:x.pageSize,keyword:d.keyword,sourceType:d.sourceType,usageStatus:d.usageStatus};d.dateRange&&d.dateRange.length===2&&(s.startDate=d.dateRange[0],s.endDate=d.dateRange[1]);const e=await H.getImageList(s);e.code===0&&(N.value=e.data.list,x.total=e.data.total)}catch{g.error("加载图片列表失败")}finally{ee.value=!1}},_e=()=>{x.page=1,S()},Ce=()=>{d.keyword="",d.sourceType="",d.usageStatus="",d.storageStatus="",d.dateRange=[],_e()},Ue=s=>{x.pageSize=s,S()},Re=s=>{x.page=s,S()},ze=s=>{L.value=s},Be=s=>{_.id=s.id,_.image_name=s.image_name,_.source_type=s.source_type,_.oss_url=s.oss_url,_.imgbb_url=s.imgbb_url,_.remark=s.remark,j.value=!0},Ie=async()=>{le.value=!0;try{await Le(_.id,{oss_url:_.oss_url,imgbb_url:_.imgbb_url}),g.success("更新成功"),j.value=!1,S()}catch(s){g.error("更新失败: "+s.message)}finally{le.value=!1}},Le=async(s,e)=>{const n=await me.get(`/api/admin/images/${s}`,{headers:{Authorization:"Bearer "+localStorage.getItem("admin_token")}});if(n.data.code===0){const w=n.data.data.usageLog||[];for(const v of w)switch(v.usage_type){case"user_avatar":await me.put(`/api/admin/users/${v.usage_id}/avatar`,{avatar:e.oss_url||e.imgbb_url});break;case"banner":await me.put(`/api/admin/banners/${v.usage_id}`,{image_url:e.oss_url||e.imgbb_url});break;case"question":await updateQuestionImage(v.usage_id,e);break}}},$e=async s=>{try{await Z.confirm("确定要删除这张图片吗？","提示",{type:"warning"}),(await H.deleteImage(s.id)).code===0&&(g.success("删除成功"),S(),B())}catch(e){e!=="cancel"&&g.error("删除失败")}},De=async()=>{if(L.value.length!==0)try{await Z.confirm(`确定要删除选中的 ${L.value.length} 张图片吗？`,"提示",{type:"warning"});const s=L.value.map(n=>n.id),e=await tl.post("/admin/images/batch-delete",{ids:s});e.data.code===0?(g.success(e.data.message||"批量删除成功"),L.value=[],S(),B()):g.error(e.data.message||"批量删除失败")}catch(s){s!=="cancel"&&(console.error("批量删除失败:",s),g.error("批量删除失败"))}},Fe=async()=>{try{await Z.confirm("确定要清理所有未使用的图片吗？此操作不可恢复！","警告",{type:"danger"}),g.success("清理完成"),S(),B()}catch(s){s!=="cancel"&&g.error("清理失败")}},ue=s=>{navigator.clipboard.writeText(s).then(()=>{g.success("URL已复制")})},Te=s=>{s.code===0?(g.success(s.message||"图片上传成功"),A.value=!1,S(),B()):g.error(s.message||"上传失败")},Me=s=>{console.error("上传失败:",s),g.error("图片上传失败")},Oe=()=>{se.value=!0,C.value=[],z.value=[],Y.value="",U.value="",T.value="",G.value=[]},qe=s=>{const e=new Set;return s.forEach(n=>{try{const w=new URL(n.url),v=`${w.protocol}//${w.host}`;e.add(v)}catch{const v=n.url.substring(0,Math.min(50,n.url.indexOf("/",8)>0?n.url.indexOf("/",8):50));v&&e.add(v)}}),Array.from(e).sort()},Ee=async()=>{var s;P.value=!0,oe.value="正在扫描数据库中的所有图片链接...";try{const e={};Y.value&&(e.tableFilter=Y.value),U.value&&(e.urlFilter=U.value);const n=await H.scanAllImages(e);n.code===0?(C.value=((s=n.data)==null?void 0:s.images)||[],G.value=qe(C.value),fe(),g.success(`扫描完成，共发现 ${C.value.length} 个图片链接，${G.value.length} 个不同前缀`)):g.error(n.message||"扫描失败")}catch(e){console.error("扫描失败:",e),g.error("扫描失败: "+(e.message||"未知错误"))}finally{P.value=!1,oe.value=""}},fe=()=>{let s=[...C.value];if(T.value&&(s=s.filter(e=>e.url.startsWith(T.value))),U.value){const e=U.value.toLowerCase();s=s.filter(n=>n.url.toLowerCase().includes(e))}z.value=s},Ne=s=>{const e=N.value.find(n=>n.oss_url===s.url||n.imgbb_url===s.url);e?(D.value=e,F.value=null,$.value=!0):Z.confirm("该图片不在图床管理中，是否先上传到图床？","提示",{confirmButtonText:"上传",cancelButtonText:"取消",type:"warning"}).then(()=>{A.value=!0})},je=()=>{const s=z.value.map(k=>({图片URL:k.url,所在表:k.tableName,所在字段:k.fieldName})),e=Object.keys(s[0]),n=[e.join(","),...s.map(k=>e.map(b=>`"${k[b]||""}"`).join(","))].join(`
`),w=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8;"}),v=document.createElement("a");v.href=URL.createObjectURL(w),v.download=`图片链接扫描结果_${new Date().toISOString().split("T")[0]}.csv`,v.click(),g.success("导出成功")},Ae=s=>{D.value=s,F.value=null,$.value=!0},Pe=s=>{F.value=s.raw},Ye=async()=>{var s,e,n,w;if(!F.value){g.warning("请选择要上传的图片");return}ae.value=!0;try{const v=new FormData;v.append("image",F.value);const k=await H.replaceImage(D.value.id,v);if(k.code===0){const b=k.data;let u="图片替换成功";((e=(s=b.updatedReferences)==null?void 0:s.success)==null?void 0:e.length)>0&&(u+=`，已更新 ${b.updatedReferences.success.length} 处引用`),g.success(u),$.value=!1,F.value=null,te.value&&te.value.clearFiles();const h=(n=b.oss)==null?void 0:n.url,W=(w=b.imgbb)==null?void 0:w.url,c=b.filename,J=D.value.id;setTimeout(async()=>{await S(),await B();const M=`?v=${Date.now()}`;N.value=N.value.map(r=>r.id===J?{...r,oss_url:h?`${h}${M}`:r.oss_url,imgbb_url:W?`${W}${M}`:r.imgbb_url,image_name:c||r.image_name}:r)},500)}else g.error(k.message||"替换失败")}catch(v){console.error("替换失败:",v),g.error("图片替换失败: "+(v.message||"未知错误"))}finally{ae.value=!1}};return Je(()=>{B(),S()}),Xe([T,U],()=>{fe()}),(s,e)=>{const n=p("el-card"),w=p("el-col"),v=p("el-row"),k=p("el-input"),b=p("el-form-item"),u=p("el-option"),h=p("el-select"),W=p("el-date-picker"),c=p("el-button"),J=p("el-form"),M=p("el-icon"),r=p("el-table-column"),re=p("el-image"),O=p("el-tag"),ie=p("el-table"),Ge=p("el-pagination"),R=p("el-descriptions-item"),be=p("el-link"),Ke=p("el-descriptions"),K=p("el-dialog"),ye=p("el-upload"),He=p("el-alert"),Qe=p("el-empty"),we=Ze("loading");return V(),I("div",sl,[l(v,{gutter:20,class:"stats-row"},{default:a(()=>[l(w,{span:6},{default:a(()=>[l(n,{class:"stats-card"},{default:a(()=>[i("div",ol,f(E.value.total_images||0),1),e[25]||(e[25]=i("div",{class:"stats-label"},"总图片数",-1))]),_:1})]),_:1}),l(w,{span:6},{default:a(()=>[l(n,{class:"stats-card"},{default:a(()=>[i("div",nl,f(E.value.oss_success_count||0),1),e[26]||(e[26]=i("div",{class:"stats-label"},"OSS成功",-1))]),_:1})]),_:1}),l(w,{span:6},{default:a(()=>[l(n,{class:"stats-card"},{default:a(()=>[i("div",ul,f(E.value.imgbb_success_count||0),1),e[27]||(e[27]=i("div",{class:"stats-label"},"ImgBB成功",-1))]),_:1})]),_:1}),l(w,{span:6},{default:a(()=>[l(n,{class:"stats-card"},{default:a(()=>[i("div",rl,f(ne(E.value.total_size||0)),1),e[28]||(e[28]=i("div",{class:"stats-label"},"总大小",-1))]),_:1})]),_:1})]),_:1}),l(n,{class:"search-card"},{default:a(()=>[l(J,{inline:!0,model:d},{default:a(()=>[l(b,{label:"关键词"},{default:a(()=>[l(k,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>d.keyword=t),placeholder:"搜索文件名",clearable:""},null,8,["modelValue"])]),_:1}),l(b,{label:"分类"},{default:a(()=>[l(h,{modelValue:d.sourceType,"onUpdate:modelValue":e[1]||(e[1]=t=>d.sourceType=t),placeholder:"选择分类",clearable:"",style:{width:"140px"}},{default:a(()=>[l(u,{label:"题目图片",value:"question"}),l(u,{label:"用户头像",value:"avatar"}),l(u,{label:"轮播图",value:"banner"}),l(u,{label:"考试答题",value:"exam_answer"}),l(u,{label:"文章内容",value:"article"}),l(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"使用状态"},{default:a(()=>[l(h,{modelValue:d.usageStatus,"onUpdate:modelValue":e[2]||(e[2]=t=>d.usageStatus=t),placeholder:"使用状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(u,{label:"已使用",value:"used"}),l(u,{label:"未使用",value:"unused"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"图床状态"},{default:a(()=>[l(h,{modelValue:d.storageStatus,"onUpdate:modelValue":e[3]||(e[3]=t=>d.storageStatus=t),placeholder:"图床状态",clearable:"",style:{width:"130px"}},{default:a(()=>[l(u,{label:"OSS成功",value:"oss_success"}),l(u,{label:"ImgBB成功",value:"imgbb_success"}),l(u,{label:"OSS失败",value:"oss_failed"}),l(u,{label:"ImgBB失败",value:"imgbb_failed"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"上传时间"},{default:a(()=>[l(W,{modelValue:d.dateRange,"onUpdate:modelValue":e[4]||(e[4]=t=>d.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(b,null,{default:a(()=>[l(c,{type:"primary",onClick:_e},{default:a(()=>[...e[29]||(e[29]=[o("搜索",-1)])]),_:1}),l(c,{onClick:Ce},{default:a(()=>[...e[30]||(e[30]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(n,{class:"table-card"},{header:a(()=>[i("div",il,[e[36]||(e[36]=i("span",null,"图片列表",-1)),i("div",dl,[l(c,{type:"primary",onClick:e[5]||(e[5]=t=>A.value=!0)},{default:a(()=>[l(M,null,{default:a(()=>[l(pe(el))]),_:1}),e[31]||(e[31]=o(" 上传图片 ",-1))]),_:1}),l(c,{type:"danger",onClick:De,disabled:L.value.length===0},{default:a(()=>[...e[32]||(e[32]=[o(" 批量删除 ",-1)])]),_:1},8,["disabled"]),l(c,{type:"warning",onClick:Fe},{default:a(()=>[...e[33]||(e[33]=[o(" 清理未使用图片 ",-1)])]),_:1}),l(c,{type:"info",onClick:Oe},{default:a(()=>[...e[34]||(e[34]=[o(" 扫描所有图片 ",-1)])]),_:1}),l(c,{onClick:B},{default:a(()=>[...e[35]||(e[35]=[o("刷新统计",-1)])]),_:1})])])]),default:a(()=>[ke((V(),Q(ie,{data:N.value,onSelectionChange:ze,stripe:""},{default:a(()=>[l(r,{type:"selection",width:"55"}),l(r,{label:"预览",width:"100"},{default:a(({row:t})=>[l(re,{src:t.oss_url||t.imgbb_url,"preview-src-list":[t.oss_url||t.imgbb_url],fit:"cover",style:{width:"60px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])]),_:1}),l(r,{prop:"image_name",label:"文件名","min-width":"150","show-overflow-tooltip":""}),l(r,{label:"分类",width:"100"},{default:a(({row:t})=>[l(O,{type:he(t.source_type)},{default:a(()=>[o(f(ve(t.source_type)),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"大小",width:"100"},{default:a(({row:t})=>[o(f(ne(t.image_size)),1)]),_:1}),l(r,{label:"OSS状态",width:"100"},{default:a(({row:t})=>[l(O,{type:t.oss_status===1?"success":"danger",size:"small"},{default:a(()=>[o(f(t.oss_status===1?"✓ 成功":"✗ 失败"),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"ImgBB状态",width:"100"},{default:a(({row:t})=>[l(O,{type:t.imgbb_status===1?"success":"danger",size:"small"},{default:a(()=>[o(f(t.imgbb_status===1?"✓ 成功":"✗ 失败"),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"使用状态",width:"100"},{default:a(({row:t})=>[l(O,{type:t.usage_count>0?"success":"info",size:"small"},{default:a(()=>[o(f(t.usage_count>0?`已使用(${t.usage_count})`:"未使用"),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"created_at",label:"上传时间",width:"160"}),l(r,{label:"操作",width:"300",fixed:"right"},{default:a(({row:t})=>[l(c,{type:"warning",size:"small",onClick:X=>Be(t)},{default:a(()=>[...e[37]||(e[37]=[o("修改",-1)])]),_:1},8,["onClick"]),l(c,{type:"info",size:"small",onClick:X=>Ae(t)},{default:a(()=>[...e[38]||(e[38]=[o("替换",-1)])]),_:1},8,["onClick"]),l(c,{type:"danger",size:"small",onClick:X=>$e(t)},{default:a(()=>[...e[39]||(e[39]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[we,ee.value]]),i("div",pl,[l(Ge,{"current-page":x.page,"onUpdate:currentPage":e[6]||(e[6]=t=>x.page=t),"page-size":x.pageSize,"onUpdate:pageSize":e[7]||(e[7]=t=>x.pageSize=t),"page-sizes":[10,20,50,100],total:x.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ue,onCurrentChange:Re},null,8,["current-page","page-size","total"])])]),_:1}),l(K,{modelValue:ce.value,"onUpdate:modelValue":e[10]||(e[10]=t=>ce.value=t),title:"图片详情",width:"700px"},{default:a(()=>[y.value?(V(),I("div",ml,[l(re,{src:y.value.oss_url||y.value.imgbb_url,fit:"contain",style:{width:"100%","max-height":"300px","margin-bottom":"20px"}},null,8,["src"]),l(Ke,{column:2,border:""},{default:a(()=>[l(R,{label:"文件名"},{default:a(()=>[o(f(y.value.image_name),1)]),_:1}),l(R,{label:"文件类型"},{default:a(()=>[o(f(y.value.image_type),1)]),_:1}),l(R,{label:"文件大小"},{default:a(()=>[o(f(ne(y.value.image_size)),1)]),_:1}),l(R,{label:"MD5"},{default:a(()=>[o(f(y.value.image_hash),1)]),_:1}),l(R,{label:"分类"},{default:a(()=>[o(f(ve(y.value.source_type)),1)]),_:1}),l(R,{label:"上传时间"},{default:a(()=>[o(f(y.value.created_at),1)]),_:1}),l(R,{label:"OSS URL",span:2},{default:a(()=>[i("div",cl,[l(be,{type:"primary",href:y.value.oss_url,target:"_blank"},{default:a(()=>[o(f(y.value.oss_url),1)]),_:1},8,["href"]),l(c,{type:"primary",size:"small",onClick:e[8]||(e[8]=t=>ue(y.value.oss_url))},{default:a(()=>[...e[40]||(e[40]=[o("复制",-1)])]),_:1})])]),_:1}),l(R,{label:"ImgBB URL",span:2},{default:a(()=>[i("div",gl,[l(be,{type:"primary",href:y.value.imgbb_url,target:"_blank"},{default:a(()=>[o(f(y.value.imgbb_url),1)]),_:1},8,["href"]),l(c,{type:"primary",size:"small",onClick:e[9]||(e[9]=t=>ue(y.value.imgbb_url))},{default:a(()=>[...e[41]||(e[41]=[o("复制",-1)])]),_:1})])]),_:1})]),_:1}),y.value.usageLog&&y.value.usageLog.length>0?(V(),I("div",vl,[e[42]||(e[42]=i("h4",null,"使用记录",-1)),l(ie,{data:y.value.usageLog,size:"small"},{default:a(()=>[l(r,{prop:"usage_type",label:"使用类型"}),l(r,{prop:"usage_id",label:"对象ID"}),l(r,{prop:"created_at",label:"使用时间"})]),_:1},8,["data"])])):q("",!0)])):q("",!0)]),_:1},8,["modelValue"]),l(K,{modelValue:j.value,"onUpdate:modelValue":e[17]||(e[17]=t=>j.value=t),title:"修改图片信息",width:"600px"},{footer:a(()=>[l(c,{onClick:e[16]||(e[16]=t=>j.value=!1)},{default:a(()=>[...e[43]||(e[43]=[o("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:Ie,loading:le.value},{default:a(()=>[...e[44]||(e[44]=[o("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(J,{model:_,"label-width":"100px"},{default:a(()=>[l(b,{label:"文件名"},{default:a(()=>[l(k,{modelValue:_.image_name,"onUpdate:modelValue":e[11]||(e[11]=t=>_.image_name=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"分类"},{default:a(()=>[l(h,{modelValue:_.source_type,"onUpdate:modelValue":e[12]||(e[12]=t=>_.source_type=t),style:{width:"100%"}},{default:a(()=>[l(u,{label:"题目图片",value:"question"}),l(u,{label:"用户头像",value:"avatar"}),l(u,{label:"轮播图",value:"banner"}),l(u,{label:"考试答题",value:"exam_answer"}),l(u,{label:"文章内容",value:"article"}),l(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"OSS URL"},{default:a(()=>[l(k,{modelValue:_.oss_url,"onUpdate:modelValue":e[13]||(e[13]=t=>_.oss_url=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"ImgBB URL"},{default:a(()=>[l(k,{modelValue:_.imgbb_url,"onUpdate:modelValue":e[14]||(e[14]=t=>_.imgbb_url=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"备注"},{default:a(()=>[l(k,{modelValue:_.remark,"onUpdate:modelValue":e[15]||(e[15]=t=>_.remark=t),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(K,{modelValue:A.value,"onUpdate:modelValue":e[18]||(e[18]=t=>A.value=t),title:"上传图片",width:"500px"},{default:a(()=>[l(ye,{class:"upload-demo",drag:"",action:"/api/upload/image",headers:Se,data:xe,name:"image","on-success":Te,"on-error":Me,accept:"image/*",multiple:""},{tip:a(()=>[...e[45]||(e[45]=[i("div",{class:"el-upload__tip"}," 支持同时上传到OSS和ImgBB两个图床，自动去重 ",-1)])]),default:a(()=>[l(M,{class:"el-icon--upload"},{default:a(()=>[l(pe(Ve))]),_:1}),e[46]||(e[46]=i("div",{class:"el-upload__text"},[o(" 拖拽文件到此处或 "),i("em",null,"点击上传")],-1))]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:se.value,"onUpdate:modelValue":e[22]||(e[22]=t=>se.value=t),title:"扫描数据库中的所有图片链接",width:"800px"},{default:a(()=>[ke((V(),I("div",{"element-loading-text":oe.value},[l(He,{title:"此功能会扫描数据库所有表中的所有图片链接，帮助您发现模糊或需要替换的图片",type:"info",closable:!1,class:"mb-20"}),i("div",fl,[l(h,{modelValue:Y.value,"onUpdate:modelValue":e[19]||(e[19]=t=>Y.value=t),placeholder:"选择数据表",clearable:"",style:{width:"200px","margin-right":"10px"}},{default:a(()=>[l(u,{label:"computer1_question",value:"computer1_question"}),l(u,{label:"computer1_question_option",value:"computer1_question_option"}),l(u,{label:"computer1_question_sub",value:"computer1_question_sub"}),l(u,{label:"math_questiondetails",value:"math_questiondetails"}),l(u,{label:"math_knowledgepoints",value:"math_knowledgepoints"})]),_:1},8,["modelValue"]),G.value.length>0?(V(),Q(h,{key:0,modelValue:T.value,"onUpdate:modelValue":e[20]||(e[20]=t=>T.value=t),placeholder:"选择URL前缀",clearable:"",style:{width:"250px","margin-right":"10px"}},{default:a(()=>[(V(!0),I(ll,null,al(G.value,t=>(V(),Q(u,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0),l(k,{modelValue:U.value,"onUpdate:modelValue":e[21]||(e[21]=t=>U.value=t),placeholder:"筛选图片URL关键词...",clearable:"",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue"]),l(c,{type:"primary",onClick:Ee,loading:P.value},{default:a(()=>[...e[47]||(e[47]=[o(" 开始扫描 ",-1)])]),_:1},8,["loading"]),l(c,{onClick:je,disabled:z.value.length===0},{default:a(()=>[...e[48]||(e[48]=[o(" 导出结果 ",-1)])]),_:1},8,["disabled"])]),C.value.length>0?(V(),I("div",bl,[l(O,{type:"success"},{default:a(()=>[o("共发现 "+f(C.value.length)+" 个图片链接",1)]),_:1}),l(O,{type:"info",class:"ml-10"},{default:a(()=>[o("显示 "+f(z.value.length)+" 个",1)]),_:1})])):q("",!0),z.value.length>0?(V(),Q(ie,{key:1,data:z.value,border:"",stripe:"",height:"400"},{default:a(()=>[l(r,{label:"预览",width:"80"},{default:a(({row:t})=>[l(re,{src:t.url,fit:"cover",style:{width:"50px",height:"50px","border-radius":"4px"},"preview-src-list":[t.url]},null,8,["src","preview-src-list"])]),_:1}),l(r,{prop:"url",label:"图片URL","min-width":"250","show-overflow-tooltip":""}),l(r,{prop:"tableName",label:"所在表",width:"120"}),l(r,{prop:"fieldName",label:"所在字段",width:"120"}),l(r,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(c,{type:"primary",size:"small",onClick:X=>Ne(t)},{default:a(()=>[...e[49]||(e[49]=[o("替换",-1)])]),_:1},8,["onClick"]),l(c,{type:"success",size:"small",onClick:X=>ue(t.url)},{default:a(()=>[...e[50]||(e[50]=[o("复制",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):!P.value&&C.value.length===0?(V(),Q(Qe,{key:2,description:"点击「开始扫描」按钮开始扫描数据库中的图片链接"})):q("",!0)],8,_l)),[[we,P.value]])]),_:1},8,["modelValue"]),l(K,{modelValue:$.value,"onUpdate:modelValue":e[24]||(e[24]=t=>$.value=t),title:"替换图片",width:"500px"},{footer:a(()=>[l(c,{onClick:e[23]||(e[23]=t=>$.value=!1)},{default:a(()=>[...e[55]||(e[55]=[o("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:Ye,loading:ae.value},{default:a(()=>[...e[56]||(e[56]=[o("确认替换",-1)])]),_:1},8,["loading"])]),default:a(()=>[D.value?(V(),I("div",yl,[i("p",null,[e[51]||(e[51]=o("正在替换: ",-1)),i("strong",null,f(D.value.image_name),1)]),e[52]||(e[52]=i("p",{class:"replace-tip"},"上传新图片将替换原图片，所有引用链接将自动更新",-1))])):q("",!0),l(ye,{ref_key:"replaceUploadRef",ref:te,class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":Pe,accept:"image/*"},{tip:a(()=>[...e[53]||(e[53]=[i("div",{class:"el-upload__tip"}," 支持 jpg/png/gif/webp 格式，单个文件不超过5MB ",-1)])]),default:a(()=>[l(M,{class:"el-icon--upload"},{default:a(()=>[l(pe(Ve))]),_:1}),e[54]||(e[54]=i("div",{class:"el-upload__text"},[o(" 拖拽文件到此处或 "),i("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"])])}}},xl=We(wl,[["__scopeId","data-v-fbb1dc4a"]]);export{xl as default};
