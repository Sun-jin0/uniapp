import{_ as gl,g as F,K as bl,i as wl,o as _,c as q,a as l,w as t,p as y,E as i,f as c,r as f,u as _l,D as Vl,e as k,b as Fe,k as I,O as _e,J as te,d as s,P as Cl,a6 as kl,C as Ve,z,t as Ce,F as je,y as $e,a7 as Tl,G as ae,q as xl}from"./index-1rGkZLYp.js";const Ul={class:"tutorial-manage"},Il={class:"tab-content"},Ml={class:"filter-card mb-20"},zl={class:"action-buttons"},Sl={class:"tab-content"},Dl={class:"card-header"},Fl={class:"filter-bar mb-20"},jl={key:1,class:"no-cover"},$l={key:0},hl={key:1,class:"text-gray"},ql={class:"pagination-container"},Nl=["src"],Ll={class:"subjects-manage"},Rl={class:"toolbar mb-20"},El={class:"available-tutorials"},Bl={class:"toolbar mb-20"},Yl="/api/upload/image",Pl={__name:"TutorialManage",setup(Al){const ke=_l(),oe=c("tutorials"),ne=c(!1),B=c([]),H=F({keyword:""}),x=async()=>{var o;ne.value=!0;try{const e=await y.getTutorials();B.value=((o=e.data)==null?void 0:o.list)||[],H.keyword&&(B.value=B.value.filter(n=>n.name.toLowerCase().includes(H.keyword.toLowerCase())))}catch(e){console.error("获取教辅列表失败:",e),i.error("获取教辅列表失败")}finally{ne.value=!1}},Y=c(!1),re=c(!1),V=F({name:"",version:"",year:new Date().getFullYear(),description:""}),he=()=>{V.name="",V.version="",V.year=new Date().getFullYear(),V.description="",Y.value=!0},qe=async()=>{if(!V.name.trim()){i.warning("请输入教辅名称");return}re.value=!0;try{await y.createTutorial(V),i.success("创建成功"),Y.value=!1,x()}catch(o){console.error("创建教辅失败:",o),i.error("创建教辅失败")}finally{re.value=!1}},N=c(!1),ie=c(!1),d=F({id:null,name:"",version:"",year:new Date().getFullYear(),description:"",status:1}),Ne=o=>{d.id=o.id,d.name=o.name,d.version=o.version,d.year=o.year||new Date().getFullYear(),d.description=o.description||"",d.status=o.status||1,N.value=!0},Le=async()=>{if(!d.name.trim()){i.warning("请输入教辅名称");return}ie.value=!0;try{await y.updateTutorial(d.id,{name:d.name,version:d.version,year:d.year,description:d.description,status:d.status}),i.success("更新成功"),N.value=!1,x()}catch(o){console.error("更新教辅失败:",o),i.error("更新教辅失败")}finally{ie.value=!1}},Re=async o=>{try{await y.updateTutorial(d.id,{status:o}),i.success(o===1?"已启用":"已禁用");const e=B.value.find(n=>n.id===d.id);e&&(e.status=o)}catch(e){console.error("更新状态失败:",e),i.error("更新状态失败"),d.status=o===1?0:1}},Ee=async()=>{try{await ae.confirm("确定要删除该教辅吗？这将同时删除相关章节和题目关联。","警告",{type:"warning"}),await y.deleteTutorial(d.id),i.success("删除成功"),N.value=!1,x()}catch(o){o!=="cancel"&&(console.error("删除失败:",o),i.error("删除失败"))}},P=c(!1),se=c(!1),g=F({sourceId:null,sourceName:"",name:"",version:"",year:new Date().getFullYear()}),Be=o=>{g.sourceId=o.id,g.sourceName=o.name,g.name=o.name+" (复制)",g.version=o.version,g.year=o.year||new Date().getFullYear(),P.value=!0},Ye=async()=>{var o,e;if(!g.name.trim()){i.warning("请输入新教辅名称");return}se.value=!0;try{const r=(o=(await y.createTutorial({name:g.name.trim(),version:g.version.trim(),year:g.year,description:`从 ${g.sourceName} 复制`,status:1})).data)==null?void 0:o.id,G=((e=(await y.getTutorialDetail(g.sourceId)).data)==null?void 0:e.chapters)||[],u=(await y.getTutorialQuestions(g.sourceId)).data||[];if(G.length>0&&r){const K={},j=async($,U=0)=>{var D;for(const T of $)try{const ee=(D=(await y.createTutorialChapter(r,{name:T.name,parent_id:U,level:T.level,sort_order:T.sort_order})).data)==null?void 0:D.id;K[T.id]=ee,T.children&&T.children.length>0&&await j(T.children,ee)}catch(E){throw console.error("创建章节失败:",E),E}};if(await j(G),u&&u.length>0){let $=0;for(const U of u){const D=K[U.chapter_id];if(D)try{await y.addTutorialQuestion({tutorial_id:r,chapter_id:D,question_id:U.question_id,sort_order:U.sort_order}),$++}catch(T){console.error("复制题目关联失败:",T)}}console.log(`复制了 ${$} 个题目关联`)}}i.success("复制教辅成功"),P.value=!1,x()}catch(n){console.error("复制教辅失败:",n),i.error("复制教辅失败")}finally{se.value=!1}},Pe=o=>{ke.push(`/computer/tutorials/${o.id}/chapters`)},A=c(!1),v=F({importMode:"collection",collectionName:"",collectionId:null,version:"",year:"",data:null}),Te=c([]),ue=c(!1),Ae=xl(()=>v.importMode==="collection"?!!v.collectionName.trim():!!v.collectionId),Je=()=>{v.importMode="collection",v.collectionName="",v.collectionId=null,v.version="",v.year="",Te.value=[],A.value=!0},Ge=o=>{const e=new FileReader;e.onload=n=>{try{const r=JSON.parse(n.target.result);v.data=r,i.success("文件读取成功")}catch{i.error("JSON 格式错误")}},e.readAsText(o.raw)},Ke=async()=>{if(!v.data){i.warning("请先选择数据文件");return}ue.value=!0;try{await y.importTutorial(v),i.success("导入成功"),A.value=!1,x(),C()}catch(o){console.error("导入失败:",o),i.error("导入失败")}finally{ue.value=!1}},Oe=async()=>{var o,e;try{await ae.confirm(`确定要重置教辅ID吗？这将把所有教辅相关表的自增ID重置为1。

注意：此操作需要删除所有教辅、章节、题目关联和合集数据后才能执行！`,"警告",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}),await y.resetTutorialIds(),i.success("ID重置成功，新记录将从1开始编号"),x(),C()}catch(n){n!=="cancel"&&(console.error("重置ID失败:",n),i.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||"重置ID失败"))}},de=c(!1),pe=c([]),S=F({keyword:"",status:""}),M=F({page:1,pageSize:10,total:0}),C=async()=>{var o,e;de.value=!0;try{const n=await y.getTutorialCollections({keyword:S.keyword,status:S.status,page:M.page,pageSize:M.pageSize});pe.value=((o=n.data)==null?void 0:o.list)||[],M.total=((e=n.data)==null?void 0:e.total)||0}catch(n){console.error("获取合集列表失败:",n),i.error("获取合集列表失败")}finally{de.value=!1}},Qe=()=>{S.keyword="",S.status="",M.page=1,C()},L=c(!1),W=c(!1),ce=c(null),me=c(!1),p=F({id:null,name:"",version:"",year:new Date().getFullYear(),cover_url:"",description:"",sort_order:0,status:1}),He={name:[{required:!0,message:"请输入合集名称",trigger:"blur"}],version:[{required:!0,message:"请输入版本",trigger:"blur"}]},We={Authorization:`Bearer ${localStorage.getItem("admin_token")}`},Xe=()=>{W.value=!1,p.id=null,p.name="",p.version="",p.year=new Date().getFullYear(),p.cover_url="",p.description="",p.sort_order=0,p.status=1,L.value=!0},Ze=o=>{W.value=!0,Object.assign(p,o),L.value=!0},el=async()=>{ce.value&&await ce.value.validate(async o=>{if(o){me.value=!0;try{W.value?(await y.updateTutorialCollection(p.id,p),i.success("更新成功")):(await y.createTutorialCollection(p),i.success("创建成功")),L.value=!1,C()}catch(e){console.error("保存合集失败:",e),i.error("保存合集失败")}finally{me.value=!1}}})},ll=async(o,e)=>{try{await y.updateTutorialCollection(o.id,{status:e}),i.success("状态更新成功")}catch(n){console.error("更新状态失败:",n),i.error("更新状态失败"),o.status=e===1?0:1}},tl=async o=>{try{await ae.confirm("确定要删除该合集吗？","警告",{type:"warning"}),await y.deleteTutorialCollection(o.id),i.success("删除成功"),C()}catch(e){e!=="cancel"&&(console.error("删除合集失败:",e),i.error("删除合集失败"))}},al=o=>{const e=o.type==="image/jpeg",n=o.type==="image/png",r=o.size/1024/1024<2;return!e&&!n?(i.error("只支持 JPG/PNG 格式!"),!1):r?!0:(i.error("图片大小不能超过 2MB!"),!1)},ol=o=>{o.code===0||o.code===200?(p.cover_url=o.data.url,i.success("上传成功")):i.error(o.message||"上传失败")},fe=c(!1),X=c(null),ve=c([]),nl=async o=>{X.value=o,fe.value=!0,await xe(o.id)},xe=async o=>{var e;try{const n=await y.getTutorialCollectionDetail(o);ve.value=((e=n.data)==null?void 0:e.subjects)||[]}catch(n){console.error("获取科目列表失败:",n),i.error("获取科目列表失败")}},ye=c(!1),R=c([]),Z=c([]),J=c(""),ge=c(!1),be=c(null),rl=async()=>{J.value="",ye.value=!0,await Ue()},Ue=async()=>{var o;ge.value=!0;try{const e=await y.getTutorials({noCollection:!0,page:1,pageSize:100});R.value=((o=e.data)==null?void 0:o.list)||[],Z.value=[...R.value]}catch(e){console.error("加载教辅列表失败:",e),i.error("加载教辅列表失败")}finally{ge.value=!1}},il=async()=>{J.value="",await Ue()},Ie=()=>{const o=J.value.toLowerCase();if(!o){Z.value=[...R.value];return}Z.value=R.value.filter(e=>e.name.toLowerCase().includes(o)||e.subject&&e.subject.toLowerCase().includes(o))},sl=async o=>{be.value=o.id;try{await y.updateTutorial(o.id,{collection_id:X.value.id}),i.success("添加成功");const e=R.value.findIndex(n=>n.id===o.id);e>-1&&(R.value.splice(e,1),Ie()),await xe(X.value.id),C()}catch(e){console.error("添加科目失败:",e),i.error("添加科目失败")}finally{be.value=null}},ul=async(o,e)=>{try{await ae.confirm("确定要将该教辅从合集中移除吗？","提示",{type:"warning"}),await y.updateTutorial(o.id,{collection_id:null}),i.success("移除成功"),ve.value.splice(e,1),C()}catch(n){n!=="cancel"&&(console.error("移除科目失败:",n),i.error("移除科目失败"))}},dl=o=>{ke.push(`/computer/tutorials/${o.id}/chapters`)},pl=o=>o?new Date(o).toLocaleString():"-";return bl(oe,o=>{o==="tutorials"?x():o==="collections"&&C()}),wl(()=>{x()}),(o,e)=>{var De;const n=f("el-icon"),r=f("el-button"),b=f("el-input"),G=f("el-col"),Me=f("el-row"),u=f("el-table-column"),K=f("el-tag"),j=f("el-table"),$=f("el-tab-pane"),U=f("el-option"),D=f("el-select"),T=f("el-image"),E=f("el-switch"),ee=f("el-pagination"),cl=f("el-card"),ml=f("el-tabs"),m=f("el-form-item"),O=f("el-input-number"),ze=f("el-upload"),le=f("el-radio"),Se=f("el-radio-group"),Q=f("el-form"),h=f("el-dialog"),fl=f("el-divider"),vl=f("el-alert"),we=Vl("loading");return _(),q("div",Ul,[l(ml,{modelValue:oe.value,"onUpdate:modelValue":e[5]||(e[5]=a=>oe.value=a),type:"border-card"},{default:t(()=>[l($,{label:"教辅管理",name:"tutorials"},{default:t(()=>[k("div",Il,[k("div",Ml,[l(Me,{gutter:20,align:"middle"},{default:t(()=>[l(G,{span:6},{default:t(()=>[l(b,{modelValue:H.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>H.keyword=a),placeholder:"搜索教辅名称...",clearable:"",onKeyup:Fe(x,["enter"])},{append:t(()=>[l(r,{onClick:x},{default:t(()=>[l(n,null,{default:t(()=>[l(I(_e))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(G,{span:18,style:{"text-align":"right"}},{default:t(()=>[l(r,{type:"success",onClick:he},{default:t(()=>[l(n,null,{default:t(()=>[l(I(te))]),_:1}),e[42]||(e[42]=s(" 创建教辅 ",-1))]),_:1}),l(r,{type:"primary",onClick:Je},{default:t(()=>[l(n,null,{default:t(()=>[l(I(Cl))]),_:1}),e[43]||(e[43]=s(" 导入教辅 ",-1))]),_:1}),l(r,{type:"danger",plain:"",onClick:Oe},{default:t(()=>[l(n,null,{default:t(()=>[l(I(kl))]),_:1}),e[44]||(e[44]=s(" 重置ID ",-1))]),_:1})]),_:1})]),_:1})]),Ve((_(),z(j,{data:B.value,border:"",stripe:""},{default:t(()=>[l(u,{prop:"id",label:"ID",width:"80",align:"center"}),l(u,{prop:"name",label:"教辅名称","min-width":"200"}),l(u,{prop:"version",label:"版本",width:"100",align:"center"}),l(u,{prop:"year",label:"年份",width:"80",align:"center"}),l(u,{prop:"total_questions",label:"题目数",width:"100",align:"center"}),l(u,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[l(K,{type:a.status===1?"success":"info"},{default:t(()=>[s(Ce(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"created_at",label:"创建时间",width:"160",align:"center"},{default:t(({row:a})=>[s(Ce(pl(a.created_at)),1)]),_:1}),l(u,{label:"操作",width:"200",align:"center",fixed:"right"},{default:t(({row:a})=>[k("div",zl,[l(r,{size:"small",type:"primary",onClick:w=>Pe(a)},{default:t(()=>[...e[45]||(e[45]=[s("章节",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"success",onClick:w=>Ne(a)},{default:t(()=>[...e[46]||(e[46]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"info",onClick:w=>Be(a)},{default:t(()=>[...e[47]||(e[47]=[s("复制",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[we,ne.value]])])]),_:1}),l($,{label:"合集管理",name:"collections"},{default:t(()=>[k("div",Sl,[l(cl,null,{header:t(()=>[k("div",Dl,[e[49]||(e[49]=k("h3",null,"教辅合集管理",-1)),l(r,{type:"primary",onClick:Xe},{default:t(()=>[l(n,null,{default:t(()=>[l(I(te))]),_:1}),e[48]||(e[48]=s(" 创建合集 ",-1))]),_:1})])]),default:t(()=>[k("div",Fl,[l(b,{modelValue:S.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>S.keyword=a),placeholder:"搜索合集名称",clearable:"",style:{width:"250px"},onKeyup:Fe(C,["enter"])},{prefix:t(()=>[l(n,null,{default:t(()=>[l(I(_e))]),_:1})]),_:1},8,["modelValue"]),l(D,{modelValue:S.status,"onUpdate:modelValue":e[2]||(e[2]=a=>S.status=a),placeholder:"状态",clearable:"",style:{width:"120px"},onChange:C},{default:t(()=>[l(U,{label:"全部",value:""}),l(U,{label:"启用",value:1}),l(U,{label:"禁用",value:0})]),_:1},8,["modelValue"]),l(r,{type:"primary",onClick:C},{default:t(()=>[...e[50]||(e[50]=[s("搜索",-1)])]),_:1}),l(r,{onClick:Qe},{default:t(()=>[...e[51]||(e[51]=[s("重置",-1)])]),_:1})]),Ve((_(),z(j,{data:pe.value,border:"",stripe:""},{default:t(()=>[l(u,{type:"index",label:"序号",width:"60",align:"center"}),l(u,{label:"封面",width:"100",align:"center"},{default:t(({row:a})=>[a.cover_url?(_(),z(T,{key:0,src:a.cover_url,style:{width:"60px",height:"80px","object-fit":"cover"},fit:"cover"},null,8,["src"])):(_(),q("div",jl,"无封面"))]),_:1}),l(u,{prop:"name",label:"合集名称","min-width":"150"}),l(u,{prop:"version",label:"版本",width:"100",align:"center"}),l(u,{prop:"year",label:"年份",width:"80",align:"center"}),l(u,{label:"包含科目","min-width":"200"},{default:t(({row:a})=>[a.subjects&&a.subjects.length>0?(_(),q("div",$l,[(_(!0),q(je,null,$e(a.subjects,w=>(_(),z(K,{key:w.id,size:"small",class:"mr-5 mb-5"},{default:t(()=>[s(Ce(w.subject||w.name),1)]),_:2},1024))),128))])):(_(),q("span",hl,"暂无科目"))]),_:1}),l(u,{prop:"total_questions",label:"总题数",width:"100",align:"center"}),l(u,{label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[l(E,{modelValue:a.status,"onUpdate:modelValue":w=>a.status=w,"active-value":1,"inactive-value":0,onChange:w=>ll(a,w)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(u,{label:"操作",width:"250",fixed:"right"},{default:t(({row:a})=>[l(r,{type:"primary",link:"",size:"small",onClick:w=>Ze(a)},{default:t(()=>[...e[52]||(e[52]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(r,{type:"success",link:"",size:"small",onClick:w=>nl(a)},{default:t(()=>[...e[53]||(e[53]=[s(" 管理科目 ",-1)])]),_:1},8,["onClick"]),l(r,{type:"danger",link:"",size:"small",onClick:w=>tl(a)},{default:t(()=>[...e[54]||(e[54]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[we,de.value]]),k("div",ql,[l(ee,{"current-page":M.page,"onUpdate:currentPage":e[3]||(e[3]=a=>M.page=a),"page-size":M.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>M.pageSize=a),total:M.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:C,onCurrentChange:C},null,8,["current-page","page-size","total"])])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),l(h,{modelValue:L.value,"onUpdate:modelValue":e[13]||(e[13]=a=>L.value=a),title:W.value?"编辑合集":"创建合集",width:"600px"},{footer:t(()=>[l(r,{onClick:e[12]||(e[12]=a=>L.value=!1)},{default:t(()=>[...e[57]||(e[57]=[s("取消",-1)])]),_:1}),l(r,{type:"primary",loading:me.value,onClick:el},{default:t(()=>[...e[58]||(e[58]=[s("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Q,{model:p,rules:He,ref_key:"collectionFormRef",ref:ce,"label-width":"100px"},{default:t(()=>[l(m,{label:"合集名称",prop:"name"},{default:t(()=>[l(b,{modelValue:p.name,"onUpdate:modelValue":e[6]||(e[6]=a=>p.name=a),placeholder:"如：王道考研"},null,8,["modelValue"])]),_:1}),l(m,{label:"版本",prop:"version"},{default:t(()=>[l(b,{modelValue:p.version,"onUpdate:modelValue":e[7]||(e[7]=a=>p.version=a),placeholder:"如：2026版"},null,8,["modelValue"])]),_:1}),l(m,{label:"年份",prop:"year"},{default:t(()=>[l(O,{modelValue:p.year,"onUpdate:modelValue":e[8]||(e[8]=a=>p.year=a),min:2e3,max:2100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"封面图"},{default:t(()=>[l(ze,{class:"cover-uploader",action:Yl,headers:We,"show-file-list":!1,"on-success":ol,"before-upload":al},{default:t(()=>[p.cover_url?(_(),q("img",{key:0,src:p.cover_url,class:"cover-image"},null,8,Nl)):(_(),z(n,{key:1,class:"cover-uploader-icon"},{default:t(()=>[l(I(te))]),_:1}))]),_:1})]),_:1}),l(m,{label:"描述"},{default:t(()=>[l(b,{modelValue:p.description,"onUpdate:modelValue":e[9]||(e[9]=a=>p.description=a),type:"textarea",rows:3,placeholder:"请输入合集描述"},null,8,["modelValue"])]),_:1}),l(m,{label:"排序"},{default:t(()=>[l(O,{modelValue:p.sort_order,"onUpdate:modelValue":e[10]||(e[10]=a=>p.sort_order=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"状态"},{default:t(()=>[l(Se,{modelValue:p.status,"onUpdate:modelValue":e[11]||(e[11]=a=>p.status=a)},{default:t(()=>[l(le,{label:1},{default:t(()=>[...e[55]||(e[55]=[s("启用",-1)])]),_:1}),l(le,{label:0},{default:t(()=>[...e[56]||(e[56]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(h,{modelValue:fe.value,"onUpdate:modelValue":e[14]||(e[14]=a=>fe.value=a),title:(((De=X.value)==null?void 0:De.name)||"合集")+" - 管理科目",width:"800px"},{default:t(()=>[k("div",Ll,[k("div",Rl,[l(r,{type:"primary",size:"small",onClick:rl},{default:t(()=>[l(n,null,{default:t(()=>[l(I(te))]),_:1}),e[59]||(e[59]=s(" 添加科目 ",-1))]),_:1})]),l(j,{data:ve.value,border:"",stripe:""},{default:t(()=>[l(u,{type:"index",label:"序号",width:"60",align:"center"}),l(u,{prop:"name",label:"教辅名称","min-width":"150"}),l(u,{prop:"subject",label:"科目",width:"120",align:"center"}),l(u,{prop:"total_questions",label:"题目数",width:"100",align:"center"}),l(u,{label:"操作",width:"150",align:"center"},{default:t(({row:a,$index:w})=>[l(r,{type:"primary",link:"",size:"small",onClick:yl=>dl(a)},{default:t(()=>[...e[60]||(e[60]=[s(" 查看 ",-1)])]),_:1},8,["onClick"]),l(r,{type:"danger",link:"",size:"small",onClick:yl=>ul(a,w)},{default:t(()=>[...e[61]||(e[61]=[s(" 移除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue","title"]),l(h,{modelValue:ye.value,"onUpdate:modelValue":e[16]||(e[16]=a=>ye.value=a),title:"添加科目到合集",width:"700px"},{default:t(()=>[k("div",El,[k("div",Bl,[l(b,{modelValue:J.value,"onUpdate:modelValue":e[15]||(e[15]=a=>J.value=a),placeholder:"搜索教辅名称",clearable:"",style:{width:"250px"},onInput:Ie},{prefix:t(()=>[l(n,null,{default:t(()=>[l(I(_e))]),_:1})]),_:1},8,["modelValue"]),l(r,{type:"primary",size:"small",onClick:il},{default:t(()=>[...e[62]||(e[62]=[s("刷新",-1)])]),_:1})]),Ve((_(),z(j,{data:Z.value,border:"",stripe:"","max-height":"400"},{default:t(()=>[l(u,{type:"index",label:"序号",width:"60",align:"center"}),l(u,{prop:"name",label:"教辅名称","min-width":"150"}),l(u,{prop:"subject",label:"科目",width:"120",align:"center"}),l(u,{prop:"total_questions",label:"题目数",width:"100",align:"center"}),l(u,{label:"操作",width:"100",align:"center",fixed:"right"},{default:t(({row:a})=>[l(r,{type:"primary",size:"small",loading:be.value===a.id,onClick:w=>sl(a)},{default:t(()=>[...e[63]||(e[63]=[s(" 添加 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[we,ge.value]])])]),_:1},8,["modelValue"]),l(h,{modelValue:Y.value,"onUpdate:modelValue":e[22]||(e[22]=a=>Y.value=a),title:"创建新教辅",width:"500px"},{footer:t(()=>[l(r,{onClick:e[21]||(e[21]=a=>Y.value=!1)},{default:t(()=>[...e[64]||(e[64]=[s("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:qe,loading:re.value},{default:t(()=>[...e[65]||(e[65]=[s("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Q,{model:V,"label-width":"100px"},{default:t(()=>[l(m,{label:"教辅名称",required:""},{default:t(()=>[l(b,{modelValue:V.name,"onUpdate:modelValue":e[17]||(e[17]=a=>V.name=a),placeholder:"请输入教辅名称，如：王道考研数据结构"},null,8,["modelValue"])]),_:1}),l(m,{label:"版本"},{default:t(()=>[l(b,{modelValue:V.version,"onUpdate:modelValue":e[18]||(e[18]=a=>V.version=a),placeholder:"如：2026版"},null,8,["modelValue"])]),_:1}),l(m,{label:"年份"},{default:t(()=>[l(O,{modelValue:V.year,"onUpdate:modelValue":e[19]||(e[19]=a=>V.year=a),min:2e3,max:2100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"描述"},{default:t(()=>[l(b,{modelValue:V.description,"onUpdate:modelValue":e[20]||(e[20]=a=>V.description=a),type:"textarea",rows:3,placeholder:"请输入教辅描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(h,{modelValue:N.value,"onUpdate:modelValue":e[29]||(e[29]=a=>N.value=a),title:"编辑教辅",width:"500px"},{footer:t(()=>[l(r,{type:"danger",plain:"",onClick:Ee},{default:t(()=>[...e[66]||(e[66]=[s("删除教辅",-1)])]),_:1}),l(r,{onClick:e[28]||(e[28]=a=>N.value=!1)},{default:t(()=>[...e[67]||(e[67]=[s("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Le,loading:ie.value},{default:t(()=>[...e[68]||(e[68]=[s("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Q,{model:d,"label-width":"100px"},{default:t(()=>[l(m,{label:"教辅名称",required:""},{default:t(()=>[l(b,{modelValue:d.name,"onUpdate:modelValue":e[23]||(e[23]=a=>d.name=a),placeholder:"请输入教辅名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"版本"},{default:t(()=>[l(b,{modelValue:d.version,"onUpdate:modelValue":e[24]||(e[24]=a=>d.version=a),placeholder:"如：2026版"},null,8,["modelValue"])]),_:1}),l(m,{label:"年份"},{default:t(()=>[l(O,{modelValue:d.year,"onUpdate:modelValue":e[25]||(e[25]=a=>d.year=a),min:2e3,max:2100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"描述"},{default:t(()=>[l(b,{modelValue:d.description,"onUpdate:modelValue":e[26]||(e[26]=a=>d.description=a),type:"textarea",rows:3,placeholder:"请输入教辅描述"},null,8,["modelValue"])]),_:1}),l(fl),l(m,{label:"状态"},{default:t(()=>[l(E,{modelValue:d.status,"onUpdate:modelValue":e[27]||(e[27]=a=>d.status=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用",onChange:Re},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(h,{modelValue:P.value,"onUpdate:modelValue":e[34]||(e[34]=a=>P.value=a),title:"复制教辅",width:"500px"},{footer:t(()=>[l(r,{onClick:e[33]||(e[33]=a=>P.value=!1)},{default:t(()=>[...e[69]||(e[69]=[s("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Ye,loading:se.value},{default:t(()=>[...e[70]||(e[70]=[s("复制",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(vl,{title:"复制说明",description:"复制将创建一个新的教辅，包含原教辅的所有章节结构，但不会复制题目内容。您可以在新教辅中重新添加或导入题目。",type:"info",closable:!1,style:{"margin-bottom":"20px"}}),l(Q,{model:g,"label-width":"100px"},{default:t(()=>[l(m,{label:"原教辅"},{default:t(()=>[l(b,{value:g.sourceName,disabled:""},null,8,["value"])]),_:1}),l(m,{label:"新教辅名称",required:""},{default:t(()=>[l(b,{modelValue:g.name,"onUpdate:modelValue":e[30]||(e[30]=a=>g.name=a),placeholder:"请输入新教辅名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"版本"},{default:t(()=>[l(b,{modelValue:g.version,"onUpdate:modelValue":e[31]||(e[31]=a=>g.version=a),placeholder:"如：2027版"},null,8,["modelValue"])]),_:1}),l(m,{label:"年份"},{default:t(()=>[l(O,{modelValue:g.year,"onUpdate:modelValue":e[32]||(e[32]=a=>g.year=a),min:2e3,max:2100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(h,{modelValue:A.value,"onUpdate:modelValue":e[41]||(e[41]=a=>A.value=a),title:"导入教辅数据",width:"700px","close-on-click-modal":!1},{footer:t(()=>[l(r,{onClick:e[40]||(e[40]=a=>A.value=!1)},{default:t(()=>[...e[75]||(e[75]=[s("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Ke,loading:ue.value,disabled:!Ae.value},{default:t(()=>[...e[76]||(e[76]=[s(" 开始导入 ",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[l(Q,{model:v,"label-width":"100px"},{default:t(()=>[l(m,{label:"导入方式"},{default:t(()=>[l(Se,{modelValue:v.importMode,"onUpdate:modelValue":e[35]||(e[35]=a=>v.importMode=a)},{default:t(()=>[l(le,{label:"collection"},{default:t(()=>[...e[71]||(e[71]=[s("创建新合集",-1)])]),_:1}),l(le,{label:"tutorial"},{default:t(()=>[...e[72]||(e[72]=[s("导入到现有合集",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),v.importMode==="collection"?(_(),z(m,{key:0,label:"合集名称",required:""},{default:t(()=>[l(b,{modelValue:v.collectionName,"onUpdate:modelValue":e[36]||(e[36]=a=>v.collectionName=a),placeholder:"如：王道考研",style:{width:"300px"}},null,8,["modelValue"])]),_:1})):(_(),z(m,{key:1,label:"选择合集",required:""},{default:t(()=>[l(D,{modelValue:v.collectionId,"onUpdate:modelValue":e[37]||(e[37]=a=>v.collectionId=a),placeholder:"请选择合集",style:{width:"300px"}},{default:t(()=>[(_(!0),q(je,null,$e(pe.value,a=>(_(),z(U,{key:a.id,label:a.name+" "+a.version,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(r,{type:"primary",link:"",onClick:C,style:{"margin-left":"10px"}},{default:t(()=>[l(n,null,{default:t(()=>[l(I(Tl))]),_:1}),e[73]||(e[73]=s(" 刷新 ",-1))]),_:1})]),_:1})),l(m,{label:"版本"},{default:t(()=>[l(b,{modelValue:v.version,"onUpdate:modelValue":e[38]||(e[38]=a=>v.version=a),placeholder:"如：25版、26版",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"年份"},{default:t(()=>[l(b,{modelValue:v.year,"onUpdate:modelValue":e[39]||(e[39]=a=>v.year=a),placeholder:"如：2025",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"数据文件"},{default:t(()=>[l(ze,{action:"#","auto-upload":!1,"on-change":Ge,accept:".json",limit:1,"file-list":Te.value},{default:t(()=>[l(r,{type:"primary"},{default:t(()=>[...e[74]||(e[74]=[s("选择JSON文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Gl=gl(Pl,[["__scopeId","data-v-53671441"]]);export{Gl as default};
