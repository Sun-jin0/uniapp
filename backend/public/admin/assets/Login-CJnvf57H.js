import{_ as x,o as V,c as b,a as o,w as a,r as n,u as h,b as k,d as L,e as g,f as w,g as R,h as B,E as i}from"./index-1rGkZLYp.js";const C={class:"login-container"},E={__name:"Login",setup(F){const v=h(),c=w(null),d=w(!1),r=R({username:"",password:""}),y={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f=async()=>{c.value&&await c.value.validate(async _=>{var e,t;if(_){d.value=!0;try{const l=(await B.post("/api/user/login",r)).data;if(l.code===0||l.code===200){const{token:p,role:u}=l.data;if(u===0){i.error("权限不足，非管理员账号"),d.value=!1;return}localStorage.setItem("admin_token",p),localStorage.setItem("userRole",u),i.success("登录成功"),v.push("/dashboard")}else i.error(l.message||"登录失败")}catch(s){console.error("Login error:",s),i.error(((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"登录请求失败")}finally{d.value=!1}}})};return(_,e)=>{const t=n("el-input"),s=n("el-form-item"),l=n("el-button"),p=n("el-form"),u=n("el-card");return V(),b("div",C,[o(u,{class:"login-card"},{header:a(()=>[...e[2]||(e[2]=[g("div",{class:"login-header"},[g("h2",null,"管理后台登录")],-1)])]),default:a(()=>[o(p,{model:r,rules:y,ref_key:"loginFormRef",ref:c,"label-width":"0px"},{default:a(()=>[o(s,{prop:"username"},{default:a(()=>[o(t,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=m=>r.username=m),placeholder:"用户名/学号","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(s,{prop:"password"},{default:a(()=>[o(t,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=m=>r.password=m),type:"password",placeholder:"密码","prefix-icon":"Lock","show-password":"",onKeyup:k(f,["enter"])},null,8,["modelValue"])]),_:1}),o(s,null,{default:a(()=>[o(l,{type:"primary",loading:d.value,class:"login-button",onClick:f},{default:a(()=>[...e[3]||(e[3]=[L("登录",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}},N=x(E,[["__scopeId","data-v-52f060da"]]);export{N as default};
