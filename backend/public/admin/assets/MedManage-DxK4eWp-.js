import{_ as We,i as Ye,p as $,E as g,o as c,c as h,a as l,w as t,f as b,g as de,r as y,D as Ze,e as d,d as _,C as q,z as N,t as S,b as el,F as M,y as D,m as H,k as L,P as ll,n as al,B as tl,Q as ol,J as sl,R as nl,S as ee,G as ue,q as rl}from"./index-1rGkZLYp.js";import{k as il}from"./katex.min-DPBfLjbn.js";import{E as pe}from"./style-BS9iE4ZN.js";const dl={class:"med-manage-container"},ul={class:"tab-header"},pl={class:"pagination"},ml={class:"tab-header"},cl={class:"pagination"},fl={class:"course-chapter-manage"},vl={class:"filter-bar"},_l={key:0,class:"empty-data"},gl={class:"import-container"},yl={class:"upload-icon-box"},bl={key:0,class:"import-list"},wl={class:"list-header"},hl={class:"list-title"},Vl={key:1,class:"empty-import"},kl={key:0,class:"edit-dialog-container"},Cl={class:"edit-sidebar"},$l=["onClick"],xl={class:"edit-content"},Ul={class:"tab-panel"},Sl={key:0,class:"preview-section"},Il=["innerHTML"],zl={class:"options-section"},Nl={class:"option-header"},Fl={class:"option-label"},Tl={key:1,class:"preview-section"},Ml={class:"preview-content"},Dl=["innerHTML"],Al={class:"tab-panel"},El={class:"editor-container"},Ol={class:"editor-container"},ql={class:"editor-container"},Ll={class:"tab-panel"},Rl={key:0,class:"preview-section"},Jl=["innerHTML"],Ql={class:"tab-panel"},Bl={class:"dialog-footer"},jl={key:0,class:"feedback-detail"},Hl={class:"admin-remark"},Pl={class:"dialog-footer"},Kl={__name:"MedManage",setup(Xl){const me=b("feedback"),R=b("basic"),Ue=[{key:"basic",label:"基本信息",icon:"Document"},{key:"analysis",label:"解析详情",icon:"DataAnalysis"},{key:"resource",label:"资源与图谱",icon:"Collection"},{key:"settings",label:"其他设置",icon:"Setting"}],le={placeholder:"请输入内容...",MENU_CONF:{uploadImage:{server:"/api/upload/image",fieldName:"file",maxFileSize:5*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],metaWithUrl:!0,customInsert(o,e){e(o.url,o.alt||"",o.href||"")}}}},J=b(!1),ce=b([]),fe=b(0),A=de({page:1,limit:10,status:1}),ve=b([]),_e=b(0),V=de({page:1,size:10,keyword:"",course_id:"",chapter_id:"",year:"",question_type_option:"",status:""}),F=b([]),ae=b([]),te=b([]),P=b([]),W=b(!1),Y=de({course_id:""}),Q=b(!1),Se=b("编辑题目"),s=b(null),K=b(!1),B=b(null),Z=b(""),E=b([]);Ye(()=>{ge(),X(),x()});const ge=async()=>{try{const o=await $.getMedCourses();o.code===0&&(F.value=o.data,F.value.length>0&&(Y.course_id=F.value[0].courseId,se()))}catch{g.error("获取科目失败")}},Ie=async o=>{if(V.chapter_id="",!o){ae.value=[],x();return}try{const e=await $.getMedChapters({course_id:o});e.code===0&&(ae.value=e.data),x()}catch{g.error("获取章节失败")}},oe=async o=>{if(!o){te.value=[];return}try{const e=await $.getMedChapters({course_id:o});e.code===0&&(te.value=e.data)}catch(e){console.error("获取章节失败:",e)}},se=async()=>{W.value=!0;try{const o=await $.getMedChapters({course_id:Y.course_id});o.code===0&&(P.value=o.data.map(e=>{const r=F.value.find(i=>i.courseId===e.courseId);return{...e,courseName:r?r.courseName:""}}))}catch{g.error("获取章节失败")}finally{W.value=!1}},X=async()=>{J.value=!0;try{const o=await $.getMedFeedbacks(A);o.code===0&&(ce.value=o.data.list,fe.value=o.data.total)}catch{g.error("获取反馈失败")}finally{J.value=!1}},x=async()=>{J.value=!0;try{const o=await $.searchMedQuestions(V);o.code===0&&(ve.value=o.data.list,_e.value=o.data.total)}catch{g.error("获取题目失败")}finally{J.value=!1}},ze=o=>{B.value=o,Z.value=o.AdminRemark||"",K.value=!0},ye=async o=>{try{(await $.updateMedFeedbackStatus(B.value.id,{status:o,adminRemark:Z.value})).code===0&&(g.success("更新成功"),K.value=!1,X())}catch{g.error("更新失败")}},Ne=async o=>{try{const e=await $.getMedQuestionDetail(o.question_id);e.code===0&&(s.value=be(e.data),s.value.course_id&&await oe(s.value.course_id),Q.value=!0)}catch{g.error("获取题目详情失败")}},Fe=o=>{ue.confirm("确定要删除该题目吗？","提示",{type:"warning"}).then(async()=>{try{(await $.deleteQuestion("med",o.question_id)).code===0&&(g.success("删除成功"),x())}catch{g.error("删除失败")}})},Te=async o=>{if(!o.QuestionID){g.warning("该反馈没有关联的题目ID");return}try{const e=await $.getMedQuestionDetail(o.QuestionID);e.code===0&&(s.value=be(e.data),s.value.course_id&&await oe(s.value.course_id),Q.value=!0)}catch{g.error("获取题目详情失败")}},be=o=>{const e={...o};if(typeof e.content=="string")try{const r=JSON.parse(e.content);if(Array.isArray(r)&&r.length>0){e.options=r.map((i,n)=>{try{const p=typeof i=="string"?JSON.parse(i):i;return{label:p.choose||String.fromCharCode(65+n),content:p.content||"",answer:p.answer||"",isCorrect:p.right==="true"||p.right===!0}}catch{return{label:String.fromCharCode(65+n),content:typeof i=="string"?i:JSON.stringify(i),answer:"",isCorrect:!1}}});try{const i=typeof r[0]=="string"?JSON.parse(r[0]):r[0];e.parsedAnswer=i.answer||""}catch{e.parsedAnswer=e.answer||""}}else e.options=[],e.parsedAnswer=e.answer||""}catch{e.options=[{label:"A",content:e.content,answer:e.answer||"",isCorrect:!1}],e.parsedAnswer=e.answer||""}else if(Array.isArray(e.content)){e.options=e.content.map((r,i)=>{try{const n=typeof r=="string"?JSON.parse(r):r;return{label:n.choose||String.fromCharCode(65+i),content:n.content||"",answer:n.answer||"",isCorrect:n.right==="true"||n.right===!0}}catch{return{label:String.fromCharCode(65+i),content:typeof r=="string"?r:JSON.stringify(r),answer:"",isCorrect:!1}}});try{const r=typeof e.content[0]=="string"?JSON.parse(e.content[0]):e.content[0];e.parsedAnswer=r.answer||e.answer||""}catch{e.parsedAnswer=e.answer||""}}else e.options=[],e.parsedAnswer=e.answer||"";return e.parsedAnswer&&!e.answer&&(e.answer=e.parsedAnswer),e},Me=()=>{s.value.options||(s.value.options=[]);const o=String.fromCharCode(65+s.value.options.length);s.value.options.push({label:o,content:"",answer:s.value.answer||"",isCorrect:!1})},De=(o,e)=>o.map(r=>({answer:e,choose:r.label,right:e.includes(r.label)?"true":"false",content:r.content})),ne=o=>{if(!o)return"";const e=document.createElement("div");e.innerHTML=o;let r=e.textContent||e.innerText||"";return r=r.replace(/\s+/g," ").trim(),r},we=o=>{if(!o)return"";const e=document.createElement("div");e.innerHTML=o;const r=e.querySelectorAll("img"),i=Array.from(r).map(n=>n.src).filter(n=>n);return i.length>0?JSON.stringify(i):""},Ae=async()=>{try{const o={...s.value};if(o.options&&o.options.length>0&&(o.content=JSON.stringify(De(o.options,o.answer))),o.analysis&&(o.analysis=ne(o.analysis)),o.basic_analysis){o.basic_analysis=ne(o.basic_analysis);const r=we(s.value.basic_analysis);r&&(o.basic_analysis_image=r)}if(o.itemize_analysis){o.itemize_analysis=ne(o.itemize_analysis);const r=we(s.value.itemize_analysis);r&&(o.itemize_analysis_image=r)}delete o.options,delete o.parsedAnswer,(await $.updateMedQuestion(o.question_id,o)).code===0&&(g.success("保存成功"),Q.value=!1,x())}catch{g.error("保存失败")}},he=b(null),Ee=()=>{var o;(o=he.value)==null||o.click()},Oe=o=>{const e=o.target.files;!e||e.length===0||(Array.from(e).forEach(r=>{const i=new FileReader;i.onload=n=>{try{const p=JSON.parse(n.target.result);E.value.push({filename:r.name,size:(r.size/1024).toFixed(2)+" KB",status:"pending",data:p})}catch(p){g.error(`解析 ${r.name} 失败: ${p.message}`)}},i.readAsText(r)}),o.target.value="")},qe=o=>{E.value.splice(o,1)},Le=rl(()=>E.value.some(o=>o.status==="pending")),Re=async()=>{const o=E.value.filter(e=>e.status==="pending");if(o.length!==0)for(const e of o)await Ve(e)},Ve=async o=>{o.status="importing";try{const e=await $.importMedFile({filename:o.filename,jsonData:o.data});e.code===0?(o.status="success",g.success(`${o.filename} 导入成功`),ge()):(o.status="error",g.error(`${o.filename} 导入失败: ${e.message}`))}catch{o.status="error",g.error(`${o.filename} 导入出错`)}},Je=o=>({pending:"info",importing:"warning",success:"success",error:"danger"})[o]||"info",Qe=o=>({pending:"待导入",importing:"导入中",success:"导入成功",error:"导入失败"})[o]||o,Be=o=>o?new Date(o).toLocaleString():"-",je=o=>{ue.prompt("请输入新的科目名称","编辑科目",{inputValue:o.courseName,confirmButtonText:"保存",cancelButtonText:"取消"}).then(async({value:e})=>{if(!e||e.trim()===""){g.warning("科目名称不能为空");return}try{if((await $.updateMedCourse(o.courseId,{courseName:e.trim()})).code===0){g.success("科目修改成功");const i=F.value.find(n=>n.courseId===o.courseId);i&&(i.courseName=e.trim()),P.value.forEach(n=>{n.courseId===o.courseId&&(n.courseName=e.trim())})}}catch{g.error("修改失败")}})},He=o=>{ue.prompt("请输入新的章节名称","编辑章节",{inputValue:o.chapterName,confirmButtonText:"保存",cancelButtonText:"取消"}).then(async({value:e})=>{if(!e||e.trim()===""){g.warning("章节名称不能为空");return}try{if((await $.updateMedChapter(o.chapterId,{chapterName:e.trim()})).code===0){g.success("章节修改成功");const i=P.value.find(n=>n.chapterId===o.chapterId);i&&(i.chapterName=e.trim())}}catch{g.error("修改失败")}})},Pe=o=>{if(!o)return"";const e=o.trim().split(`
`);if(e.length<2||!e.some(w=>w.includes("|")))return o;const i=w=>w.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");let n='<table class="markdown-table">',p=!0;return e.forEach((w,u)=>{if(w=w.trim(),!!w&&!w.match(/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?$/)&&w.includes("|")){const v=w.split("|").map(f=>f.trim()).filter(f=>f);v.length>0&&(p?(n+="<thead><tr>",v.forEach(f=>{n+=`<th>${i(f)}</th>`}),n+="</tr></thead><tbody>",p=!1):(n+="<tr>",v.forEach(f=>{n+=`<td>${i(f)}</td>`}),n+="</tr>"))}}),p?o:(n+="</tbody></table>",n)},ke=o=>{if(!o)return"";const e=[],r=(u,v="html")=>{const f=`__LATEX_JS_${v.toUpperCase()}_PH_${e.length}__`;return e.push({p:f,content:u,type:v}),f};let i=o.trim().replace(/\t/g," ").replace(/ {2,}/g," ");const n=[];let p;try{p=new RegExp("(\\$\\$[\\s\\S]*?\\$\\$)|((?<!\\\\)\\$([\\s\\S]+?)(?<!\\\\)\\$)|(\\\\\\[[\\s\\S]*?\\\\\\])|(\\\\\\([\\s\\S]*?\\\\\\))","g")}catch{p=/(\$\$[\s\S]*?\$\$)|(\$([\s\S]+?)\$)|(\\\[[\s\S]*?\\\])|(\\\([\s\S]*?\\\))/g}i=i.replace(p,u=>{const v=u.replace(/\n/g," "),f=`__FORMULA_TEMP_${n.length}__`;return n.push({p:f,original:u,cleaned:v}),f}),n.forEach(({p:u,cleaned:v})=>{i=i.replace(u,v)});let w;try{w=new RegExp("(\\$\\$[\\s\\S]*?\\$\\$)|((?<!\\\\)\\$([\\s\\S]+?)(?<!\\\\)\\$)|(\\\\\\[[\\s\\S]*?\\\\\\])|(\\\\\\([\\s\\S]*?\\\\\\))","g")}catch{w=/(\$\$[\s\S]*?\$\$)|(\$([\s\S]+?)\$)|(\\\[[\s\S]*?\\\])|(\\\([\s\S]*?\\\))/g}return i=i.replace(w,(u,v,f,T,I,m)=>{let z="",U=!1;if(v?(z=v.slice(2,-2),U=!0):f?(z=T,U=!1):I?(z=I.slice(2,-2),U=!0):m&&(z=m.slice(2,-2),U=!1),!z.trim())return u;try{const G=il.renderToString(z,{throwOnError:!1,displayMode:U,strict:!1});return r(G,"math")}catch(G){return console.warn("KaTeX render error:",G),u}}),i=i.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),i=i.replace(/《答案》/g,'<span class="custom-tag answer">【答案】</span>').replace(/《\/答案》/g,"").replace(/《分析》/g,'<span class="custom-tag analysis">【思路分析】</span>').replace(/《\/分析》/g,"").replace(/《点评》/g,'<span class="custom-tag commentary">【点评】</span>').replace(/《\/点评》/g,"").replace(/《注释》/g,'<span class="custom-tag note">').replace(/《\/注释》/g,"</span>").replace(/《步骤》/g,'<span class="custom-tag step">【步骤】</span>').replace(/《\/步骤》/g,""),i=i.replace(/\\color\{#([0-9A-Fa-f]{6})\}\{([^}]+)\}/g,'<span style="color:#$1;">$2</span>').replace(/\\bold\{([^}]+)\}/g,"<b>$1</b>").replace(/\\mathbf\{([^}]+)\}/g,"<b>$1</b>"),i=i.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(u,v,f)=>{let T=f;try{T=decodeURIComponent(f)}catch{}return`<img src="${T.replace(/(_yjs|_thumb|_small|_medium|_large)(\?.*)?$/i,"$2")}" alt="${v}" style="max-width:100%;height:auto;display:block;margin:10px 0;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display='none'" />`}),i=i.replace(/!\s*`\s*(https?:\/\/[^\s`]+\.(?:png|jpg|jpeg|gif|webp|svg|bmp)(?:_yjs|_thumb|_small|_medium|_large)?)\s*`/gi,(u,v)=>{let f=v;try{f=decodeURIComponent(v)}catch{}return`<img src="${f.replace(/(_yjs|_thumb|_small|_medium|_large)(\?.*)?$/i,"$2")}" alt="" style="max-width:100%;height:auto;display:block;margin:10px 0;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display='none'" />`}),i=i.replace(/(https?:\/\/[^\s<>"]+\.(?:png|jpg|jpeg|gif|webp|svg|bmp))(?:_yjs|_thumb|_small|_medium|_large)?(?!["'])/gi,(u,v)=>`<img src="${v.replace(/(_yjs|_thumb|_small|_medium|_large)$/i,"")}" style="max-width:100%;height:auto;display:block;margin:10px 0;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display='none'" />`),e.forEach(({p:u,content:v})=>{i=i.replace(u,v)}),i=i.replace(/\n/g,"<br>"),i};return(o,e)=>{const r=y("el-option"),i=y("el-select"),n=y("el-form-item"),p=y("el-button"),w=y("el-form"),u=y("el-table-column"),v=y("el-tag"),f=y("el-table"),T=y("el-pagination"),I=y("el-tab-pane"),m=y("el-input"),z=y("el-empty"),U=y("el-icon"),G=y("el-tabs"),C=y("el-col"),O=y("el-row"),Ce=y("el-radio"),Ke=y("el-tooltip"),$e=y("el-input-number"),Xe=y("el-switch"),xe=y("el-dialog"),re=y("el-descriptions-item"),Ge=y("el-descriptions"),ie=Ze("loading");return c(),h("div",dl,[l(G,{modelValue:me.value,"onUpdate:modelValue":e[10]||(e[10]=a=>me.value=a),type:"border-card"},{default:t(()=>[l(I,{label:"纠错反馈",name:"feedback"},{default:t(()=>[d("div",ul,[l(w,{inline:!0,model:A},{default:t(()=>[l(n,{label:"状态"},{default:t(()=>[l(i,{modelValue:A.status,"onUpdate:modelValue":e[0]||(e[0]=a=>A.status=a),placeholder:"选择状态",clearable:"",onChange:X},{default:t(()=>[l(r,{label:"待处理",value:1}),l(r,{label:"已处理",value:2})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:X},{default:t(()=>[...e[48]||(e[48]=[_("刷新",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),q((c(),N(f,{data:ce.value,style:{width:"100%"}},{default:t(()=>[l(u,{prop:"id",label:"ID",width:"80"}),l(u,{label:"状态",width:"100"},{default:t(a=>[l(v,{type:a.row.Status===2?"success":"danger"},{default:t(()=>[_(S(a.row.Status===2?"已处理":"待处理"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"Type",label:"类型",width:"120"}),l(u,{prop:"Content",label:"反馈内容","show-overflow-tooltip":""}),l(u,{prop:"QuestionID",label:"题目ID",width:"100"}),l(u,{label:"提交时间",width:"180"},{default:t(a=>[_(S(Be(a.row.CreatedAt)),1)]),_:1}),l(u,{label:"操作",width:"200",fixed:"right"},{default:t(a=>[l(p,{size:"small",type:"primary",link:"",onClick:k=>ze(a.row)},{default:t(()=>[...e[49]||(e[49]=[_("处理",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"success",link:"",onClick:k=>Te(a.row)},{default:t(()=>[...e[50]||(e[50]=[_("编辑题目",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,J.value]]),d("div",pl,[l(T,{"current-page":A.page,"onUpdate:currentPage":e[1]||(e[1]=a=>A.page=a),"page-size":A.limit,layout:"total, prev, pager, next",total:fe.value,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1}),l(I,{label:"试题管理",name:"question"},{default:t(()=>[d("div",ml,[l(w,{inline:!0,model:V,size:"small"},{default:t(()=>[l(n,{label:"关键字"},{default:t(()=>[l(m,{modelValue:V.keyword,"onUpdate:modelValue":e[2]||(e[2]=a=>V.keyword=a),placeholder:"搜索题干或ID",clearable:"",onKeyup:el(x,["enter"]),style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(n,{label:"科目"},{default:t(()=>[l(i,{modelValue:V.course_id,"onUpdate:modelValue":e[3]||(e[3]=a=>V.course_id=a),placeholder:"选择科目",clearable:"",onChange:Ie,style:{width:"150px"}},{default:t(()=>[(c(!0),h(M,null,D(F.value,a=>(c(),N(r,{key:a.courseId,label:a.courseName,value:a.courseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"章节"},{default:t(()=>[l(i,{modelValue:V.chapter_id,"onUpdate:modelValue":e[4]||(e[4]=a=>V.chapter_id=a),placeholder:"选择章节",clearable:"",onChange:x,style:{width:"180px"}},{default:t(()=>[(c(!0),h(M,null,D(ae.value,a=>(c(),N(r,{key:a.chapterId,label:a.chapterName,value:a.chapterId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"年份"},{default:t(()=>[l(m,{modelValue:V.year,"onUpdate:modelValue":e[5]||(e[5]=a=>V.year=a),placeholder:"年份",style:{width:"100px"},clearable:"",onChange:x},null,8,["modelValue"])]),_:1}),l(n,{label:"题型"},{default:t(()=>[l(m,{modelValue:V.question_type_option,"onUpdate:modelValue":e[6]||(e[6]=a=>V.question_type_option=a),placeholder:"题型标识",style:{width:"120px"},clearable:"",onChange:x},null,8,["modelValue"])]),_:1}),l(n,{label:"状态"},{default:t(()=>[l(i,{modelValue:V.status,"onUpdate:modelValue":e[7]||(e[7]=a=>V.status=a),placeholder:"状态",clearable:"",style:{width:"100px"},onChange:x},{default:t(()=>[l(r,{label:"有效",value:1}),l(r,{label:"下架",value:0})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:x},{default:t(()=>[...e[51]||(e[51]=[_("查询",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),q((c(),N(f,{data:ve.value,style:{width:"100%"},border:"",size:"small"},{default:t(()=>[l(u,{prop:"question_id",label:"题目ID",width:"120"}),l(u,{prop:"course_name",label:"科目",width:"120"}),l(u,{prop:"chapter_name",label:"章节",width:"150","show-overflow-tooltip":""}),l(u,{prop:"topic",label:"题干","show-overflow-tooltip":"","min-width":"200"}),l(u,{prop:"year",label:"年份",width:"80",align:"center"}),l(u,{prop:"question_type_option",label:"题型",width:"100"}),l(u,{label:"状态",width:"80",align:"center"},{default:t(a=>[l(v,{type:a.row.status===1?"success":"info",size:"small"},{default:t(()=>[_(S(a.row.status===1?"有效":"下架"),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"120",fixed:"right"},{default:t(a=>[l(p,{size:"small",type:"primary",link:"",onClick:k=>Ne(a.row)},{default:t(()=>[...e[52]||(e[52]=[_("编辑",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"danger",link:"",onClick:k=>Fe(a.row)},{default:t(()=>[...e[53]||(e[53]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,J.value]]),d("div",cl,[l(T,{"current-page":V.page,"onUpdate:currentPage":e[8]||(e[8]=a=>V.page=a),"page-size":V.size,layout:"total, prev, pager, next",total:_e.value,onCurrentChange:x},null,8,["current-page","page-size","total"])])]),_:1}),l(I,{label:"科目章节管理",name:"course"},{default:t(()=>[d("div",fl,[d("div",vl,[l(w,{inline:!0,size:"small"},{default:t(()=>[l(n,{label:"所属科目"},{default:t(()=>[l(i,{modelValue:Y.course_id,"onUpdate:modelValue":e[9]||(e[9]=a=>Y.course_id=a),placeholder:"请选择科目筛选",clearable:"",onChange:se,style:{width:"200px"}},{default:t(()=>[(c(!0),h(M,null,D(F.value,a=>(c(),N(r,{key:a.courseId,label:a.courseName,value:a.courseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:se},{default:t(()=>[...e[54]||(e[54]=[_("刷新",-1)])]),_:1})]),_:1})]),_:1})]),q((c(),N(f,{data:P.value,style:{width:"100%"},border:"",size:"small"},{default:t(()=>[l(u,{type:"index",label:"序号",width:"60",align:"center"}),l(u,{prop:"courseId",label:"科目ID",width:"100"}),l(u,{prop:"courseName",label:"科目名称",width:"150"}),l(u,{prop:"chapterId",label:"章节ID",width:"100"}),l(u,{prop:"chapterName",label:"章节名称","min-width":"200","show-overflow-tooltip":""}),l(u,{label:"操作",width:"180",fixed:"right"},{default:t(a=>[l(p,{size:"small",type:"primary",link:"",onClick:k=>je(a.row)},{default:t(()=>[...e[55]||(e[55]=[_("编辑科目",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"primary",link:"",onClick:k=>He(a.row)},{default:t(()=>[...e[56]||(e[56]=[_("编辑章节",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,W.value]]),P.value.length===0&&!W.value?(c(),h("div",_l,[l(z,{description:"暂无数据，请选择科目或刷新"})])):H("",!0)])]),_:1}),l(I,{label:"试题导入",name:"import"},{default:t(()=>[d("div",gl,[d("div",{class:"upload-card",onClick:Ee},[d("div",yl,[l(U,{size:48,color:"#409EFF"},{default:t(()=>[l(L(ll))]),_:1})]),e[57]||(e[57]=d("div",{class:"upload-text-box"},[d("div",{class:"upload-main-text"},"点击上传 JSON 文件"),d("div",{class:"upload-sub-text"},"支持单选或多选 JSON 格式试题包")],-1)),d("input",{type:"file",ref_key:"fileInput",ref:he,style:{display:"none"},accept:".json",multiple:"",onChange:Oe},null,544)]),E.value.length>0?(c(),h("div",bl,[d("div",wl,[d("span",hl,"待导入文件 ("+S(E.value.length)+")",1),l(p,{type:"primary",size:"small",onClick:Re,disabled:!Le.value},{default:t(()=>[...e[58]||(e[58]=[_(" 批量导入 ",-1)])]),_:1},8,["disabled"])]),l(f,{data:E.value,style:{width:"100%"},size:"small"},{default:t(()=>[l(u,{type:"index",label:"序号",width:"60",align:"center"}),l(u,{prop:"filename",label:"文件名","min-width":"200","show-overflow-tooltip":""}),l(u,{prop:"size",label:"大小",width:"100",align:"center"}),l(u,{label:"状态",width:"100",align:"center"},{default:t(a=>[l(v,{type:Je(a.row.status),size:"small"},{default:t(()=>[_(S(Qe(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"150",align:"center"},{default:t(a=>[l(p,{size:"small",type:"primary",link:"",onClick:k=>Ve(a.row),loading:a.row.status==="importing",disabled:a.row.status==="success"},{default:t(()=>[...e[59]||(e[59]=[_("导入",-1)])]),_:1},8,["onClick","loading","disabled"]),l(p,{size:"small",type:"danger",link:"",onClick:k=>qe(a.$index),disabled:a.row.status==="importing"},{default:t(()=>[...e[60]||(e[60]=[_("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])])):(c(),h("div",Vl,[l(z,{description:"请上传需要导入的 JSON 文件"})]))])]),_:1})]),_:1},8,["modelValue"]),l(xe,{modelValue:Q.value,"onUpdate:modelValue":e[42]||(e[42]=a=>Q.value=a),title:Se.value,width:"90%",top:"3vh","destroy-on-close":"",class:"edit-dialog"},{footer:t(()=>[d("span",Bl,[l(p,{onClick:e[41]||(e[41]=a=>Q.value=!1)},{default:t(()=>[...e[71]||(e[71]=[_("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:Ae},{default:t(()=>[...e[72]||(e[72]=[_("保存",-1)])]),_:1})])]),default:t(()=>[s.value?(c(),h("div",kl,[d("div",Cl,[(c(),h(M,null,D(Ue,a=>d("div",{key:a.key,class:al(["sidebar-item",{active:R.value===a.key}]),onClick:k=>R.value=a.key},[l(U,null,{default:t(()=>[(c(),N(tl(a.icon)))]),_:2},1024),d("span",null,S(a.label),1)],10,$l)),64))]),d("div",xl,[l(w,{model:s.value,"label-width":"100px",size:"small"},{default:t(()=>[q(d("div",Ul,[e[66]||(e[66]=d("h3",{class:"panel-title"},"基本信息",-1)),l(O,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"所属科目"},{default:t(()=>[l(i,{modelValue:s.value.course_id,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.course_id=a),style:{width:"100%"},onChange:oe},{default:t(()=>[(c(!0),h(M,null,D(F.value,a=>(c(),N(r,{key:a.courseId,label:a.courseName,value:a.courseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"所属章节"},{default:t(()=>[l(i,{modelValue:s.value.chapter_id,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.chapter_id=a),style:{width:"100%"}},{default:t(()=>[(c(!0),h(M,null,D(te.value,a=>(c(),N(r,{key:a.chapterId,label:a.chapterName,value:a.chapterId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(O,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"年份"},{default:t(()=>[l(m,{modelValue:s.value.year,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.year=a),placeholder:"如: 2024"},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"题号"},{default:t(()=>[l(m,{modelValue:s.value.number,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.number=a),placeholder:"题号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(n,{label:"题干"},{default:t(()=>[l(m,{modelValue:s.value.topic,"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.topic=a),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"题目正文内容，支持 LaTeX 公式（$...$ 或 $$...$$）和图片 URL"},null,8,["modelValue"])]),_:1}),s.value.topic?(c(),h("div",Sl,[e[61]||(e[61]=d("div",{class:"preview-title"},"题干预览",-1)),d("div",{class:"preview-content",innerHTML:ke(s.value.topic)},null,8,Il)])):H("",!0),l(n,{label:"题干图片"},{default:t(()=>[l(m,{modelValue:s.value.topic_image,"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.topic_image=a),placeholder:"图片URL or 路径"},null,8,["modelValue"])]),_:1}),d("div",zl,[e[64]||(e[64]=d("div",{class:"section-title"},"选项设置",-1)),(c(!0),h(M,null,D(s.value.options,(a,k)=>(c(),h("div",{key:k,class:"option-item"},[d("div",Nl,[l(Ce,{modelValue:s.value.answer,"onUpdate:modelValue":e[17]||(e[17]=j=>s.value.answer=j),label:a.label,class:"option-radio"},{default:t(()=>[d("span",Fl,S(a.label),1)]),_:2},1032,["modelValue","label"]),l(p,{type:"danger",link:"",size:"small",onClick:j=>s.value.options.splice(k,1)},{default:t(()=>[l(U,null,{default:t(()=>[l(L(ol))]),_:1}),e[62]||(e[62]=_(" 删除 ",-1))]),_:1},8,["onClick"])]),l(m,{modelValue:s.value.options[k].content,"onUpdate:modelValue":j=>s.value.options[k].content=j,type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"选项内容，支持 LaTeX 公式",class:"option-input"},null,8,["modelValue","onUpdate:modelValue"])]))),128)),l(p,{type:"primary",plain:"",size:"small",onClick:Me},{default:t(()=>[l(U,null,{default:t(()=>[l(L(sl))]),_:1}),e[63]||(e[63]=_(" 添加选项 ",-1))]),_:1})]),s.value.options&&s.value.options.length>0?(c(),h("div",Tl,[e[65]||(e[65]=d("div",{class:"preview-title"},"选项预览",-1)),d("div",Ml,[(c(!0),h(M,null,D(s.value.options,(a,k)=>(c(),h("div",{key:k,class:"preview-option"},[l(Ce,{modelValue:s.value.answer,"onUpdate:modelValue":e[18]||(e[18]=j=>s.value.answer=j),label:a.label,disabled:""},{default:t(()=>[d("strong",null,S(a.label)+".",1),d("span",{innerHTML:ke(a.content)},null,8,Dl)]),_:2},1032,["modelValue","label"])]))),128))])])):H("",!0),l(O,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"正确答案"},{default:t(()=>[l(m,{modelValue:s.value.answer,"onUpdate:modelValue":e[19]||(e[19]=a=>s.value.answer=a),placeholder:"例如: A 或 A,B",readonly:""},{append:t(()=>[l(Ke,{content:"点击选项左侧的单选按钮选择答案"},{default:t(()=>[l(U,null,{default:t(()=>[l(L(nl))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"题目类型"},{default:t(()=>[l(i,{modelValue:s.value.type,"onUpdate:modelValue":e[20]||(e[20]=a=>s.value.type=a),placeholder:"选择题型",style:{width:"100%"}},{default:t(()=>[l(r,{label:"单选题",value:"单选题"}),l(r,{label:"多选题",value:"多选题"}),l(r,{label:"判断题",value:"判断题"}),l(r,{label:"填空题",value:"填空题"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[ee,R.value==="basic"]]),q(d("div",Al,[e[67]||(e[67]=d("h3",{class:"panel-title"},"解析详情",-1)),l(n,{label:"考点还原"},{default:t(()=>[d("div",El,[l(L(pe),{modelValue:s.value.analysis,"onUpdate:modelValue":e[21]||(e[21]=a=>s.value.analysis=a),defaultConfig:le,mode:"default",class:"auto-height-editor"},null,8,["modelValue"])])]),_:1}),l(n,{label:"基础解析"},{default:t(()=>[d("div",Ol,[l(L(pe),{modelValue:s.value.basic_analysis,"onUpdate:modelValue":e[22]||(e[22]=a=>s.value.basic_analysis=a),defaultConfig:le,mode:"default",class:"auto-height-editor"},null,8,["modelValue"])])]),_:1}),l(n,{label:"基础解析图片"},{default:t(()=>[l(m,{modelValue:s.value.basic_analysis_image,"onUpdate:modelValue":e[23]||(e[23]=a=>s.value.basic_analysis_image=a)},null,8,["modelValue"])]),_:1}),l(n,{label:"分项解析"},{default:t(()=>[d("div",ql,[l(L(pe),{modelValue:s.value.itemize_analysis,"onUpdate:modelValue":e[24]||(e[24]=a=>s.value.itemize_analysis=a),defaultConfig:le,mode:"default",class:"auto-height-editor"},null,8,["modelValue"])])]),_:1}),l(n,{label:"分项解析图片"},{default:t(()=>[l(m,{modelValue:s.value.itemize_analysis_image,"onUpdate:modelValue":e[25]||(e[25]=a=>s.value.itemize_analysis_image=a)},null,8,["modelValue"])]),_:1}),l(n,{label:"视频解析链接"},{default:t(()=>[l(m,{modelValue:s.value.video_url,"onUpdate:modelValue":e[26]||(e[26]=a=>s.value.video_url=a),placeholder:"视频URL"},null,8,["modelValue"])]),_:1})],512),[[ee,R.value==="analysis"]]),q(d("div",Ll,[e[69]||(e[69]=d("h3",{class:"panel-title"},"资源与图谱",-1)),l(n,{label:"比较总结"},{default:t(()=>[l(m,{modelValue:s.value.comparison_summary,"onUpdate:modelValue":e[27]||(e[27]=a=>s.value.comparison_summary=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s.value.comparison_summary?(c(),h("div",Rl,[e[68]||(e[68]=d("div",{class:"preview-title"},"比较总结预览",-1)),d("div",{class:"preview-content table-preview",innerHTML:Pe(s.value.comparison_summary)},null,8,Jl)])):H("",!0),l(n,{label:"比较总结图片"},{default:t(()=>[l(m,{modelValue:s.value.comparison_images,"onUpdate:modelValue":e[28]||(e[28]=a=>s.value.comparison_images=a),placeholder:"JSON数组字符串"},null,8,["modelValue"])]),_:1}),l(n,{label:"思维导图文本"},{default:t(()=>[l(m,{modelValue:s.value.mind_map,"onUpdate:modelValue":e[29]||(e[29]=a=>s.value.mind_map=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(n,{label:"思维导图图片"},{default:t(()=>[l(m,{modelValue:s.value.mind_map_image,"onUpdate:modelValue":e[30]||(e[30]=a=>s.value.mind_map_image=a)},null,8,["modelValue"])]),_:1}),l(n,{label:"知识点图片"},{default:t(()=>[l(m,{modelValue:s.value.knowledge_image,"onUpdate:modelValue":e[31]||(e[31]=a=>s.value.knowledge_image=a)},null,8,["modelValue"])]),_:1})],512),[[ee,R.value==="resource"]]),q(d("div",Ql,[e[70]||(e[70]=d("h3",{class:"panel-title"},"其他设置",-1)),l(O,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"年份"},{default:t(()=>[l(m,{modelValue:s.value.year,"onUpdate:modelValue":e[32]||(e[32]=a=>s.value.year=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"题号"},{default:t(()=>[l(m,{modelValue:s.value.number,"onUpdate:modelValue":e[33]||(e[33]=a=>s.value.number=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(O,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"分值"},{default:t(()=>[l($e,{modelValue:s.value.score,"onUpdate:modelValue":e[34]||(e[34]=a=>s.value.score=a),min:0,precision:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"分值描述"},{default:t(()=>[l(m,{modelValue:s.value.score_describe,"onUpdate:modelValue":e[35]||(e[35]=a=>s.value.score_describe=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(O,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"题型标识"},{default:t(()=>[l(m,{modelValue:s.value.question_type_option,"onUpdate:modelValue":e[36]||(e[36]=a=>s.value.question_type_option=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"栏目ID"},{default:t(()=>[l(m,{modelValue:s.value.column_id,"onUpdate:modelValue":e[37]||(e[37]=a=>s.value.column_id=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(O,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(n,{label:"排序值"},{default:t(()=>[l($e,{modelValue:s.value.sort,"onUpdate:modelValue":e[38]||(e[38]=a=>s.value.sort=a),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(n,{label:"状态"},{default:t(()=>[l(Xe,{modelValue:s.value.status,"onUpdate:modelValue":e[39]||(e[39]=a=>s.value.status=a),"active-value":1,"inactive-value":0,"active-text":"有效","inactive-text":"下架"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(n,{label:"题目内部ID"},{default:t(()=>[l(m,{modelValue:s.value.question_id,"onUpdate:modelValue":e[40]||(e[40]=a=>s.value.question_id=a),disabled:""},null,8,["modelValue"])]),_:1})],512),[[ee,R.value==="settings"]])]),_:1},8,["model"])])])):H("",!0)]),_:1},8,["modelValue","title"]),l(xe,{modelValue:K.value,"onUpdate:modelValue":e[47]||(e[47]=a=>K.value=a),title:"处理纠错反馈",width:"60%"},{footer:t(()=>[d("span",Pl,[l(p,{onClick:e[44]||(e[44]=a=>K.value=!1)},{default:t(()=>[...e[74]||(e[74]=[_("取消",-1)])]),_:1}),l(p,{type:"success",onClick:e[45]||(e[45]=a=>ye(2))},{default:t(()=>[...e[75]||(e[75]=[_("标记为已处理",-1)])]),_:1}),l(p,{type:"primary",onClick:e[46]||(e[46]=a=>ye(1))},{default:t(()=>[...e[76]||(e[76]=[_("仅保存备注",-1)])]),_:1})])]),default:t(()=>[B.value?(c(),h("div",jl,[l(Ge,{column:2,border:""},{default:t(()=>[l(re,{label:"题目ID"},{default:t(()=>[_(S(B.value.QuestionID),1)]),_:1}),l(re,{label:"反馈类型"},{default:t(()=>[_(S(B.value.Type),1)]),_:1}),l(re,{label:"反馈内容",span:2},{default:t(()=>[_(S(B.value.Content),1)]),_:1})]),_:1}),d("div",Hl,[e[73]||(e[73]=d("p",null,"管理员备注：",-1)),l(m,{modelValue:Z.value,"onUpdate:modelValue":e[43]||(e[43]=a=>Z.value=a),type:"textarea",rows:3,placeholder:"输入处理备注..."},null,8,["modelValue"])])])):H("",!0)]),_:1},8,["modelValue"])])}}},Zl=We(Kl,[["__scopeId","data-v-0bfaa78c"]]);export{Zl as default};
